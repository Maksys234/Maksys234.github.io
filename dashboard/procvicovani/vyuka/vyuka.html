<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vyuka</title>
    <link rel="stylesheet" href="theme.css">
    <link rel="stylesheet" href="vyuka-layout.css">
    <link rel="stylesheet" href="vyuka-chat.css">
    <link rel="stylesheet" href="vyuka-presenter.css">
    <link rel="stylesheet" href="vyuka-specific.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']],
                processEscapes: true
            },
            svg: { fontCache: 'global' },
             options: {
                skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
                 ignoreHtmlClass: 'tex2jax_ignore',
                 processHtmlClass: 'tex2jax_process'
             },
             startup: {
                 ready: () => {
                     console.log('MathJax startup: Ready.');
                     MathJax.startup.defaultReady();
                     MathJax.startup.promise.then(() => {
                        console.log('MathJax initial typesetting finished (if any).');
                     });
                 }
             }
        };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/3.0.6/purify.min.js" integrity="sha512-H+rglffZ6f5gF7UJgvH4Naa+fGCgjrHKMgoFOGmcPTRwR6oILo5R+gtzNrpDp7iMV3udbymBVjkeZGNz1Em4rQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <script type="module" src="config.js"></script>
     <script type="module" src="state.js"></script>
     <script type="module" src="utils.js"></script>
     <script type="module" src="ui.js"></script>
     <script type="module" src="uiHelpers.js"></script>
     <script type="module" src="supabaseService.js"></script>
     <script type="module" src="geminiService.js"></script>
     <script type="module" src="speechService.js"></script>
     <script type="module" src="whiteboardController.js"></script>
     <script type="module" src="chatController.js"></script>
     <script type="module" src="vyukaApp.js"></script> </head>
<body>
    <div class="container">

        <aside id="sidebar" class="sidebar left-sidebar"> {/* <<< ДОБАВЛЕН ID */}
            <div id="user-info" class="user-info-panel" style="display: flex;"> {/* Показываем сразу */}
                 {/* <<< ИСПРАВЛЕН ПУТЬ к аватару --> */}
                 <img id="user-avatar" src="assets/default-avatar.png" alt="Avatar" class="avatar">
                 <div class="user-details">
                     <span id="user-name" class="user-name">Načítání...</span>
                     <span id="user-email" class="user-email"></span>
                 </div>
                 <button id="theme-toggle-button" class="theme-toggle btn-tooltip" title="Přepnout téma">
                     <i class="fas fa-adjust"></i>
                 </button>
                 <button id="logout-button" class="logout-button btn-tooltip" title="Odhlásit se" style="display: none;">
                    <i class="fas fa-sign-out-alt"></i>
                 </button>
             </div>
             <nav class="navigation-menu">
                 <ul>
                     <li><a href="/dashboard/dashboard.html"><i class="fas fa-tachometer-alt"></i> Přehled</a></li>
                     <li><a href="/dashboard/procvicovani/main.html"><i class="fas fa-laptop-code"></i> Procvičování</a></li>
                     <li><a href="/dashboard/pokrok.html"><i class="fas fa-chart-line"></i> Pokrok</a></li>
                     <li><a href="/dashboard/oceneni.html"><i class="fas fa-medal"></i> Ocenění</a></li>
                     <li><a href="/dashboard/materialy.html"><i class="fas fa-database"></i> Databanka</a></li>
                     <li><a href="/dashboard/profile.html"><i class="fas fa-user-astronaut"></i> Profil</a></li>
                 </ul>
             </nav>
             <div class="sidebar-footer" style="margin-top: auto; text-align: center; padding: 1rem; opacity: 0.7;">
                 <small>&copy; <span id="currentYearSidebar"></span> Justax</small>
             </div>
        </aside>

        <main id="main-content" class="main-content"> {/* <<< ДОБАВЛЕН ID */}
            <div class="topic-bar">
                <div id="current-topic-display">
                    <span class="placeholder"><i class="fas fa-spinner fa-spin"></i> Načítání tématu...</span>
                </div>
                <button id="continue-btn" class="btn btn-success btn-sm" style="display: none;">
                     <i class="fas fa-check-circle"></i> Dokončit Téma
                 </button>
             </div>

            <div class="call-interface">

                <div class="ai-presenter-area">
                    <div class="ai-presenter-header">
                        <div class="ai-presenter-info">
                            <div class="ai-avatar-placeholder">
                                <i class="fas fa-robot"></i>
                            </div>
                             <h2>Výukový Asistent</h2>
                         </div>
                         <div class="ai-presenter-header-controls">
                              <button id="clear-board-btn" class="btn btn-secondary btn-sm btn-tooltip" title="Vymazat tabuli">
                                  <i class="fas fa-eraser"></i> Vyčistit
                              </button>
                              <button id="stop-speech-btn" class="btn btn-warning btn-sm btn-tooltip" title="Zastavit hlasový výstup" style="display:none;">
                                  <i class="fas fa-stop-circle"></i> Zastavit
                              </button>
                         </div>
                     </div>
                     <div id="whiteboard-container">
                          <div id="whiteboard-content" class="tex2jax_process">
                            <div class="empty-state">
                                <i class="fas fa-chalkboard"></i>
                                <h3>Tabule</h3>
                                <p>Počkejte na načtení tématu...</p>
                            </div>
                          </div>
                          <div id="board-speaking-indicator" class="speaking-indicator" style="display: none;">
                              <div class="dot"></div> <div class="dot"></div> <div class="dot"></div>
                          </div>
                    </div>
                </div>

                <div class="interaction-panel">
                     <div class="interaction-tabs">
                        <div class="interaction-tab active" data-tab="chat-tab">
                            <i class="fas fa-comments"></i> Chat
                        </div>
                        </div>
                     <div class="interaction-content-area">
                         <div id="chat-tab-content" class="tab-content active">
                            <div class="chat-header">
                                <i class="fas fa-headset"></i> Konverzace s AI
                            </div>
                            <div class="chat-area">
                                <div class="chat-messages" id="chat-messages">
                                     <div class="initial-load-placeholder" style="text-align: center; padding: 2rem; color: var(--text-muted);">
                                         <i class="fas fa-spinner fa-spin" style="margin-bottom: 0.5rem;"></i> Čekám na zahájení výuky...
                                     </div>
                                     </div>
                                <div class="chat-input-area">
                                     <div class="chat-input-wrapper">
                                         <textarea id="chat-input" placeholder="Vaše odpověď nebo otázka..." rows="1"></textarea>
                                         <button id="speech-to-text-button" class="btn btn-secondary btn-tooltip" title="Hlasový vstup">
                                             <i class="fas fa-microphone"></i>
                                         </button>
                                         <button id="send-button" class="send-button btn-tooltip" title="Odeslat (Enter)">
                                             <i class="fas fa-paper-plane"></i>
                                         </button>
                                     </div>
                                 </div>
                             </div>
                         </div>
                         </div>
                 </div>
            </div>
        </main>

        <aside class="sidebar right-sidebar" style="display: none;">
             <div id="notifications-panel" class="notifications-panel">
                 <h3><span id="notification-badge" class="badge" style="display: none;">0</span> Oznámení</h3>
                 <ul id="notifications-list">
                     <li>Načítání oznámení...</li>
                 </ul>
                 <div id="no-notifications-msg" style="display: none;">Žádná nová oznámení.</div>
                 <button id="mark-all-read-btn" style="display: none;">Označit vše jako přečtené</button>
             </div>
             </aside>

        <div class="loading-overlay" id="loading-overlay-user" style="display: none;"><div class="spinner"></div><span>Načítání profilu...</span></div>
        <div class="loading-overlay" id="loading-overlay-currentTopic" style="display: none;"><div class="spinner"></div><span>Načítání tématu...</span></div>
        <div class="loading-overlay" id="loading-overlay-notifications" style="display: none;"><div class="spinner"></div><span>Načítání oznámení...</span></div>
        <div class="initial-loading-overlay" id="initial-loader"> <div class="loading-spinner"></div> <p>Načítání aplikace...</p> </div>

        <div id="global-error" style="display: none;"></div>
        <div id="toast-container"></div>
        <div id="mouse-follower" class="mouse-follower-glow"></div>
    </div>

    </body>
</html>