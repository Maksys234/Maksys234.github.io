<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    {/* Používáme váš původní title */}
    <title>Justax - Výuka s AI (Canvas)</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    {/* MathJax Configuration */}
    <script>
        if (typeof window.MathJax === 'undefined') {
            window.MathJax = {
                tex: { inlineMath: [['\\(', '\\)']], displayMath: [['$$', '$$']], processEscapes: true, processEnvironments: true },
                options: { skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'], ignoreHtmlClass: 'tex2jax_ignore', processHtmlClass: 'tex2jax_process' },
                startup: { ready: () => { MathJax.startup.defaultReady(); MathJax.startup.promise.then(() => console.log('MathJax loaded and ready.')); } }
            };
        } else {
             console.warn("window.MathJax already defined.");
        }
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    {/* Ostatní knihovny */}
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tooltipster/4.2.8/css/tooltipster.bundle.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tooltipster/4.2.8/js/tooltipster.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

    {/* Excalidraw/React/ReactDOM scripty jsou ODEBRÁNY */}

    <style>
        /* --- Kompletní CSS styly z vašeho původního souboru --- */
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Poppins', sans-serif; scroll-behavior: smooth; }
        :root {
            --primary-rgb: 67, 97, 238; --primary: #4361ee; --primary-light: #4895ef; --secondary: #3f37c9; --success: #06d6a0; --danger: #f72585; --warning: #f8961e; --info: #4cc9f0; --dark: #1e2a3a; --light: #f8f9fa; --gray: #6c757d; --gray-light: #dee2e6; --gray-dark: #343a40; --gradient-1: linear-gradient(135deg, #4361ee, #3a0ca3); --gradient-2: linear-gradient(135deg, #4cc9f0, #4361ee); --white: #ffffff; --sidebar-width: 260px; --transition-speed: 0.3s; --card-radius: 12px; --shadow-sm: 0 2px 6px rgba(0, 0, 0, 0.05); --shadow-md: 0 5px 12px rgba(0, 0, 0, 0.07); --shadow-lg: 0 10px 20px rgba(0, 0, 0, 0.1); --text-primary: #2d3748; --text-secondary: #4a5568; --text-muted: #718096; --call-bg: #f0f2f5; --call-panel-bg: var(--white); --avatar-size: 50px;
        }
        body { background-color: var(--call-bg); color: var(--text-primary); min-height: 100vh; display: flex; overflow: hidden; }

        /* --- Sidebar --- */
        .sidebar { width: var(--sidebar-width); height: 100vh; position: fixed; top: 0; left: 0; background: var(--gradient-1); color: var(--white); padding: 1.5rem 1rem; display: flex; flex-direction: column; z-index: 1050; box-shadow: var(--shadow-lg); transition: transform var(--transition-speed) ease, width var(--transition-speed) ease; }
        .sidebar-header { display: flex; align-items: center; margin-bottom: 2rem; padding: 0 0.75rem; }
        .sidebar-logo { font-size: 1.5rem; font-weight: 700; color: var(--white); text-decoration: none; display: flex; align-items: center; gap: 0.75rem; }
        .sidebar-logo i { font-size: 1.75rem; }
        .sidebar-menu { list-style: none; padding: 0; margin: 0; flex-grow: 1; }
        .sidebar-item { margin-bottom: 0.5rem; }
        .sidebar-link { display: flex; align-items: center; padding: 0.75rem 1rem; color: rgba(255, 255, 255, 0.85); text-decoration: none; border-radius: 12px; transition: all 0.2s ease; font-weight: 500; }
        .sidebar-link i { margin-right: 0.75rem; font-size: 1.2rem; width: 24px; text-align: center; }
        .sidebar-link.active, .sidebar-link:hover { background-color: rgba(255, 255, 255, 0.15); color: var(--white); }
        .sidebar-footer { margin-top: auto; padding: 1rem; font-size: 0.9rem; color: rgba(255, 255, 255, 0.7); text-align: center; }
        .user-profile { display: flex; align-items: center; padding: 1rem; margin-top: 1rem; background-color: rgba(255, 255, 255, 0.1); border-radius: 12px; }
        .user-avatar { width: 40px; height: 40px; border-radius: 50%; background-color: var(--primary-light); display: flex; align-items: center; justify-content: center; margin-right: 0.75rem; font-weight: 500; overflow: hidden; color: var(--white); }
        .user-avatar img { width: 100%; height: 100%; object-fit: cover; }
        .user-info { flex-grow: 1; }
        .user-name { font-weight: 600; font-size: 0.95rem; }
        .user-role { font-size: 0.8rem; opacity: 0.8; }

        /* --- Main Content Area --- */
        main { flex: 1; margin-left: var(--sidebar-width); transition: margin var(--transition-speed) ease; width: calc(100% - var(--sidebar-width)); height: 100vh; display: flex; flex-direction: column; overflow: hidden; background-color: var(--call-bg); }
        .main-header { padding: 1rem 1.5rem; background-color: var(--white); box-shadow: var(--shadow-sm); display: flex; justify-content: space-between; align-items: center; flex-shrink: 0; z-index: 100; border-bottom: 1px solid var(--gray-light); }
        .header-content h1 { font-size: 1.5rem; font-weight: 600; color: var(--dark); margin: 0; }
        .header-actions button, .header-actions a { font-size: 0.9rem; padding: 0.6rem 1.2rem; }

        /* --- Videocall Interface Layout --- */
        .call-interface { flex-grow: 1; display: flex; overflow: hidden; padding: 1.5rem; gap: 1.5rem; }

        /* Left Side: AI Presenter Area */
        .ai-presenter-area { flex-grow: 1; display: flex; flex-direction: column; background-color: var(--call-panel-bg); border-radius: var(--card-radius); box-shadow: var(--shadow-md); overflow: hidden; border: 1px solid var(--gray-light); }
        .ai-presenter-header { padding: 0.75rem 1.25rem; border-bottom: 1px solid var(--gray-light); display: flex; align-items: center; gap: 0.75rem; background-color: var(--light); }
        .ai-avatar-placeholder { width: var(--avatar-size); height: var(--avatar-size); background: var(--gradient-1); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 1.5rem; flex-shrink: 0; box-shadow: var(--shadow-sm); }
        .ai-presenter-info h2 { font-size: 1.1rem; font-weight: 600; color: var(--dark); margin: 0; }
        .ai-presenter-info p { font-size: 0.85rem; color: var(--text-secondary); margin: 0; }
        .whiteboard-main-container { flex-grow: 1; position: relative; overflow: hidden; border-radius: 0 0 var(--card-radius) var(--card-radius); background-color: var(--white); display: flex; justify-content: center; align-items: center; padding: 10px; }

        /* Specific styles for Canvas */
        #drawingCanvas { max-width: 100%; max-height: 100%; background-color: #fff; border: 1px solid var(--gray-light); }
        .canvas-controls { position: absolute; top: 15px; right: 15px; display: flex; gap: 5px; background-color: rgba(255, 255, 255, 0.8); padding: 5px; border-radius: 5px; box-shadow: var(--shadow-sm); z-index: 10; /* Ensure controls are above canvas */ }
        .canvas-controls button { padding: 3px 8px; font-size: 0.8em; }

        /* Right Side: Interaction Panel */
        .interaction-panel { width: 420px; flex-shrink: 0; display: flex; flex-direction: column; background-color: var(--call-panel-bg); border-radius: var(--card-radius); box-shadow: var(--shadow-md); overflow: hidden; border: 1px solid var(--gray-light); }
        .interaction-tabs { display: flex; border-bottom: 1px solid var(--gray-light); background-color: var(--light); flex-shrink: 0; }
        .interaction-tab { flex: 1; text-align: center; padding: 0.9rem 1rem; font-weight: 500; color: var(--text-secondary); cursor: pointer; transition: all 0.2s ease; border-bottom: 3px solid transparent; font-size: 0.95rem; position: relative; }
        .interaction-tab:hover { color: var(--primary); background-color: rgba(var(--primary-rgb), 0.05); }
        .interaction-tab.active { color: var(--primary); border-bottom-color: var(--primary); font-weight: 600; background-color: var(--call-panel-bg); }
        .interaction-tab.active::after { content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 1px; background-color: var(--gray-light); }
        .interaction-tab i { margin-right: 0.5rem; }

        .interaction-content-area { flex-grow: 1; overflow: hidden; position: relative; }
        .tab-content { position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: flex; flex-direction: column; overflow: hidden; visibility: hidden; opacity: 0; transition: opacity 0.3s ease, visibility 0s linear 0.3s; background-color: var(--call-panel-bg); }
        .tab-content.active { visibility: visible; opacity: 1; transition: opacity 0.3s ease; }

        /* Explanation Tab Content */
        .explanation-scroll-content { flex-grow: 1; padding: 1.5rem; overflow-y: auto; scrollbar-width: thin; scrollbar-color: var(--gray-light) transparent; }
        .explanation-scroll-content::-webkit-scrollbar { width: 8px; } .explanation-scroll-content::-webkit-scrollbar-track { background: transparent; } .explanation-scroll-content::-webkit-scrollbar-thumb { background-color: var(--gray-light); border-radius: 4px; border: 2px solid var(--call-panel-bg); }
        #explanation-title { display: none; }
        #explanation-display { line-height: 1.7; }
        #explanation-display p:last-child { margin-bottom: 0; }
        #explanation-display .step { margin-bottom: 1rem; padding-bottom: 1rem; border-bottom: 1px dashed var(--gray-light); }
        #explanation-display .step:last-child { border-bottom: none; padding-bottom: 0; }
        #explanation-display h3 { color: var(--secondary); margin-top: 1.5rem; margin-bottom: 0.7rem; font-size: 1.1rem; }
        #explanation-display code { background-color: rgba(var(--primary-rgb), 0.1); padding: 0.2rem 0.4rem; border-radius: 4px; font-size: 0.95em; color: var(--secondary); }
        #explanation-display pre { margin: 1rem 0; }
        #explanation-display pre code { display: block; background-color: var(--gray-dark); color: #e0e0e0; padding: 1rem; border-radius: 8px; font-size: 0.9rem; line-height: 1.6; white-space: pre-wrap; word-wrap: break-word; }
        #explanation-display strong { color: var(--dark); font-weight: 600; }
        #explanation-display blockquote { border-left: 3px solid var(--primary-light); padding-left: 1rem; margin: 1rem 0 1rem 0.5rem; color: var(--text-secondary); font-style: italic; }
        #explanation-display ul, #explanation-display ol { margin-left: 1.5rem; margin-bottom: 1rem; padding-left: 1rem; }
        #explanation-display li { margin-bottom: 0.5rem; }
        .explanation-controls { flex-shrink: 0; margin-top: auto; padding: 1rem 1.5rem; border-top: 1px solid var(--gray-light); text-align: center; background-color: var(--light); display: flex; justify-content: space-around; gap: 1rem; }

        /* Chat Tab Content */
        .chat-messages { flex-grow: 1; padding: 1.25rem; overflow-y: auto; scrollbar-color: var(--gray-light) var(--call-panel-bg); }
        .chat-messages::-webkit-scrollbar-track { background: var(--call-panel-bg); } .chat-messages::-webkit-scrollbar-thumb { border-color: var(--call-panel-bg); }
        .chat-input-area { flex-shrink: 0; padding: 1rem 1.25rem; background-color: var(--light); border-top: 1px solid var(--gray-light); display: flex; align-items: flex-end; gap: 0.8rem; }
        .chat-message { display: flex; gap: 0.8rem; max-width: 88%; align-items: flex-end; margin-bottom: 1rem; }
        .chat-message.user { margin-left: auto; flex-direction: row-reverse; }
        .message-avatar { width: 38px; height: 38px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 600; font-size: 1rem; flex-shrink: 0; box-shadow: var(--shadow-sm); border: 2px solid var(--call-panel-bg); }
        .chat-message.user .message-avatar { background: var(--success); color: white; }
        .chat-message.gemini .message-avatar { background: var(--primary); color: white; }
        .message-bubble { padding: 0.9rem 1.2rem; border-radius: 18px; line-height: 1.6; word-wrap: break-word; box-shadow: var(--shadow-sm); position: relative; transition: transform 0.2s ease; background-color: var(--light); color: var(--text-primary); border: 1px solid #e9ecef; }
        .chat-message.gemini .message-bubble { border-bottom-left-radius: 5px; }
        .chat-message.user .message-bubble { background: var(--gradient-1); color: white; border: none; border-bottom-right-radius: 5px; }
        .message-bubble code { background-color: rgba(var(--primary-rgb), 0.1); padding: 0.1em 0.3em; border-radius: 4px; font-size: 0.9em; color: var(--secondary); }
        .chat-message.user .message-bubble code { background-color: rgba(255, 255, 255, 0.2); color: #fff; }
        .message-bubble pre { margin: 0.5rem 0; }
        .message-bubble pre code { display: block; background-color: var(--gray-dark); color: #e0e0e0; padding: 0.8rem; border-radius: 6px; font-size: 0.85rem; line-height: 1.5; white-space: pre-wrap; word-wrap: break-word; }
        .chat-message.user .message-bubble pre code { background-color: rgba(0,0,0,0.3); color: #eee; }
        .message-timestamp { font-size: 0.7rem; color: var(--text-muted); margin-top: 5px; display: block; text-align: left; opacity: 0.8; }
        .chat-message.user .message-timestamp { text-align: right; }
        .message-thinking-indicator { background: var(--light); display: flex; align-items: center; padding: 0.9rem 1.2rem; border-radius: 18px; box-shadow: var(--shadow-sm); border: 1px solid #e9ecef; width: fit-content; }
        .typing-dot { width: 7px; height: 7px; background-color: var(--gray); border-radius: 50%; margin: 0 2px; display: inline-block; animation: typing 1.2s infinite ease-in-out; }
        .typing-dot:nth-child(2) { animation-delay: 0.2s; } .typing-dot:nth-child(3) { animation-delay: 0.4s; }
        @keyframes typing { 0%, 60%, 100% { transform: translateY(0); opacity: 0.5; } 30% { transform: translateY(-3px); opacity: 1; } }
        .chat-input { flex-grow: 1; padding: 0.8rem 1.1rem; border: 1px solid var(--gray-light); border-radius: 22px; font-size: 1rem; resize: none; max-height: 150px; overflow-y: auto; transition: border-color 0.2s ease, box-shadow 0.2s ease; line-height: 1.4; }
        .chat-input:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 0 3px rgba(var(--primary-rgb), 0.15); }
        .send-button { padding: 0 1.3rem; border-radius: 22px; font-weight: 500; font-size: 1rem; cursor: pointer; border: none; background: var(--gradient-1); color: white; transition: all 0.3s ease; flex-shrink: 0; height: 44px; display: flex; align-items: center; justify-content: center; }
        .send-button:hover:not(:disabled) { transform: translateY(-2px); box-shadow: 0 4px 10px rgba(var(--primary-rgb), 0.2); }
        .send-button i { font-size: 1.1em; } .send-button .fa-spinner { margin: 0; }
        .chat-controls { padding: 0.5rem 1.25rem; font-size: 0.8rem; color: var(--text-muted); text-align: right; background-color: var(--light); border-top: 1px solid var(--gray-light); flex-shrink: 0; }
        .chat-controls button { background:none; border:none; color: var(--text-muted); cursor:pointer; font-size: 0.9em; padding: 2px 5px; margin-left: 10px; }
        .chat-controls button:hover { color: var(--primary); }

        /* Topic Loading Bar */
        .topic-loading-bar { padding: 1rem 1.5rem; background-color: var(--light); border-bottom: 1px solid var(--gray-light); display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 1rem; flex-shrink: 0; }
        #current-topic-display { font-size: 1rem; font-weight: 500; color: var(--text-secondary); }
        #current-topic-display strong { color: var(--primary); font-weight: 600; }
        #current-topic-display .placeholder { font-style: italic; color: var(--text-muted); }
        #load-next-topic-btn { display: none; } /* Button removed in original */

        /* Utility & State Styles */
        .loading-placeholder { /* ... */ }
        .empty-state { /* ... */ }
        .btn { /* ... */ }
        /* ... (ostatní utility & button styly) ... */

        /* Responsiveness & Mobile Menu */
        .mobile-menu-toggle { /* ... */ }
        .sidebar-overlay { /* ... */ }
        @media (max-width: 1200px) { /* ... */ }
        @media (max-width: 992px) { /* ... */ }
        @media (max-width: 768px) { /* ... */ }
        @media (max-width: 576px) { /* ... */ }

        /* Dark mode Adjustments */
        @media (prefers-color-scheme: dark) {
            :root { /* ... dark mode variables ... */ }
            body { /* ... */ }
            main { /* ... */ }
            .main-header { /* ... */ }
            /* ... Další dark mode pravidla ... */
            .whiteboard-main-container { background-color: var(--call-panel-bg); }
            #drawingCanvas { background-color: var(--call-panel-bg); border-color: var(--gray-light); }
             /* ... zbytek dark mode ... */
        }

        /* Toast notification */
        .toast { /* ... */ }
    </style>
</head>
<body>
    <div id="sidebar-overlay" class="sidebar-overlay"></div>
    <aside id="sidebar" class="sidebar">
        <div class="sidebar-header"> <a href="/" class="sidebar-logo"> <i class="fas fa-calculator"></i> <span>Justax</span> </a> </div>
         <ul class="sidebar-menu"> <li class="sidebar-item"> <a href="/dashboard/dashboard.html" class="sidebar-link"> <i class="fas fa-th-large"></i> <span>Dashboard</span> </a> </li> <li class="sidebar-item"> <a href="/dashboard/procvicovani/main.html" class="sidebar-link active"> <i class="fas fa-book-open"></i> <span>Procvičování</span> </a> </li> <li class="sidebar-item"> <a href="/dashboard/pokrok.html" class="sidebar-link"> <i class="fas fa-chart-line"></i> <span>Pokrok</span> </a> </li> <li class="sidebar-item"> <a href="/dashboard/oceneni.html" class="sidebar-link"> <i class="fas fa-medal"></i> <span>Ocenění</span> </a> </li> <li class="sidebar-item"> <a href="/dashboard/materialy.html" class="sidebar-link"> <i class="fas fa-file-alt"></i> <span>Materiály</span> </a> </li> <li class="sidebar-item"> <a href="/dashboard/profile.html" class="sidebar-link"> <i class="fas fa-user-cog"></i> <span>Profil</span> </a> </li> </ul>
         <div class="user-profile"> <div class="user-avatar" id="user-avatar">?</div> <div class="user-info"> <div class="user-name" id="user-name">Načítání...</div> <div class="user-role">Student</div> </div> </div>
         <div class="sidebar-footer"> &copy; 2025 Justax </div>
    </aside>

    <main>
        <div class="main-header">
             <div class="header-content">
                 <div style="display: flex; align-items: center; gap: 1rem;">
                      <button class="mobile-menu-toggle" id="mobile-menu-toggle"> <i class="fas fa-bars"></i> </button>
                      <h1>Interaktivní výuka</h1>
                 </div>
                 <div class="header-actions">
                      <a href="/dashboard/procvicovani/main.html" class="btn btn-secondary"> <i class="fas fa-times"></i> Ukončit výuku </a>
                 </div>
             </div>
        </div>
        <div class="topic-loading-bar">
             <div id="current-topic-display"><span class="placeholder">Načítám data...</span></div>
        </div>
        <div class="call-interface" style="display: none;">
             <div class="ai-presenter-area">
                 <div class="ai-presenter-header">
                     <div class="ai-avatar-placeholder"> <i class="fas fa-robot"></i> </div>
                     <div class="ai-presenter-info">
                         <h2>AI Tutor Justax</h2>
                         <p id="ai-status-text">Čekání na téma...</p>
                     </div>
                 </div>
                 <div class="whiteboard-main-container">
                     {/* Nahrazeno #tldraw-wrapper Canvasem */}
                     <canvas id="drawingCanvas"></canvas>
                     <div class="canvas-controls" style="display: none;" id="canvas-controls">
                          <button id="clear-canvas-btn" class="btn btn-secondary btn-sm btn-tooltip" title="Vymazat kresbu"> <i class="fas fa-eraser"></i> </button>
                     </div>
                 </div>
             </div>
             <div class="interaction-panel">
                 <div class="interaction-tabs">
                     <div class="interaction-tab active" data-tab="explanation-tab"> <i class="fas fa-chalkboard-teacher"></i> Vysvětlení </div>
                     <div class="interaction-tab" data-tab="chat-tab"> <i class="fas fa-comments"></i> Chat </div>
                 </div>
                 <div class="interaction-content-area">
                     <div id="explanation-tab-content" class="tab-content active">
                         <div class="explanation-scroll-content">
                             <div id="explanation-display"><div class="empty-state"> <i class="fas fa-book-reader"></i> <h3>Výuka připravena</h3> <p>Počkejte na automatické načtení tématu.</p> </div></div>
                         </div>
                         <div class="explanation-controls">
                             <button class="btn btn-primary btn-tooltip" id="next-step-btn" style="display: none;" title="Požádat AI o další krok"> <i class="fas fa-forward"></i> Další krok </button>
                             <button class="btn btn-success btn-tooltip" id="mark-complete-btn" style="display: none;" title="Označit téma jako dokončené"> <i class="fas fa-check-circle"></i> Téma dokončeno </button>
                         </div>
                     </div>
                     <div id="chat-tab-content" class="tab-content">
                         <section class="chat-area" style="display: flex; flex-direction: column; height: 100%;">
                             <div class="chat-messages" id="chat-messages"></div>
                             <div class="chat-input-area">
                                 <textarea class="chat-input" id="chat-input" placeholder="Napiš svou otázku..." rows="1"></textarea>
                                 <button class="send-button" id="send-button" title="Odeslat zprávu"> <i class="fas fa-paper-plane"></i> </button>
                             </div>
                             <div class="chat-controls">
                                 <button id="clear-chat-btn" class="btn-tooltip" title="Vymazat historii tohoto chatu"> <i class="fas fa-trash-alt"></i> Vymazat chat </button> |
                                 <button id="save-chat-btn" class="btn-tooltip" title="Uložit chat jako PDF"> <i class="fas fa-save"></i> Uložit PDF </button>
                             </div>
                         </section>
                     </div>
                 </div>
             </div>
        </div>
    </main>
    <div class="toast" id="toast"> <i class="fas fa-info-circle"></i> <div id="toast-message">Operace úspěšná.</div> </div>

    <script>
        try {
            document.addEventListener('DOMContentLoaded', async function() {
                console.log("DOM Loaded. Initializing application...");

                // --- Constants & Config ---
                const SUPABASE_URL = 'https://qcimhjjwvsbgjsitmvuh.supabase.co';
                const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFjaW1oamp3dnNiZ2pzaXRtdnVoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDI1ODA5MjYsImV4cCI6MjA1ODE1NjkyNn0.OimvRtbXuIUkaIwveOvqbMd_cmPN5yY3DbWCBYc9D10';
                const GEMINI_API_KEY = 'AIzaSyDQboM6qtC_O2sqqpaKZZffNf2zk6HrhEs'; // Test key
                const GEMINI_API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${GEMINI_API_KEY}`;
                const CANVAS_COMMAND_REGEX = /(CLEAR_CANVAS|DRAW_LINE|DRAW_RECT|DRAW_CIRCLE|DRAW_TEXT):\s*```json\s*([\s\S]*?)\s*```/g;

                // --- DOM Elements ---
                const userAvatarEl = document.getElementById('user-avatar');
                const userNameEl = document.getElementById('user-name');
                const mobileMenuToggle = document.getElementById('mobile-menu-toggle');
                const sidebar = document.getElementById('sidebar');
                const sidebarOverlay = document.getElementById('sidebar-overlay');
                const currentTopicDisplay = document.getElementById('current-topic-display');
                const explanationDisplay = document.getElementById('explanation-display');
                const explanationScrollContent = document.querySelector('.explanation-scroll-content');
                const canvasContainer = document.querySelector('.whiteboard-main-container');
                const canvas = document.getElementById('drawingCanvas');
                const canvasControls = document.getElementById('canvas-controls');
                const clearCanvasBtn = document.getElementById('clear-canvas-btn');
                const chatMessages = document.getElementById('chat-messages');
                const chatInput = document.getElementById('chat-input');
                const sendButton = document.getElementById('send-button');
                const saveChatBtn = document.getElementById('save-chat-btn');
                const clearChatBtn = document.getElementById('clear-chat-btn');
                const nextStepBtn = document.getElementById('next-step-btn');
                const markCompleteBtn = document.getElementById('mark-complete-btn');
                const toastEl = document.getElementById('toast');
                const toastMessageEl = document.getElementById('toast-message');
                const interactionTabs = document.querySelectorAll('.interaction-tab');
                const tabContents = document.querySelectorAll('.tab-content');
                const aiStatusText = document.getElementById('ai-status-text');
                const callInterface = document.querySelector('.call-interface');

                // --- Global State ---
                let supabase = null;
                let currentUser = null;
                let currentProfile = null;
                let currentTopic = null;
                let currentPlanId = null;
                let currentSessionId = null;
                let geminiChatContext = [];
                let canvasCtx = null; // Canvas context
                let geminiIsThinking = false;
                let thinkingIndicatorId = null;
                let topicLoadInProgress = false;
                let canvasWidth = 600;
                let canvasHeight = 400;
                let resizeTimeout; // Pro debouncing resize

                // --- Helper Functions ---
                const sanitizeHTML = (str) => { const temp = document.createElement('div'); temp.textContent = str || ''; return temp.innerHTML; };
                const getInitials = (profile, email) => { if (!profile) return email ? email[0].toUpperCase() : '?'; let i = (profile.first_name?.[0]||'')+(profile.last_name?.[0]||''); return i.toUpperCase() || profile.username?.[0].toUpperCase() || email?.[0].toUpperCase() || '?'; };
                const showToast = (message, type = 'info', duration = 4000) => { if (!toastEl || !toastMessageEl) return; toastMessageEl.textContent = message; const icon = toastEl.querySelector('i'); icon.className = 'fas ' + (type === 'success' ? 'fa-check-circle' : type === 'error' ? 'fa-exclamation-circle' : type === 'warning' ? 'fa-exclamation-triangle' : 'fa-info-circle'); toastEl.className = 'toast ' + type; toastEl.classList.add('show'); setTimeout(() => toastEl.classList.remove('show'), duration); };
                const renderMarkdown = (element, markdownText) => { try { if (!element) return; element.innerHTML = marked.parse(markdownText || '', { breaks: true, gfm: true }); if (window.MathJax && typeof window.MathJax.typesetPromise === 'function') { setTimeout(() => window.MathJax.typesetPromise([element]).catch(e=>console.error("MathJax error:",e)), 50); } } catch (e) { console.error("Markdown rendering error:", e); if (element) element.innerHTML = `<p style="color: red;">Chyba zobrazení obsahu.</p>`; }};
                const autoResizeTextarea = () => { if(!chatInput) return; chatInput.style.height = 'auto'; chatInput.style.height = Math.min(chatInput.scrollHeight, 150) + 'px'; };
                const generateSessionId = () => `session_${Date.now()}_${Math.random().toString(36).substring(2, 8)}`;
                const formatTimestamp = (date) => date.toLocaleTimeString('cs-CZ', { hour: '2-digit', minute: '2-digit' });
                const updateAIStatus = (text) => { if (aiStatusText) aiStatusText.textContent = text; };

                // --- Canvas Functions ---
                const initializeCanvas = () => {
                    if (!canvas) { console.error("Canvas element not found!"); return false; }
                    canvasCtx = canvas.getContext('2d');
                    if (!canvasCtx) { console.error("Failed to get 2D context from canvas"); return false; }
                    resizeCanvas(); // Set initial size
                    clearCanvas();
                    console.log("Canvas initialized.");
                    if(canvasControls) canvasControls.style.display = 'flex';
                    return true;
                };

                const debounce = (func, wait) => {
                     let timeout;
                     return function executedFunction(...args) {
                         const later = () => {
                             clearTimeout(timeout);
                             func(...args);
                         };
                         clearTimeout(timeout);
                         timeout = setTimeout(later, wait);
                     };
                 };

                const resizeCanvas = debounce(() => {
                     if (!canvas || !canvasContainer || !canvasCtx) return;
                     const containerStyle = window.getComputedStyle(canvasContainer);
                     const containerWidth = canvasContainer.clientWidth - parseFloat(containerStyle.paddingLeft) - parseFloat(containerStyle.paddingRight);
                     const containerHeight = canvasContainer.clientHeight - parseFloat(containerStyle.paddingTop) - parseFloat(containerStyle.paddingBottom);
                     const aspectRatio = canvasWidth / canvasHeight; // Original aspect ratio (or default)

                     // Calculate new dimensions maintaining aspect ratio
                     let newWidth = containerWidth;
                     let newHeight = containerWidth / aspectRatio;

                     if (newHeight > containerHeight) {
                          newHeight = containerHeight;
                          newWidth = containerHeight * aspectRatio;
                     }

                     // Update internal dimensions used for drawing logic
                     canvasWidth = Math.max(100, Math.floor(newWidth)); // Min width 100
                     canvasHeight = Math.max(100, Math.floor(newHeight)); // Min height 100

                     // Update canvas element dimensions
                     canvas.width = canvasWidth;
                     canvas.height = canvasHeight;
                     // Optional: Style can be set if needed, but width/height attributes are key
                     // canvas.style.width = `${canvasWidth}px`;
                     // canvas.style.height = `${canvasHeight}px`;

                     console.log(`Canvas resized to: ${canvasWidth}x${canvasHeight}`);
                     // Re-draw content if necessary (might be complex with AI commands)
                     // For now, just clear on resize. AI will redraw needed elements.
                     clearCanvas();
                     // Or potentially re-send context to AI? More complex.
                 }, 250); // Debounce resize events

                const clearCanvas = () => {
                    if (!canvasCtx) return;
                    canvasCtx.clearRect(0, 0, canvas.width, canvas.height);
                    console.log("Canvas cleared.");
                };

                const handleCanvasDrawCommand = (command, data) => {
                    if (!canvasCtx) { console.error("Canvas context not available for drawing."); return; }
                    canvasCtx.save(); // Save current state
                    canvasCtx.strokeStyle = data.color || '#000000';
                    canvasCtx.fillStyle = data.fillColor || data.color || '#000000';
                    canvasCtx.lineWidth = data.lineWidth || 1;
                    canvasCtx.font = data.font || '16px Poppins';
                    canvasCtx.textAlign = data.textAlign || 'left';
                    canvasCtx.textBaseline = data.textBaseline || 'top';
                    if (data.lineDash && Array.isArray(data.lineDash)) { canvasCtx.setLineDash(data.lineDash); }

                    try {
                        switch(command) {
                            case 'CLEAR_CANVAS': clearCanvas(); break;
                            case 'DRAW_LINE':
                                if (data.x1 != null && data.y1 != null && data.x2 != null && data.y2 != null) {
                                    canvasCtx.beginPath(); canvasCtx.moveTo(data.x1, data.y1); canvasCtx.lineTo(data.x2, data.y2); canvasCtx.stroke();
                                } else console.warn("DRAW_LINE: Missing coordinates", data);
                                break;
                            case 'DRAW_RECT':
                                if (data.x != null && data.y != null && data.width != null && data.height != null) {
                                    if (data.filled) { canvasCtx.fillRect(data.x, data.y, data.width, data.height); }
                                    else { canvasCtx.strokeRect(data.x, data.y, data.width, data.height); }
                                } else console.warn("DRAW_RECT: Missing properties", data);
                                break;
                            case 'DRAW_CIRCLE':
                                 if (data.x != null && data.y != null && data.radius != null && data.radius > 0) {
                                     canvasCtx.beginPath(); canvasCtx.arc(data.x, data.y, data.radius, 0, Math.PI * 2);
                                     if (data.filled) { canvasCtx.fill(); } else { canvasCtx.stroke(); }
                                 } else console.warn("DRAW_CIRCLE: Missing/invalid properties", data);
                                 break;
                             case 'DRAW_TEXT':
                                 if (data.text != null && data.x != null && data.y != null) {
                                     canvasCtx.fillStyle = data.color || '#000000';
                                     canvasCtx.fillText(data.text, data.x, data.y);
                                 } else console.warn("DRAW_TEXT: Missing properties", data);
                                 break;
                             default: console.warn("Unknown canvas command:", command);
                        }
                    } catch (e) {
                         console.error(`Error executing canvas command ${command}:`, e, data);
                    } finally {
                         canvasCtx.restore(); // Restore previous state (includes lineDash reset)
                    }
                };

                // --- Initialization Functions ---
                const initializeApp = async () => {
                    try {
                        supabase = window.supabase?.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
                        if (!supabase) throw new Error("Supabase client creation failed.");
                        console.log("Supabase client initialized.");
                    } catch (error) { console.error("Supabase initialization failed:", error); showToast("Kritická chyba: Nepodařilo se připojit.", "error"); return; }

                    setupEventListeners();
                    initTooltips();

                    // Initialize Canvas AFTER DOM ready
                    if (!initializeCanvas()) {
                        console.error("Canvas initialization failed!");
                    }

                    await loadUserProfile();
                    if (currentUser) { await loadNextUncompletedTopic(); }
                    else { /* Handle not logged in */ }
                };

                // --- User Profile, Event Listeners, Tooltips ---
                const loadUserProfile = async () => { /* ... */ };
                const updateUserInfoUI = () => { /* ... */ };
                const setupEventListeners = () => {
                     console.log("Setting up event listeners...");
                     if (mobileMenuToggle && sidebar && sidebarOverlay) { mobileMenuToggle.addEventListener('click', () => { sidebar.classList.toggle('active'); sidebarOverlay.classList.toggle('active'); }); sidebarOverlay.addEventListener('click', () => { sidebar.classList.remove('active'); sidebarOverlay.classList.remove('active'); }); }
                     if (interactionTabs.length > 0 && tabContents.length > 0) { interactionTabs.forEach(tab => { tab.addEventListener('click', () => switchInteractionTab(tab.dataset.tab)); }); }
                     if (chatInput && sendButton) { chatInput.addEventListener('input', autoResizeTextarea); chatInput.addEventListener('keydown', (e) => { if (e.key === 'Enter' && !e.shiftKey && !geminiIsThinking) { e.preventDefault(); handleSendMessage(); } }); sendButton.addEventListener('click', () => { if (!geminiIsThinking) handleSendMessage(); }); }
                     if (clearChatBtn) clearChatBtn.addEventListener('click', confirmClearChat);
                     if (saveChatBtn) saveChatBtn.addEventListener('click', saveChatToPDF);
                     if (nextStepBtn) nextStepBtn.addEventListener('click', requestNextStep);
                     if (markCompleteBtn) markCompleteBtn.addEventListener('click', handleMarkTopicComplete);
                     if (clearCanvasBtn) { clearCanvasBtn.addEventListener('click', () => { clearCanvas(); showToast("Kresba vymazána.", "info"); }); }
                     window.addEventListener('resize', resizeCanvas); // Add debounced resize listener
                     window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', clearCanvas); // Optional: Clear canvas on theme change? Or redraw?
                 };
                const initTooltips = () => { /* ... */ };

                // --- Topic Loading and Progress ---
                const loadNextUncompletedTopic = async () => { /* ... */ };
                const handleMarkTopicComplete = async () => { /* ... */ };

                 // --- Learning Session Management ---
                 const startLearningSession = async () => {
                     if (!currentTopic || !currentUser || !supabase) { /* ... */ return; }
                     console.log(`Starting session for: ${currentTopic.name}`);
                     currentSessionId = generateSessionId();
                     updateAIStatus(`Vysvětluje: ${currentTopic.name}`);
                     showLearningUI();
                     explanationDisplay.innerHTML = '<div class="loading-placeholder"><i class="fas fa-spinner fa-spin"></i> Požaduji úvodní vysvětlení...</div>';
                     chatMessages.innerHTML = '';
                     geminiChatContext = [];
                     clearCanvas(); // Clear canvas for new topic
                     updateGeminiThinkingState(true);
                     let initialPrompt = `Začni vysvětlovat ZÁKLADY tématu "${currentTopic.name}" pro studenta 9. třídy ZŠ (přijímačky CERMAT).`;
                     if (currentTopic.description) { initialPrompt += `\nPopis tématu: "${currentTopic.description}".`; }
                     initialPrompt += `\nVysvětluj podrobně, přátelsky, krok za krokem. Toto je PRVNÍ krok. Vhodně použij příklad nebo výzvu k použití KRESLÍCÍ PLOCHY (použij příkazy jako DRAW_LINE, DRAW_TEXT, DRAW_RECT, DRAW_CIRCLE, CLEAR_CANVAS s JSON parametry). Poskytni krátký souhrn pro chat (CHAT_SUMMARY:). Rozměry plátna jsou ${canvasWidth}x${canvasHeight}.`;
                     await sendToGemini(initialPrompt, 'explanation');
                 };
                 const showLearningUI = () => { /* ... */ };
                 const hideLearningUI = () => { /* ... */ };
                 const switchInteractionTab = (tabId) => { /* ... */ };
                 const requestNextStep = async () => { /* ... */ };

                 // --- Chat Functionality ---
                 const addChatMessage = async (message, sender, saveToDb = false, timestamp = new Date()) => {
                     // ... (HTML creation) ...
                     // --- SUPABASE CHAT SAVE (using role/content, conditional activity_id) ---
                     if (saveToDb && supabase && currentUser && currentTopic && currentSessionId) {
                         const dataToSave = { /* ... (stejné jako v předchozí odpovědi) ... */ };
                         console.log("Attempting to save to chat_history:", dataToSave);
                         try { const { error } = await supabase.from('chat_history').insert(dataToSave); if (error) { /* ... */ } else { console.log("Chat message saved."); } } catch (dbError) { /* ... */ }
                     }
                 };
                 const updateGeminiThinkingState = (isThinking) => { /* ... */ };
                 const addThinkingIndicator = () => { /* ... */ };
                 const removeThinkingIndicator = () => { /* ... */ };
                 const handleSendMessage = async () => { /* ... */ };
                 const confirmClearChat = () => { /* ... */ };
                 const clearCurrentChatSessionHistory = async () => { /* ... */ };
                 const saveChatToPDF = async () => { /* ... */ };

                 // --- Gemini Interaction & AI Drawing ---
                 const parseAndProcessCanvasCommands = async (responseText) => {
                    let remainingText = responseText;
                    let match;
                    CANVAS_COMMAND_REGEX.lastIndex = 0;
                    console.log("Parsing for canvas commands...");
                    while ((match = CANVAS_COMMAND_REGEX.exec(responseText)) !== null) {
                        const command = match[1];
                        const jsonString = match[2];
                        console.log(`Found Canvas Command: ${command}`);
                        try {
                            const data = JSON.parse(jsonString);
                            handleCanvasDrawCommand(command, data);
                            remainingText = remainingText.replace(match[0], '').trim();
                        } catch (e) { console.error(`Failed to parse CANVAS JSON for ${command}:`, e, jsonString); }
                    }
                    // No need for await/delay here anymore
                    return remainingText.trim();
                 };

                 const sendToGemini = async (promptText, targetArea) => {
                    if (!GEMINI_API_KEY || !GEMINI_API_KEY.startsWith('AIzaSy')) { /*...*/ return; }
                    if (!currentTopic) { /*...*/ return; }
                    console.log(`Sending (Target: ${targetArea}): "${promptText.substring(0, 100)}..."`);
                    updateAIStatus('Přemýšlím...');
                    const requestTimestamp = new Date();
                    updateGeminiThinkingState(true);

                    // *** UPRAVENÝ SYSTÉMOVÝ PROMPT PRO CANVAS ***
                    const systemInstructionText = `Jsi AI Tutor "Justax", expert na matematiku pro 9. třídu ZŠ v ČR (přijímačky CERMAT). Vyučuješ téma: "${currentTopic.name}"${currentTopic.description ? ` (Popis: "${currentTopic.description}")` : ''}. Tvůj styl je PŘÁTELSKÝ, TRPĚLIVÝ a PODROBNÝ. Vysvětluj krok za krokem, používej příklady. Důsledně používej Markdown a MathJax (blok: $$...$$, inline: \\(...\\)). Odpovídej VŽDY ČESKY.
DŮLEŽITÉ POKYNY:
1. KROK ZA KROKEM: Drž se jednoho konceptu/kroku.
2. INTERAKTIVITA: Pokládej otázky.
3. **KRESLÍCÍ PLOCHA (HTML5 Canvas ${canvasWidth}x${canvasHeight}px):** Pro vizualizaci MŮŽEŠ na KONEC odpovědi přidat JEDEN NEBO VÍCE bloků s příkazy. Formát: \`PŘÍKAZ: \`\`\`json ... \`\`\`\`. Příkazy:
    * \`CLEAR_CANVAS: {}\` - Vymaže plátno.
    * \`DRAW_LINE: {"x1":#, "y1":#, "x2":#, "y2":#, "color":"#RRGGBB", "lineWidth":#}\`
    * \`DRAW_RECT: {"x":#, "y":#, "width":#, "height":#, "color":"#RRGGBB", "lineWidth":#, "filled":false/true}\`
    * \`DRAW_CIRCLE: {"x":#, "y":#, "radius":#, "color":"#RRGGBB", "lineWidth":#, "filled":false/true}\`
    * \`DRAW_TEXT: {"text":"...", "x":#, "y":#, "color":"#RRGGBB", "font":"16px Poppins", "textAlign":"left/center/right"}\`
    Souřadnice [0,0] je levý horní roh. Kresli S MÍROU a přehledně.
4. DÉLKA ODPOVĚDI: Pro "Vysvětlení" podrobně, ale děl kroky. Pro chat stručně.
5. REAKCE NA VSTUP: Reaguj na poslední zprávu nebo požadavek.
6. VÝSTUP DO CHATU (SHRNUTÍ): Pokud je odpověď pro "Vysvětlení", na úplný konec odpovědi (i po kreslení) přidej krátký souhrn pro chat: \`CHAT_SUMMARY: [Zde tvůj souhrn]\`. Jinak CHAT_SUMMARY nepřidávej.`;

                    // ... (zbytek sendToGemini - sestavení requestu, fetch, error handling) ...
                     const historyForApi = geminiChatContext.length > 0 ? geminiChatContext.filter(item => item.role === 'user' || item.role === 'model') : [];
                     const currentRequestContent = { role: "user", parts: [{ text: promptText }] };
                     const contentsPayload = historyForApi.length === 0
                         ? [{ role: "user", parts: [{ text: systemInstructionText + "\n\n---\n\nStudent: " + promptText }] }]
                         : [...historyForApi, currentRequestContent];
                     const requestBody = { contents: contentsPayload, generationConfig: { temperature: 0.6, topP: 0.95, topK: 40, maxOutputTokens: 4096 }, safetySettings: [ { category: "HARM_CATEGORY_HARASSMENT", threshold: "BLOCK_NONE" }, { category: "HARM_CATEGORY_HATE_SPEECH", threshold: "BLOCK_NONE" }, { category: "HARM_CATEGORY_SEXUALLY_EXPLICIT", threshold: "BLOCK_NONE" }, { category: "HARM_CATEGORY_DANGEROUS_CONTENT", threshold: "BLOCK_NONE" } ] };
                     try {
                         const response = await fetch(GEMINI_API_URL, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(requestBody) });
                         if (!response.ok) { /*...*/ throw new Error(`API Error (${response.status})`); }
                         const data = await response.json();
                         const candidate = data.candidates?.[0];
                         if (!candidate) { /*...*/ throw new Error('Invalid AI response.'); }
                         if (candidate.finishReason && !["STOP", "MAX_TOKENS"].includes(candidate.finishReason)) { /*...*/ throw new Error(`Generation stopped: ${candidate.finishReason}`); }
                         const geminiResponseText = candidate.content?.parts?.[0]?.text;
                         if (!geminiResponseText) { throw new Error('AI returned empty text.'); }
                         geminiChatContext.push({ role: "model", parts: [{ text: geminiResponseText }] });
                         await processGeminiResponse(geminiResponseText, targetArea, requestTimestamp); // Process the response
                         updateAIStatus(currentTopic ? `Vysvětluje: ${currentTopic.name}` : 'Připraven');
                     } catch (error) { /*...*/ } finally { updateGeminiThinkingState(false); }
                 };

                 const processGeminiResponse = async (rawResponseText, targetArea, timestamp) => {
                     removeThinkingIndicator();
                     let chatSummary = null;
                     const summaryMatch = rawResponseText.match(/CHAT_SUMMARY:\s*(.*)/s);
                     let textForProcessing = rawResponseText;
                     if (summaryMatch && summaryMatch[1]) { chatSummary = summaryMatch[1].trim(); textForProcessing = rawResponseText.replace(/CHAT_SUMMARY:[\s\S]*/, '').trim(); }

                     // Process Canvas commands first
                     const textToDisplay = await parseAndProcessCanvasCommands(textForProcessing);

                     // Display text content
                     if (targetArea === 'explanation') {
                         const placeholder = explanationDisplay.querySelector('.loading-placeholder, .empty-state');
                         if (placeholder) placeholder.remove();
                         if (explanationDisplay.querySelectorAll('.step').length === 0 && (explanationDisplay.innerHTML.includes('Výuka připravena') || explanationDisplay.innerHTML.includes('Čekání'))) { explanationDisplay.innerHTML = ''; }
                         const stepDiv = document.createElement('div'); stepDiv.className = 'step'; renderMarkdown(stepDiv, textToDisplay); explanationDisplay.appendChild(stepDiv);
                         if(explanationScrollContent) { /* scroll */ }
                         if (chatSummary) { await addChatMessage(chatSummary, 'gemini', true, timestamp); }
                         else if (textToDisplay.trim()) { await addChatMessage(`AI pokračovala ve vysvětlení...`, 'gemini', false, timestamp); }
                         if (nextStepBtn) nextStepBtn.style.display = 'inline-flex';
                         if (markCompleteBtn) markCompleteBtn.style.display = 'inline-flex';
                     } else {
                         if (textToDisplay.trim()) { await addChatMessage(textToDisplay, 'gemini', true, timestamp); }
                         else { await addChatMessage("(Odpověď AI byla prázdná)", 'gemini', false, timestamp); }
                     }
                 };

                 const handleGeminiError = (errorMessage, targetArea, timestamp) => { /* ... */ };

                // --- Run Application ---
                initializeApp();

            }); // End DOMContentLoaded
        } catch (e) {
            // --- Fatal Error Handling ---
            console.error("FATAL SCRIPT ERROR:", e);
             document.body.innerHTML = `<div style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: #fff5f5; color: #d00; padding: 40px; font-family: sans-serif; text-align: center; z-index: 9999;"><h1>FATÁLNÍ CHYBA SKRIPTU</h1><p>Omlouváme se, ale aplikace nemohla být spuštěna kvůli závažné chybě.</p><p>Zkuste prosím obnovit stránku (F5). Pokud problém přetrvává, kontaktujte podporu.</p><hr style="margin: 20px 0; border-color: #fcc;"><pre style="text-align: left; background-color: #ffeaea; padding: 15px; border-radius: 5px; overflow-x: auto; font-size: 0.8em;">${e.message}\n${e.stack}</pre></div>`;
        }
    </script>

</body>
</html>