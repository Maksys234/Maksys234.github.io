<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Justax - Ocenění</title>
    <!-- Připojení fontů -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Font Awesome CDN -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Supabase JS client -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <style>
        /* Bazové styly */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
        }

        :root {
            --primary: #4361ee;
            --primary-light: #4895ef;
            --secondary: #3f37c9;
            --success: #4cc9f0;
            --danger: #f72585;
            --warning: #f8961e;
            --info: #4895ef;
            --dark: #1e2a3a;
            --light: #f8f9fa;
            --gray: #6c757d;
            --gray-light: #dee2e6;
            --gray-dark: #343a40;
            --gradient-1: linear-gradient(135deg, #4361ee, #3a0ca3);
            --gradient-2: linear-gradient(135deg, #4cc9f0, #4361ee);
            --gradient-3: linear-gradient(135deg, #f72585, #7209b7);
            --gradient-4: linear-gradient(135deg, #f8961e, #f3722c);
            --white: #ffffff;
            --sidebar-width: 260px;
            --transition-speed: 0.3s;
            --card-radius: 16px;
            --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.05);
            --shadow-md: 0 5px 15px rgba(0, 0, 0, 0.07);
            --shadow-lg: 0 10px 25px rgba(0, 0, 0, 0.1);
            --text-primary: #2d3748;
            --text-secondary: #4a5568;
            --text-muted: #718096;
        }

        body {
            background-color: #f6f8ff;
            color: var(--text-primary);
            min-height: 100vh;
            display: flex;
            overflow-x: hidden;
        }

        /* Sidebar */
        .sidebar {
            width: var(--sidebar-width);
            height: 100vh;
            position: fixed;
            top: 0;
            left: 0;
            background: var(--gradient-1);
            color: var(--white);
            padding: 1.5rem 1rem;
            display: flex;
            flex-direction: column;
            z-index: 100;
            box-shadow: var(--shadow-lg);
            transition: all var(--transition-speed) ease;
        }

        .sidebar-header {
            display: flex;
            align-items: center;
            margin-bottom: 2rem;
            padding: 0 0.75rem;
        }

        .sidebar-logo {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--white);
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .sidebar-logo i {
            font-size: 1.75rem;
        }

        .sidebar-menu {
            list-style: none;
            padding: 0;
            margin: 0;
            flex-grow: 1;
        }

        .sidebar-item {
            margin-bottom: 0.5rem;
        }

        .sidebar-link {
            display: flex;
            align-items: center;
            padding: 0.75rem 1rem;
            color: rgba(255, 255, 255, 0.85);
            text-decoration: none;
            border-radius: 12px;
            transition: all 0.2s ease;
            font-weight: 500;
        }

        .sidebar-link i {
            margin-right: 0.75rem;
            font-size: 1.2rem;
            width: 24px;
            text-align: center;
        }

        .sidebar-link.active, .sidebar-link:hover {
            background-color: rgba(255, 255, 255, 0.15);
            color: var(--white);
        }

        .sidebar-footer {
            margin-top: auto;
            padding: 1rem;
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.7);
            text-align: center;
        }

        .user-profile {
            display: flex;
            align-items: center;
            padding: 1rem;
            margin-top: 1rem;
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--primary-light);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 0.75rem;
            font-weight: 500;
            overflow: hidden;
        }

        .user-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .user-info {
            flex-grow: 1;
        }

        .user-name {
            font-weight: 600;
            font-size: 0.95rem;
        }

        .user-role {
            font-size: 0.8rem;
            opacity: 0.8;
        }

        /* Hlavní obsah */
        main {
            flex: 1;
            margin-left: var(--sidebar-width);
            padding: 1.5rem 2rem;
            transition: margin var(--transition-speed) ease;
            width: calc(100% - var(--sidebar-width));
        }

        .dashboard-header {
            margin-bottom: 2rem;
            background-color: var(--white);
            border-radius: var(--card-radius);
            padding: 1.25rem 1.5rem;
            box-shadow: var(--shadow-sm);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-content h1 {
            font-size: 1.75rem;
            font-weight: 600;
            color: var(--dark);
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 1.5rem;
        }

        .search-box {
            position: relative;
        }

        .search-box input {
            width: 280px;
            height: 44px;
            border-radius: 22px;
            padding: 0 1rem 0 2.5rem;
            border: 1px solid var(--gray-light);
            background-color: var(--light);
            outline: none;
            transition: all 0.2s ease;
            font-size: 0.95rem;
        }

        .search-box input:focus {
            border-color: var(--primary-light);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.15);
        }

        .search-box i {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--gray);
        }

        .notifications {
            position: relative;
            cursor: pointer;
        }

        .notifications i {
            font-size: 1.4rem;
            color: var(--gray-dark);
        }

        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            width: 20px;
            height: 20px;
            background-color: var(--danger);
            color: white;
            font-size: 0.7rem;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
        }

        /* Hlavní obsah */
        .main-content {
            display: grid;
            gap: 1.75rem;
        }

        .section-title {
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 1.25rem;
            color: var(--dark);
        }

        /* Sekce statistik */
        .achievement-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background-color: var(--white);
            border-radius: var(--card-radius);
            box-shadow: var(--shadow-sm);
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-md);
        }

        .stat-card-content {
            display: flex;
            padding: 1.5rem;
            align-items: center;
            justify-content: space-between;
        }

        .stat-card-info {
            flex-grow: 1;
        }

        .stat-card-title {
            font-size: 1rem;
            font-weight: 500;
            color: var(--text-secondary);
            margin-bottom: 0.75rem;
        }

        .stat-card-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--dark);
            margin-bottom: 0.5rem;
        }

        .stat-card-change {
            font-size: 0.85rem;
            color: var(--text-muted);
        }

        .stat-card-change.positive {
            color: #10b981;
        }

        .stat-card-change.negative {
            color: var(--danger);
        }

        .stat-card-icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: var(--white);
        }

        .badges-icon {
            background: linear-gradient(135deg, #4cc9f0, #4361ee);
        }

        .rank-icon {
            background: linear-gradient(135deg, #f72585, #b5179e);
        }

        .points-icon {
            background: linear-gradient(135deg, #f8961e, #f3722c);
        }

        .streak-icon {
            background: linear-gradient(135deg, #0077b6, #0096c7);
        }

        /* Sekce odznaků */
        .badges-section {
            margin-bottom: 2rem;
        }

        .badge-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 1.5rem;
        }

        .badge-card {
            background-color: var(--white);
            border-radius: var(--card-radius);
            padding: 1.5rem 1rem;
            box-shadow: var(--shadow-sm);
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .badge-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-md);
        }

        .badge-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: var(--gradient-2);
            z-index: 1;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .badge-card:hover::before {
            opacity: 1;
        }

        .badge-icon {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.75rem;
            margin-bottom: 1rem;
            color: var(--white);
            position: relative;
        }

        .badge-icon::after {
            content: '';
            position: absolute;
            top: -5px;
            right: -5px;
            bottom: -5px;
            left: -5px;
            border-radius: 50%;
            background: inherit;
            filter: blur(8px);
            opacity: 0.3;
            z-index: -1;
            transition: opacity 0.3s ease;
        }

        .badge-card:hover .badge-icon::after {
            opacity: 0.5;
        }

        .badge-icon.math {
            background: linear-gradient(135deg, #4cc9f0, #4361ee);
        }

        .badge-icon.lang {
            background: linear-gradient(135deg, #f72585, #b5179e);
        }

        .badge-icon.special {
            background: linear-gradient(135deg, #f8961e, #f3722c);
        }

        .badge-icon.streak {
            background: linear-gradient(135deg, #0077b6, #0096c7);
        }

        .badge-title {
            font-size: 0.95rem;
            font-weight: 600;
            color: var(--dark);
            margin-bottom: 0.5rem;
        }

        .badge-desc {
            font-size: 0.8rem;
            color: var(--text-secondary);
            margin-bottom: 0.75rem;
        }

        .badge-date {
            font-size: 0.75rem;
            color: var(--text-muted);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .badge-date i {
            font-size: 0.7rem;
        }

        /* Sekce dostupných odznaků */
        .available-achievements {
            margin-bottom: 2rem;
        }

        .achievement-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .achievement-card {
            background-color: var(--white);
            border-radius: var(--card-radius);
            padding: 1.5rem;
            box-shadow: var(--shadow-sm);
            display: flex;
            align-items: center;
            gap: 1.25rem;
            transition: all 0.3s ease;
        }

        .achievement-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-md);
        }

        .achievement-card.locked {
            opacity: 0.7;
        }

        .achievement-card.locked:hover {
            opacity: 0.9;
        }

        .achievement-icon {
            width: 60px;
            height: 60px;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: var(--white);
            flex-shrink: 0;
        }

        .achievement-card.locked .achievement-icon {
            background: linear-gradient(135deg, #cbd5e0, #a0aec0);
        }

        .achievement-content {
            flex-grow: 1;
        }

        .achievement-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--dark);
            margin-bottom: 0.5rem;
        }

        .achievement-desc {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-bottom: 0.75rem;
        }

        .progress-bar {
            height: 8px;
            background-color: #f0f0f0;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 0.5rem;
        }

        .progress-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 1s ease;
        }

        .progress-fill.math {
            background: linear-gradient(to right, #4cc9f0, #4361ee);
        }

        .progress-fill.lang {
            background: linear-gradient(to right, #f72585, #b5179e);
        }

        .progress-fill.special {
            background: linear-gradient(to right, #f8961e, #f3722c);
        }

        .progress-fill.streak {
            background: linear-gradient(to right, #0077b6, #0096c7);
        }

        .progress-stats {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        /* Tabulka porovnání */
        .leaderboard-section {
            margin-bottom: 2rem;
        }

        .leaderboard {
            background-color: var(--white);
            border-radius: var(--card-radius);
            box-shadow: var(--shadow-sm);
            overflow: hidden;
        }

        .leaderboard-header {
            padding: 1.25rem 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--gray-light);
        }

        .leaderboard-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--dark);
        }

        .leaderboard-filter {
            display: flex;
            gap: 0.75rem;
        }

        .filter-btn {
            padding: 0.5rem 1rem;
            background-color: var(--light);
            border: 1px solid var(--gray-light);
            border-radius: 8px;
            font-size: 0.85rem;
            font-weight: 500;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .filter-btn:hover {
            background-color: var(--primary-light);
            color: var(--white);
            border-color: var(--primary-light);
        }

        .filter-btn.active {
            background-color: var(--primary);
            color: var(--white);
            border-color: var(--primary);
        }

        .leaderboard-table {
            width: 100%;
            border-collapse: collapse;
        }

        .leaderboard-table th {
            padding: 1rem 1.5rem;
            text-align: left;
            color: var(--text-secondary);
            font-weight: 500;
            font-size: 0.9rem;
            border-bottom: 1px solid var(--gray-light);
        }

        .leaderboard-table td {
            padding: 1rem 1.5rem;
            border-bottom: 1px solid var(--gray-light);
            font-size: 0.95rem;
        }

        .leaderboard-table tr:last-child td {
            border-bottom: none;
        }

        .leaderboard-table tr:hover {
            background-color: #f8faff;
        }

        .rank-cell {
            font-weight: 600;
            color: var(--dark);
            width: 60px;
        }

        .user-cell {
            display: flex;
            align-items: center;
            gap: 1rem;
            width: 40%;
        }

        .user-avatar-sm {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background-color: var(--primary-light);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--white);
            font-weight: 500;
            font-size: 0.9rem;
            overflow: hidden;
        }

        .user-avatar-sm img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .user-info-sm {
            display: flex;
            flex-direction: column;
        }

        .user-name-sm {
            font-weight: 500;
            color: var(--dark);
        }

        .user-level {
            font-size: 0.8rem;
            color: var(--text-muted);
        }

        .score-cell {
            font-weight: 600;
            color: var(--primary);
        }

        .badge-count-cell {
            color: var(--text-secondary);
        }

        .highlight-row {
            background-color: rgba(67, 97, 238, 0.05);
        }

        .highlight-row:hover {
            background-color: rgba(67, 97, 238, 0.1) !important;
        }

        .rank-indicator {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .rank-indicator i {
            font-size: 0.85rem;
        }

        .rank-up {
            color: #10b981;
        }

        .rank-down {
            color: var(--danger);
        }

        .rank-same {
            color: var(--gray);
        }

        /* Nedávné odznaky */
        .recent-achievements {
            background-color: var(--white);
            border-radius: var(--card-radius);
            box-shadow: var(--shadow-sm);
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        .achievements-list {
            margin-top: 1.25rem;
        }

        .achievement-item {
            display: flex;
            align-items: flex-start;
            padding: 1rem 0;
            border-bottom: 1px solid var(--gray-light);
            animation: fadeIn 0.5s ease forwards;
            opacity: 0;
        }

        .achievement-item:last-child {
            border-bottom: none;
        }

        .achievement-item-icon {
            width: 45px;
            height: 45px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            color: var(--white);
            margin-right: 1rem;
            flex-shrink: 0;
        }

        .achievement-item-content {
            flex-grow: 1;
        }

        .achievement-item-title {
            font-size: 1rem;
            font-weight: 500;
            color: var(--dark);
            margin-bottom: 0.25rem;
        }

        .achievement-item-desc {
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-bottom: 0.25rem;
        }

        .achievement-item-time {
            font-size: 0.8rem;
            color: var(--text-muted);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        /* Patička */
        .dashboard-footer {
            margin-top: 2rem;
            padding: 1.5rem 0;
            text-align: center;
            color: var(--text-muted);
            font-size: 0.9rem;
        }

        /* Indikátor načítání */
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 2rem;
            font-size: 1rem;
            color: var(--text-muted);
        }

        .loading::after {
            content: "";
            width: 20px;
            height: 20px;
            margin-left: 15px;
            border: 2px solid var(--primary);
            border-radius: 50%;
            border-top-color: transparent;
            animation: loading-spinner 0.8s linear infinite;
        }

        @keyframes loading-spinner {
            to {
                transform: rotate(360deg);
            }
        }

        /* Chybové hlášky */
        .error-message {
            background-color: #fff2f5;
            border-left: 4px solid var(--danger);
            color: var(--danger);
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 8px;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
        }

        .error-message i {
            margin-right: 0.75rem;
            font-size: 1.25rem;
        }

        .error-container {
            display: none;
            margin-bottom: 1.5rem;
        }

        .retry-button {
            background-color: var(--primary);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 0.5rem 1rem;
            font-size: 0.9rem;
            cursor: pointer;
            margin-top: 0.5rem;
            transition: all 0.2s ease;
        }

        .retry-button:hover {
            background-color: var(--secondary);
        }

        /* Prázdný stav */
        .empty-state {
            padding: 3rem 2rem;
            text-align: center;
            background-color: var(--white);
            border-radius: var(--card-radius);
            box-shadow: var(--shadow-sm);
        }

        .empty-state-icon {
            font-size: 3rem;
            color: var(--gray-light);
            margin-bottom: 1.5rem;
        }

        .empty-state-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--dark);
            margin-bottom: 0.75rem;
        }

        .empty-state-desc {
            font-size: 0.95rem;
            color: var(--text-secondary);
            max-width: 500px;
            margin: 0 auto 1.5rem auto;
            line-height: 1.6;
        }

        .empty-state-action {
            display: inline-block;
            padding: 0.75rem 1.5rem;
            background: var(--gradient-1);
            color: var(--white);
            font-weight: 500;
            border-radius: 10px;
            text-decoration: none;
            transition: all 0.3s ease;
            box-shadow: var(--shadow-sm);
        }

        .empty-state-action:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-md);
        }

        /* Media queries pro responzivní design */
        @media (max-width: 1200px) {
            .achievement-stats {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .badge-grid {
                grid-template-columns: repeat(auto-fill, minmax(130px, 1fr));
            }
        }

        @media (max-width: 992px) {
            :root {
                --sidebar-width: 80px;
            }
            
            .sidebar-logo span, .sidebar-link span, .user-info, .sidebar-footer {
                display: none;
            }
            
            .sidebar-link i {
                margin-right: 0;
                font-size: 1.5rem;
            }
            
            .sidebar-logo i {
                margin-right: 0;
            }
            
            .sidebar-header, .sidebar-link {
                justify-content: center;
            }
            
            .user-profile {
                justify-content: center;
                padding: 0.75rem;
            }
            
            .user-avatar {
                margin-right: 0;
            }
            
            .search-box input {
                width: 200px;
            }
            
            .leaderboard-table .user-level,
            .leaderboard-table .badge-count-cell {
                display: none;
            }
        }

        @media (max-width: 768px) {
            main {
                padding: 1rem;
            }
            
            .header-content {
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
            }
            
            .header-actions {
                width: 100%;
                justify-content: space-between;
            }
            
            .search-box input {
                width: 100%;
            }
            
            .achievement-stats {
                grid-template-columns: 1fr;
            }
            
            .achievement-grid {
                grid-template-columns: 1fr;
            }
            
            .leaderboard-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
            }
            
            .leaderboard-filter {
                width: 100%;
                justify-content: space-between;
            }
            
            .leaderboard-table th:nth-child(4),
            .leaderboard-table td:nth-child(4) {
                display: none;
            }
        }

        @media (max-width: 576px) {
            :root {
                --sidebar-width: 0;
            }
            
            .sidebar {
                transform: translateX(-100%);
            }
            
            main {
                margin-left: 0;
                width: 100%;
            }
            
            .search-box {
                display: none;
            }
            
            .mobile-menu-toggle {
                display: block;
            }
            
            .badge-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .user-cell {
                width: 60%;
            }
        }

        /* Animace */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .animated {
            animation: fadeIn 0.5s ease forwards;
        }

        .delay-1 {
            animation-delay: 0.1s;
        }

        .delay-2 {
            animation-delay: 0.2s;
        }

        .delay-3 {
            animation-delay: 0.3s;
        }

        .delay-4 {
            animation-delay: 0.4s;
        }

        /* Temný režim */
        @media (prefers-color-scheme: dark) {
            :root {
                --white: #1a202c;
                --light: #2d3748;
                --dark: #e2e8f0;
                --gray-light: #4a5568;
                --text-primary: #e2e8f0;
                --text-secondary: #cbd5e0;
                --text-muted: #a0aec0;
            }
            
            body {
                background-color: #171923;
            }
            
            .search-box input {
                background-color: #2d3748;
                color: var(--text-primary);
                border-color: #4a5568;
            }
            
            .search-box i {
                color: #a0aec0;
            }
            
            .leaderboard-table tr:hover {
                background-color: #1e2533;
            }
            
            .progress-bar {
                background-color: #2d3748;
            }
            
            .empty-state-icon {
                color: #4a5568;
            }
        }
    </style>
</head>
<body>
    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="sidebar-header">
            <a href="/" class="sidebar-logo">
                <i class="fas fa-calculator"></i>
                <span>Justax</span>
            </a>
        </div>
        
        <ul class="sidebar-menu">
            <li class="sidebar-item">
                <a href="/dashboard.html" class="sidebar-link" id="dashboard-link">
                    <i class="fas fa-th-large"></i>
                    <span>Dashboard</span>
                </a>
            </li>
            <li class="sidebar-item">
                <a href="/dashboard/procvicovani/profile" class="sidebar-link">
                    <i class="fas fa-book-open"></i>
                    <span>Procvičování</span>
                </a>
            </li>
            <li class="sidebar-item">
                <a href="/dashboard/pokrok.html" class="sidebar-link">
                    <i class="fas fa-chart-line"></i>
                    <span>Pokrok</span>
                </a>
            </li>
            <li class="sidebar-item">
                <a href="/dashboard/oceneni.html" class="sidebar-link active">
                    <i class="fas fa-medal"></i>
                    <span>Ocenění</span>
                </a>
            </li>
            <li class="sidebar-item">
                <a href="/dashboard/materialy.html" class="sidebar-link">
                    <i class="fas fa-file-alt"></i>
                    <span>Materiály</span>
                </a>
            </li>
            <li class="sidebar-item">
                <a href="/dashboard/profile.html" class="sidebar-link">
                    <i class="fas fa-user-cog"></i>
                    <span>Profil</span>
                </a>
            </li>
        </ul>
        
        <div class="user-profile">
            <div class="user-avatar" id="sidebar-user-avatar">MS</div>
            <div class="user-info">
                <div class="user-name" id="sidebar-user-name">Načítání...</div>
                <div class="user-role" id="sidebar-user-role">Student</div>
            </div>
        </div>
        
        <div class="sidebar-footer">
            &copy; 2025 Justax
        </div>
    </aside>
    
    <main>
        <!-- Globální chybový kontejner -->
        <div class="error-container" id="global-error">
            <div class="error-message">
                <i class="fas fa-exclamation-circle"></i>
                <div>
                    <div id="global-error-message">Došlo k chybě při načítání dat.</div>
                    <button class="retry-button" id="global-retry-btn">Zkusit znovu</button>
                </div>
            </div>
        </div>

        <header class="dashboard-header">
            <div class="header-content">
                <h1>Ocenění a odznaky</h1>
                <div class="header-actions">
                    <div class="search-box">
                        <i class="fas fa-search"></i>
                        <input type="text" placeholder="Hledat odznaky...">
                    </div>
                    <div class="notifications">
                        <i class="fas fa-bell"></i>
                        <span class="notification-badge" id="notification-count">0</span>
                    </div>
                </div>
            </div>
        </header>
        
        <!-- Načítací indikátor -->
        <div id="achievements-loading" class="loading">Načítání ocenění a odznaků</div>
        
        <!-- Hlavní obsah -->
        <div id="achievements-content" style="display: none;">
            <section class="main-content">
                <!-- Statistiky odznaků -->
                <div class="achievement-stats animated delay-1">
                    <div class="stat-card">
                        <div class="stat-card-content">
                            <div class="stat-card-info">
                                <div class="stat-card-title">Získané odznaky</div>
                                <div class="stat-card-value" id="badges-count">0</div>
                                <div class="stat-card-change positive" id="badges-change">+0 za posledních 30 dní</div>
                            </div>
                            <div class="stat-card-icon badges-icon">
                                <i class="fas fa-medal"></i>
                            </div>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-card-content">
                            <div class="stat-card-info">
                                <div class="stat-card-title">Bodový zisk</div>
                                <div class="stat-card-value" id="points-count">0</div>
                                <div class="stat-card-change positive" id="points-change">+0 za posledních 30 dní</div>
                            </div>
                            <div class="stat-card-icon points-icon">
                                <i class="fas fa-star"></i>
                            </div>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-card-content">
                            <div class="stat-card-info">
                                <div class="stat-card-title">Série dnů</div>
                                <div class="stat-card-value" id="streak-days">0</div>
                                <div class="stat-card-change" id="streak-change">Nejdelší série: 0 dnů</div>
                            </div>
                            <div class="stat-card-icon streak-icon">
                                <i class="fas fa-fire"></i>
                            </div>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-card-content">
                            <div class="stat-card-info">
                                <div class="stat-card-title">Pořadí</div>
                                <div class="stat-card-value" id="rank-value">-</div>
                                <div class="stat-card-change" id="rank-change">Z celkových <span id="total-users">0</span> uživatelů</div>
                            </div>
                            <div class="stat-card-icon rank-icon">
                                <i class="fas fa-trophy"></i>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Sekce odznaků -->
                <section class="badges-section animated delay-2">
                    <h2 class="section-title">Vaše odznaky</h2>
                    
                    <div id="user-badges-container">
                        <!-- Prázdný stav - bude skrytý, pokud jsou odznaky -->
                        <div class="empty-state" id="empty-badges" style="display: none;">
                            <div class="empty-state-icon">
                                <i class="fas fa-medal"></i>
                            </div>
                            <h3 class="empty-state-title">Zatím nemáte žádné odznaky</h3>
                            <p class="empty-state-desc">
                                Začněte procvičovat a plnit zadané úkoly, abyste získali své první odznaky.
                                Odznaky jsou udělovány za dokončení cvičení, pravidelné procvičování a dosažení výsledků.
                            </p>
                            <a href="/dashboard/procvicovani.html" class="empty-state-action">
                                <i class="fas fa-book-open"></i> Začít procvičovat
                            </a>
                        </div>
                        
                        <!-- Grid s odznaky -->
                        <div class="badge-grid" id="badge-grid">
                            <!-- Zde budou dynamicky načtené odznaky uživatele -->
                        </div>
                    </div>
                </section>
                
                <!-- Dostupné odznaky -->
                <section class="available-achievements animated delay-3">
                    <h2 class="section-title">Dostupné odznaky</h2>
                    
                    <div class="achievement-grid" id="available-badges-grid">
                        <!-- Zde budou dynamicky načtené dostupné odznaky -->
                    </div>
                </section>
                
                <!-- Nedávno získané odznaky -->
                <section class="recent-achievements animated delay-4" id="recent-achievements-section">
                    <h2 class="section-title">Nedávno získané odznaky</h2>
                    
                    <div class="achievements-list" id="recent-achievements-list">
                        <!-- Zde budou dynamicky načtené nedávno získané odznaky -->
                    </div>
                </section>
                
                <!-- Tabulka uživatelů -->
                <section class="leaderboard-section animated delay-4">
                    <h2 class="section-title">Žebříček uživatelů</h2>
                    
                    <div class="leaderboard">
                        <div class="leaderboard-header">
                            <div class="leaderboard-title">Nejlepší uživatelé</div>
                            <div class="leaderboard-filter">
                                <button class="filter-btn active" data-filter="points">Body</button>
                                <button class="filter-btn" data-filter="badges">Odznaky</button>
                                <button class="filter-btn" data-filter="streak">Série</button>
                            </div>
                        </div>
                        
                        <table class="leaderboard-table">
                            <thead>
                                <tr>
                                    <th>Pořadí</th>
                                    <th>Uživatel</th>
                                    <th id="score-header">Body</th>
                                    <th>Odznaky</th>
                                </tr>
                            </thead>
                            <tbody id="leaderboard-body">
                                <!-- Zde budou dynamicky načtení uživatelé z leaderboardu -->
                            </tbody>
                        </table>
                    </div>
                </section>
            </section>
        </div>
        
        <footer class="dashboard-footer">
            <p>&copy; 2025 Justax. Všechna práva vyhrazena.</p>
        </footer>
    </main>
    
    <script>
        // Konfigurace Supabase
        const SUPABASE_URL = 'https://qcimhjjwvsbgjsitmvuh.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFjaW1oamp3dnNiZ2pzaXRtdnVoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDI1ODA5MjYsImV4cCI6MjA1ODE1NjkyNn0.OimvRtbXuIUkaIwveOvqbMd_cmPN5yY3DbWCBYc9D10';
        
        // Inicializace Supabase klienta - SPRÁVNĚ!
        const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
        
        // Globální proměnné
        let currentUser = null;
        let userProfile = null;
        let userBadges = [];
        let allBadges = [];
        let leaderboardData = {
            points: [],
            badges: [],
            streak: []
        };
        let currentLeaderboardFilter = 'points';
        
        // Pomocné funkce
        function showError(message) {
            const errorContainer = document.getElementById('global-error');
            const errorMessage = document.getElementById('global-error-message');
            errorMessage.textContent = message;
            errorContainer.style.display = 'block';
        }
        
        function hideError() {
            const errorContainer = document.getElementById('global-error');
            errorContainer.style.display = 'none';
        }
        
        function showLoading() {
            document.getElementById('achievements-loading').style.display = 'flex';
            document.getElementById('achievements-content').style.display = 'none';
        }
        
        function hideLoading() {
            document.getElementById('achievements-loading').style.display = 'none';
            document.getElementById('achievements-content').style.display = 'block';
        }
        
        function getInitials(firstName, lastName) {
            if (!firstName && !lastName) return '?';
            
            let initials = '';
            if (firstName) initials += firstName.charAt(0).toUpperCase();
            if (lastName) initials += lastName.charAt(0).toUpperCase();
            
            return initials;
        }
        
        function formatDate(dateString) {
            if (!dateString) return '';
            
            const date = new Date(dateString);
            const day = date.getDate().toString().padStart(2, '0');
            const month = (date.getMonth() + 1).toString().padStart(2, '0');
            const year = date.getFullYear();
            
            return `${day}.${month}.${year}`;
        }
        
        function getIconClass(type) {
            switch (type) {
                case 'math': return 'fas fa-square-root-alt';
                case 'language': return 'fas fa-language';
                case 'streak': return 'fas fa-fire';
                case 'special': return 'fas fa-star';
                default: return 'fas fa-medal';
            }
        }
        
        function getBadgeClass(type) {
            switch (type) {
                case 'math': return 'math';
                case 'language': return 'lang';
                case 'streak': return 'streak';
                case 'special': return 'special';
                default: return 'math';
            }
        }
        
        // Kontrola přihlášení a načtení dat
        async function checkAuth() {
            try {
                const { data: { user }, error } = await supabaseClient.auth.getUser();
                
                if (error) throw error;
                
                if (user) {
                    currentUser = user;
                    await loadUserProfile();
                    await loadBadges();
                    await loadUserBadges();
                    await loadLeaderboard();
                    updateUI();
                } else {
                    // Uživatel není přihlášen, přesměrovat na přihlášení
                    window.location.href = '/login.html';
                }
            } catch (error) {
                console.error('Chyba při kontrole přihlášení:', error);
                showError('Nepodařilo se ověřit přihlášení. Prosím, zkuste to znovu.');
                hideLoading();
            }
        }
        
        // Načtení profilu uživatele
        async function loadUserProfile() {
            try {
                const { data, error } = await supabaseClient
                    .from('profiles')
                    .select('*')
                    .eq('id', currentUser.id)
                    .single();
                
                if (error) throw error;
                
                if (data) {
                    userProfile = data;
                    updateProfileData();
                } else {
                    throw new Error('Profil nenalezen');
                }
            } catch (error) {
                console.error('Chyba při načítání profilu:', error);
                showError('Nepodařilo se načíst uživatelský profil. Prosím, zkuste to znovu.');
            }
        }
        
        // Načtení všech odznaků
        async function loadBadges() {
            try {
                const { data, error } = await supabaseClient
                    .from('badges')
                    .select('*')
                    .order('id', { ascending: true });
                
                if (error) throw error;
                
                if (data) {
                    allBadges = data;
                } else {
                    allBadges = [];
                }
            } catch (error) {
                console.error('Chyba při načítání odznaků:', error);
                showError('Nepodařilo se načíst seznam odznaků. Prosím, zkuste to znovu.');
            }
        }
        
        // Načtení odznaků uživatele
        async function loadUserBadges() {
            try {
                const { data, error } = await supabaseClient
                    .from('user_badges')
                    .select('*, badge:badge_id(*)')
                    .eq('user_id', currentUser.id)
                    .order('earned_at', { ascending: false });
                
                if (error) throw error;
                
                if (data) {
                    userBadges = data;
                } else {
                    userBadges = [];
                }
            } catch (error) {
                console.error('Chyba při načítání odznaků uživatele:', error);
                showError('Nepodařilo se načíst vaše odznaky. Prosím, zkuste to znovu.');
            }
        }
        
        // Načtení žebříčku uživatelů
        async function loadLeaderboard() {
            try {
                // Načtení uživatelů seřazených podle bodů
                const { data: pointsData, error: pointsError } = await supabaseClient
                    .from('profiles')
                    .select('id, first_name, last_name, username, avatar_url, level, points, badges_count')
                    .order('points', { ascending: false })
                    .limit(10);
                
                if (pointsError) throw pointsError;
                
                // Načtení uživatelů seřazených podle odznaků
                const { data: badgesData, error: badgesError } = await supabaseClient
                    .from('profiles')
                    .select('id, first_name, last_name, username, avatar_url, level, points, badges_count')
                    .order('badges_count', { ascending: false })
                    .limit(10);
                
                if (badgesError) throw badgesError;
                
                // Načtení uživatelů seřazených podle série dnů
                const { data: streakData, error: streakError } = await supabaseClient
                    .from('profiles')
                    .select('id, first_name, last_name, username, avatar_url, level, points, badges_count, streak_days')
                    .order('streak_days', { ascending: false })
                    .limit(10);
                
                if (streakError) throw streakError;
                
                leaderboardData = {
                    points: pointsData || [],
                    badges: badgesData || [],
                    streak: streakData || []
                };
                
            } catch (error) {
                console.error('Chyba při načítání žebříčku:', error);
                showError('Nepodařilo se načíst žebříček uživatelů. Prosím, zkuste to znovu.');
            }
        }
        
        // Aktualizace dat profilu v UI
        function updateProfileData() {
            // Sidebar
            const initials = getInitials(userProfile.first_name, userProfile.last_name);
            document.getElementById('sidebar-user-avatar').textContent = initials;
            document.getElementById('sidebar-user-name').textContent = `${userProfile.first_name || ''} ${userProfile.last_name || ''}`.trim() || 'Uživatel';
            document.getElementById('sidebar-user-role').textContent = 'Student';
            
            // Statistiky
            document.getElementById('badges-count').textContent = userProfile.badges_count || 0;
            document.getElementById('points-count').textContent = userProfile.points || 0;
            document.getElementById('streak-days').textContent = userProfile.streak_days || 0;
            
            // Počet oznámení
            document.getElementById('notification-count').textContent = '0';
            
            // Najít pořadí uživatele v žebříčku
            const userRank = leaderboardData.points.findIndex(user => user.id === currentUser.id) + 1;
            document.getElementById('rank-value').textContent = userRank > 0 ? userRank : '-';
            document.getElementById('total-users').textContent = leaderboardData.points.length;
        }
        
        // Zobrazení odznaků uživatele
        function renderUserBadges() {
            const badgeGrid = document.getElementById('badge-grid');
            const emptyBadges = document.getElementById('empty-badges');
            
            // Vymazání obsahu
            badgeGrid.innerHTML = '';
            
            if (userBadges.length === 0) {
                // Zobrazení prázdného stavu
                emptyBadges.style.display = 'block';
                badgeGrid.style.display = 'none';
                return;
            }
            
            // Skrýt prázdný stav a zobrazit grid
            emptyBadges.style.display = 'none';
            badgeGrid.style.display = 'grid';
            
            // Vykreslení odznaků
            userBadges.forEach(userBadge => {
                const badge = userBadge.badge;
                const badgeClass = getBadgeClass(badge.type);
                const iconClass = getIconClass(badge.type);
                
                const badgeElement = document.createElement('div');
                badgeElement.className = 'badge-card';
                badgeElement.innerHTML = `
                    <div class="badge-icon ${badgeClass}">
                        <i class="${iconClass}"></i>
                    </div>
                    <h3 class="badge-title">${badge.title}</h3>
                    <p class="badge-desc">${badge.description}</p>
                    <div class="badge-date">
                        <i class="far fa-calendar"></i>
                        Získáno: ${formatDate(userBadge.earned_at)}
                    </div>
                `;
                
                badgeGrid.appendChild(badgeElement);
            });
        }
        
        // Zobrazení dostupných odznaků
        function renderAvailableBadges() {
            const availableBadgesGrid = document.getElementById('available-badges-grid');
            
            // Vymazání obsahu
            availableBadgesGrid.innerHTML = '';
            
            // Filtrování získaných odznaků
            const earnedBadgeIds = userBadges.map(userBadge => userBadge.badge_id);
            
            // Výběr pouze odznaků, které uživatel ještě nemá
            const availableBadges = allBadges.filter(badge => !earnedBadgeIds.includes(badge.id));
            
            if (availableBadges.length === 0) {
                const noAvailableBadges = document.createElement('div');
                noAvailableBadges.className = 'empty-state';
                noAvailableBadges.innerHTML = `
                    <div class="empty-state-icon">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <h3 class="empty-state-title">Získali jste všechny dostupné odznaky!</h3>
                    <p class="empty-state-desc">
                        Gratulujeme! Získali jste všechny dostupné odznaky v systému.
                        Pravidelně přidáváme nové odznaky, takže se nezapomeňte vracet.
                    </p>
                `;
                availableBadgesGrid.appendChild(noAvailableBadges);
                return;
            }
            
            // Vykreslení dostupných odznaků
            availableBadges.forEach(badge => {
                const badgeClass = getBadgeClass(badge.type);
                const iconClass = getIconClass(badge.type);
                
                // Vytvoření náhodného progresu pro demonstraci
                const progress = Math.floor(Math.random() * 80); // 0-80%
                
                const badgeElement = document.createElement('div');
                badgeElement.className = 'achievement-card locked';
                badgeElement.innerHTML = `
                    <div class="achievement-icon ${badgeClass}">
                        <i class="${iconClass}"></i>
                    </div>
                    <div class="achievement-content">
                        <h3 class="achievement-title">${badge.title}</h3>
                        <p class="achievement-desc">${badge.description}</p>
                        <div class="progress-bar">
                            <div class="progress-fill ${badgeClass}" style="width: ${progress}%"></div>
                        </div>
                        <div class="progress-stats">${progress}% splněno</div>
                    </div>
                `;
                
                availableBadgesGrid.appendChild(badgeElement);
            });
        }
        
        // Zobrazení nedávno získaných odznaků
        function renderRecentBadges() {
            const recentBadgesList = document.getElementById('recent-achievements-list');
            const recentBadgesSection = document.getElementById('recent-achievements-section');
            
            // Vymazání obsahu
            recentBadgesList.innerHTML = '';
            
            // Výběr posledních 5 odznaků
            const recentBadges = userBadges.slice(0, 5);
            
            if (recentBadges.length === 0) {
                // Skrýt sekci, pokud nejsou žádné nedávné odznaky
                recentBadgesSection.style.display = 'none';
                return;
            }
            
            // Zobrazit sekci
            recentBadgesSection.style.display = 'block';
            
            // Vykreslení nedávných odznaků
            recentBadges.forEach((userBadge, index) => {
                const badge = userBadge.badge;
                const badgeClass = getBadgeClass(badge.type);
                const iconClass = getIconClass(badge.type);
                
                const badgeElement = document.createElement('div');
                badgeElement.className = `achievement-item delay-${index + 1}`;
                badgeElement.innerHTML = `
                    <div class="achievement-item-icon ${badgeClass}">
                        <i class="${iconClass}"></i>
                    </div>
                    <div class="achievement-item-content">
                        <h3 class="achievement-item-title">${badge.title}</h3>
                        <p class="achievement-item-desc">${badge.description}</p>
                        <div class="achievement-item-time">
                            <i class="far fa-calendar"></i>
                            Získáno: ${formatDate(userBadge.earned_at)}
                        </div>
                    </div>
                `;
                
                recentBadgesList.appendChild(badgeElement);
            });
        }
        
        // Zobrazení žebříčku uživatelů
        function renderLeaderboard() {
            const leaderboardBody = document.getElementById('leaderboard-body');
            const scoreHeader = document.getElementById('score-header');
            
            // Vymazání obsahu
            leaderboardBody.innerHTML = '';
            
            // Nastavení záhlaví podle filtru
            switch (currentLeaderboardFilter) {
                case 'points':
                    scoreHeader.textContent = 'Body';
                    break;
                case 'badges':
                    scoreHeader.textContent = 'Odznaky';
                    break;
                case 'streak':
                    scoreHeader.textContent = 'Série';
                    break;
            }
            
            // Získání dat podle filtru
            const data = leaderboardData[currentLeaderboardFilter];
            
            // Vykreslení řádků tabulky
            data.forEach((user, index) => {
                                const rank = index + 1;
                const isCurrentUser = user.id === currentUser.id;
                const displayName = user.username ? 
                    `@${user.username}` : 
                    `${user.first_name || ''} ${user.last_name || ''}`.trim() || 'Uživatel';
                const initials = getInitials(user.first_name, user.last_name);
                
                // Hodnota podle aktuálního filtru
                let scoreValue;
                switch (currentLeaderboardFilter) {
                    case 'points':
                        scoreValue = user.points || 0;
                        break;
                    case 'badges':
                        scoreValue = user.badges_count || 0;
                        break;
                    case 'streak':
                        scoreValue = user.streak_days || 0;
                        break;
                }
                
                // Vytvoření řádku tabulky
                const rowElement = document.createElement('tr');
                if (isCurrentUser) {
                    rowElement.className = 'highlight-row';
                }
                
                rowElement.innerHTML = `
                    <td class="rank-cell">${rank}</td>
                    <td class="user-cell">
                        <div class="user-avatar-sm">
                            ${user.avatar_url ? `<img src="${user.avatar_url}" alt="${displayName}">` : initials}
                        </div>
                        <div class="user-info-sm">
                            <div class="user-name-sm">${displayName}</div>
                            <div class="user-level">Úroveň ${user.level || 1}</div>
                        </div>
                    </td>
                    <td class="score-cell">${scoreValue}</td>
                    <td class="badge-count-cell">${user.badges_count || 0}</td>
                `;
                
                leaderboardBody.appendChild(rowElement);
            });
        }
        
        // Aktualizace kompletního UI
        function updateUI() {
            updateProfileData();
            renderUserBadges();
            renderAvailableBadges();
            renderRecentBadges();
            renderLeaderboard();
            hideLoading();
        }
        
        // Přepínání filtrů žebříčku
        function setupLeaderboardFilters() {
            const filterButtons = document.querySelectorAll('.filter-btn');
            
            filterButtons.forEach(button => {
                button.addEventListener('click', function() {
                    // Odstranění aktivní třídy ze všech tlačítek
                    filterButtons.forEach(btn => btn.classList.remove('active'));
                    
                    // Přidání aktivní třídy kliknutému tlačítku
                    this.classList.add('active');
                    
                    // Nastavení filtru a překreslení žebříčku
                    currentLeaderboardFilter = this.getAttribute('data-filter');
                    renderLeaderboard();
                });
            });
        }
        
        // Globální hledání pomocí search boxu
        function setupSearch() {
            const searchInput = document.querySelector('.search-box input');
            
            searchInput.addEventListener('input', function() {
                const searchTerm = this.value.toLowerCase().trim();
                
                // Pokud je vyhledávací pole prázdné, obnovit původní seznam
                if (!searchTerm) {
                    renderUserBadges();
                    renderAvailableBadges();
                    return;
                }
                
                // Filtrování odznaků uživatele
                const filteredUserBadges = userBadges.filter(userBadge => {
                    const badge = userBadge.badge;
                    return badge.title.toLowerCase().includes(searchTerm) || 
                           badge.description.toLowerCase().includes(searchTerm) ||
                           badge.type.toLowerCase().includes(searchTerm);
                });
                
                // Filtrování dostupných odznaků
                const earnedBadgeIds = userBadges.map(userBadge => userBadge.badge_id);
                const filteredAvailableBadges = allBadges.filter(badge => {
                    const isAvailable = !earnedBadgeIds.includes(badge.id);
                    const matchesSearch = badge.title.toLowerCase().includes(searchTerm) || 
                                         badge.description.toLowerCase().includes(searchTerm) ||
                                         badge.type.toLowerCase().includes(searchTerm);
                    return isAvailable && matchesSearch;
                });
                
                // Dočasná úprava globálních proměnných pro vykreslení
                const originalUserBadges = [...userBadges];
                const originalAllBadges = [...allBadges];
                
                userBadges = filteredUserBadges;
                allBadges = filteredAvailableBadges.concat(originalAllBadges.filter(badge => earnedBadgeIds.includes(badge.id)));
                
                // Překreslení odznaků
                renderUserBadges();
                renderAvailableBadges();
                
                // Obnovení původních dat
                userBadges = originalUserBadges;
                allBadges = originalAllBadges;
            });
        }
        
        // Handler pro opakovaný pokus při chybě
        function setupRetryButton() {
            document.getElementById('global-retry-btn').addEventListener('click', async function() {
                hideError();
                showLoading();
                try {
                    await loadUserProfile();
                    await loadBadges();
                    await loadUserBadges();
                    await loadLeaderboard();
                    updateUI();
                } catch (error) {
                    console.error('Chyba při opakovaném pokusu:', error);
                    showError('Nepodařilo se načíst data. Prosím, zkuste to znovu později.');
                    hideLoading();
                }
            });
        }
        
        // Inicializace stránky
        async function initPage() {
            showLoading();
            hideError();
            
            try {
                await checkAuth();
                setupLeaderboardFilters();
                setupSearch();
                setupRetryButton();
            } catch (error) {
                console.error('Chyba při inicializaci stránky:', error);
                showError('Došlo k neočekávané chybě. Prosím, obnovte stránku.');
                hideLoading();
            }
        }
        
        // Spuštění inicializace po načtení stránky
        document.addEventListener('DOMContentLoaded', initPage);
    </script>
</body>
</html>