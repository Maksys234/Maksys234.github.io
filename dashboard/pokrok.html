<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Justax - Pokrok</title>
    <!-- Připojení fontů -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Font Awesome CDN -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Chart.js pro grafy -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Supabase JS Client -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <style>
        /* Základní styly */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
        }

        :root {
            --primary: #4361ee;
            --primary-light: #4895ef;
            --secondary: #3f37c9;
            --success: #4cc9f0;
            --danger: #f72585;
            --warning: #f8961e;
            --info: #4895ef;
            --dark: #1e2a3a;
            --light: #f8f9fa;
            --gray: #6c757d;
            --gray-light: #dee2e6;
            --gray-dark: #343a40;
            --gradient-1: linear-gradient(135deg, #4361ee, #3a0ca3);
            --gradient-2: linear-gradient(135deg, #4cc9f0, #4361ee);
            --gradient-3: linear-gradient(135deg, #f72585, #7209b7);
            --white: #ffffff;
            --sidebar-width: 260px;
            --transition-speed: 0.3s;
            --card-radius: 16px;
            --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.05);
            --shadow-md: 0 5px 15px rgba(0, 0, 0, 0.07);
            --shadow-lg: 0 10px 25px rgba(0, 0, 0, 0.1);
            --text-primary: #2d3748;
            --text-secondary: #4a5568;
            --text-muted: #718096;
        }

        body {
            background-color: #f6f8ff;
            color: var(--text-primary);
            min-height: 100vh;
            display: flex;
            overflow-x: hidden;
        }

        /* Boční panel */
        .sidebar {
            width: var(--sidebar-width);
            height: 100vh;
            position: fixed;
            top: 0;
            left: 0;
            background: var(--gradient-1);
            color: var(--white);
            padding: 1.5rem 1rem;
            display: flex;
            flex-direction: column;
            z-index: 100;
            box-shadow: var(--shadow-lg);
            transition: all var(--transition-speed) ease;
        }

        .sidebar-header {
            display: flex;
            align-items: center;
            margin-bottom: 2rem;
            padding: 0 0.75rem;
        }

        .sidebar-logo {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--white);
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .sidebar-logo i {
            font-size: 1.75rem;
        }

        .sidebar-menu {
            list-style: none;
            padding: 0;
            margin: 0;
            flex-grow: 1;
        }

        .sidebar-item {
            margin-bottom: 0.5rem;
        }

        .sidebar-link {
            display: flex;
            align-items: center;
            padding: 0.75rem 1rem;
            color: rgba(255, 255, 255, 0.85);
            text-decoration: none;
            border-radius: 12px;
            transition: all 0.2s ease;
            font-weight: 500;
        }

        .sidebar-link i {
            margin-right: 0.75rem;
            font-size: 1.2rem;
            width: 24px;
            text-align: center;
        }

        .sidebar-link.active, .sidebar-link:hover {
            background-color: rgba(255, 255, 255, 0.15);
            color: var(--white);
        }

        .sidebar-footer {
            margin-top: auto;
            padding: 1rem;
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.7);
            text-align: center;
        }

        .user-profile {
            display: flex;
            align-items: center;
            padding: 1rem;
            margin-top: 1rem;
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--primary-light);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 0.75rem;
            font-weight: 500;
            overflow: hidden;
        }

        .user-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .user-info {
            flex-grow: 1;
        }

        .user-name {
            font-weight: 600;
            font-size: 0.95rem;
        }

        .user-role {
            font-size: 0.8rem;
            opacity: 0.8;
        }

        /* Hlavní obsah */
        main {
            flex: 1;
            margin-left: var(--sidebar-width);
            padding: 1.5rem 2rem;
            transition: margin var(--transition-speed) ease;
            width: calc(100% - var(--sidebar-width));
        }

        .dashboard-header {
            margin-bottom: 2rem;
            background-color: var(--white);
            border-radius: var(--card-radius);
            padding: 1.25rem 1.5rem;
            box-shadow: var(--shadow-sm);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-content h1 {
            font-size: 1.75rem;
            font-weight: 600;
            color: var(--dark);
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 1.5rem;
        }

        .search-box {
            position: relative;
        }

        .search-box input {
            width: 280px;
            height: 44px;
            border-radius: 22px;
            padding: 0 1rem 0 2.5rem;
            border: 1px solid var(--gray-light);
            background-color: var(--light);
            outline: none;
            transition: all 0.2s ease;
            font-size: 0.95rem;
        }

        .search-box input:focus {
            border-color: var(--primary-light);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.15);
        }

        .search-box i {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--gray);
        }

        .notifications {
            position: relative;
            cursor: pointer;
        }

        .notifications i {
            font-size: 1.4rem;
            color: var(--gray-dark);
        }

        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            width: 20px;
            height: 20px;
            background-color: var(--danger);
            color: white;
            font-size: 0.7rem;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
        }

        /* Hlavní obsah */
        .main-content {
            display: grid;
            gap: 1.75rem;
        }

        .section-title {
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 1.25rem;
            color: var(--dark);
        }

        /* Karty pokroku */
        .progress-overview {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .progress-card {
            background-color: var(--white);
            border-radius: var(--card-radius);
            padding: 1.5rem;
            box-shadow: var(--shadow-sm);
            transition: all 0.3s ease;
        }

        .progress-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-md);
        }

        .progress-info {
            display: flex;
            align-items: center;
            margin-bottom: 1.25rem;
        }

        .progress-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 1rem;
            flex-shrink: 0;
        }

        .progress-icon i {
            font-size: 1.5rem;
            color: var(--white);
        }

        .progress-icon.math {
            background: linear-gradient(135deg, #4cc9f0, #4361ee);
        }

        .progress-icon.language {
            background: linear-gradient(135deg, #f72585, #b5179e);
        }

        .progress-icon.general {
            background: linear-gradient(135deg, #f8961e, #f3722c);
        }

        .progress-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 0.25rem;
            color: var(--dark);
        }

        .progress-subtitle {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .progress-bar-container {
            height: 12px;
            background-color: #f0f0f0;
            border-radius: 6px;
            overflow: hidden;
            margin-bottom: 0.75rem;
        }

        .progress-bar {
            height: 100%;
            border-radius: 6px;
            transition: width 1.5s ease-in-out;
        }

        .progress-bar.math {
            background: linear-gradient(to right, #4cc9f0, #4361ee);
        }

        .progress-bar.language {
            background: linear-gradient(to right, #f72585, #b5179e);
        }

        .progress-bar.general {
            background: linear-gradient(to right, #f8961e, #f3722c);
        }

        .progress-details {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .progress-percentage {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--dark);
        }

        .progress-status {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        /* Podrobné grafy aktivity */
        .chart-section {
            margin-bottom: 2rem;
        }

        .chart-container {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 1.5rem;
        }

        .chart-card {
            background-color: var(--white);
            border-radius: var(--card-radius);
            padding: 1.5rem;
            box-shadow: var(--shadow-sm);
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .chart-title {
            font-size: 1.15rem;
            font-weight: 600;
            color: var(--dark);
        }

        .chart-filter {
            display: flex;
            gap: 0.75rem;
        }

        .filter-btn {
            padding: 0.5rem 1rem;
            background-color: var(--light);
            border: 1px solid var(--gray-light);
            border-radius: 8px;
            font-size: 0.85rem;
            font-weight: 500;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .filter-btn:hover {
            background-color: var(--primary-light);
            color: var(--white);
            border-color: var(--primary-light);
        }

        .filter-btn.active {
            background-color: var(--primary);
            color: var(--white);
            border-color: var(--primary);
        }

        .chart-canvas-container {
            width: 100%;
            height: 300px;
            position: relative;
        }

        /* Statistika splnění */
        .stats-card {
            background-color: var(--white);
            border-radius: var(--card-radius);
            padding: 1.5rem;
            box-shadow: var(--shadow-sm);
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        .stats-header {
            margin-bottom: 1.25rem;
        }

        .stats-title {
            font-size: 1.15rem;
            font-weight: 600;
            color: var(--dark);
        }

        .stats-list {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .stat-item {
            padding: 1rem 0;
            border-bottom: 1px solid var(--gray-light);
        }

        .stat-item:last-child {
            border-bottom: none;
            padding-bottom: 0;
        }

        .stat-label {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
        }

        .stat-value {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--dark);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .stat-trend {
            display: flex;
            align-items: center;
            font-size: 0.85rem;
            font-weight: 500;
            gap: 0.25rem;
        }

        .trend-up {
            color: #10b981;
        }

        .trend-down {
            color: var(--danger);
        }

        .trend-neutral {
            color: var(--gray);
        }

        /* Tabulka podrobného pokroku */
        .detail-progress-section {
            margin-bottom: 2rem;
        }

        .detail-progress-card {
            background-color: var(--white);
            border-radius: var(--card-radius);
            box-shadow: var(--shadow-sm);
            overflow: hidden;
        }

        .detail-progress-header {
            padding: 1.25rem 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--gray-light);
        }

        .detail-progress-title {
            font-size: 1.15rem;
            font-weight: 600;
            color: var(--dark);
        }

        .detail-progress-filter {
            display: flex;
            gap: 0.75rem;
        }

        .detail-progress-table {
            width: 100%;
            border-collapse: collapse;
        }

        .detail-progress-table th {
            padding: 1rem 1.5rem;
            text-align: left;
            color: var(--text-secondary);
            font-weight: 500;
            font-size: 0.9rem;
            border-bottom: 1px solid var(--gray-light);
        }

        .detail-progress-table td {
            padding: 1rem 1.5rem;
            border-bottom: 1px solid var(--gray-light);
            font-size: 0.95rem;
        }

        .detail-progress-table tr:last-child td {
            border-bottom: none;
        }

        .detail-progress-table tr:hover {
            background-color: #f8faff;
        }

        .topic-cell {
            font-weight: 500;
            color: var(--dark);
            width: 30%;
        }

        .skill-badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
            color: var(--white);
            margin-right: 0.5rem;
            margin-bottom: 0.25rem;
        }

        .skill-badge.math {
            background-color: var(--primary-light);
        }

        .skill-badge.language {
            background-color: var(--danger);
        }

        .score-cell {
            font-weight: 600;
            color: var(--primary);
        }

        .completion-cell {
            width: 20%;
        }

        .completion-bar {
            height: 8px;
            background-color: #f0f0f0;
            border-radius: 4px;
            overflow: hidden;
        }

        .completion-fill {
            height: 100%;
            border-radius: 4px;
        }

        .completion-fill.excellent {
            background-color: #10b981;
        }

        .completion-fill.good {
            background-color: var(--warning);
        }

        .completion-fill.incomplete {
            background-color: var(--danger);
        }

        .last-activity-cell {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        /* Doporučení */
        .recommendations-section {
            margin-bottom: 2rem;
        }

        .recommendations-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .recommendation-card {
            background-color: var(--white);
            border-radius: var(--card-radius);
            padding: 1.5rem;
            box-shadow: var(--shadow-sm);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .recommendation-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-md);
        }

        .recommendation-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: var(--gradient-1);
        }

        .recommendation-header {
            display: flex;
            align-items: flex-start;
            margin-bottom: 1.25rem;
        }

        .recommendation-icon {
            width: 45px;
            height: 45px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 1rem;
            flex-shrink: 0;
        }

        .recommendation-icon i {
            font-size: 1.25rem;
            color: var(--white);
        }

        .recommendation-icon.math {
            background: linear-gradient(135deg, #4cc9f0, #4361ee);
        }

        .recommendation-icon.language {
            background: linear-gradient(135deg, #f72585, #b5179e);
        }

        .recommendation-icon.general {
            background: linear-gradient(135deg, #f8961e, #f3722c);
        }

        .recommendation-info {
            flex-grow: 1;
        }

        .recommendation-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--dark);
            margin-bottom: 0.25rem;
        }

        .recommendation-desc {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-bottom: 1rem;
            flex-grow: 1;
        }

        .recommendation-action {
            margin-top: auto;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            padding: 0.75rem 1.25rem;
            border-radius: 10px;
            font-weight: 500;
            font-size: 0.95rem;
            text-decoration: none;
            transition: all 0.3s ease;
            cursor: pointer;
            border: none;
            gap: 0.5rem;
        }

        .btn-primary {
            background: var(--gradient-1);
            color: white;
            box-shadow: 0 4px 10px rgba(67, 97, 238, 0.2);
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(67, 97, 238, 0.25);
        }

        .btn-outline {
            background: transparent;
            color: var(--primary);
            box-shadow: 0 0 0 1px var(--primary) inset;
        }

        .btn-outline:hover {
            background-color: rgba(67, 97, 238, 0.05);
        }

        /* Patička */
        .dashboard-footer {
            margin-top: 2rem;
            padding: 1.5rem 0;
            text-align: center;
            color: var(--text-muted);
            font-size: 0.9rem;
        }

        /* Načítací stavy */
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 2rem;
            font-size: 1rem;
            color: var(--text-muted);
        }

        .loading::after {
            content: "";
            width: 24px;
            height: 24px;
            margin-left: 15px;
            border: 2px solid var(--primary);
            border-radius: 50%;
            border-top-color: transparent;
            animation: loading-spinner 0.8s linear infinite;
        }

        @keyframes loading-spinner {
            to {
                transform: rotate(360deg);
            }
        }

        /* Chybové stavy */
        .error-message {
            background-color: #fff2f5;
            border-left: 4px solid var(--danger);
            color: var(--danger);
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 8px;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
        }

        .error-message i {
            margin-right: 0.75rem;
            font-size: 1.25rem;
        }

        /* Prázdný stav */
        .empty-state {
            text-align: center;
            padding: 3rem 1.5rem;
            color: var(--text-secondary);
        }

        .empty-state i {
            font-size: 3.5rem;
            margin-bottom: 1.5rem;
            color: var(--gray-light);
        }

        .empty-state h3 {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: var(--dark);
        }

        .empty-state p {
            margin-bottom: 1.5rem;
            max-width: 500px;
            margin-left: auto;
            margin-right: auto;
        }

        /* Media queries pro responzivní design */
        @media (max-width: 1200px) {
            .chart-container {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 992px) {
            :root {
                --sidebar-width: 80px;
            }
            
            .sidebar-logo span, .sidebar-link span, .user-info, .sidebar-footer {
                display: none;
            }
            
            .sidebar-link i {
                margin-right: 0;
                font-size: 1.5rem;
            }
            
            .sidebar-logo i {
                margin-right: 0;
            }
            
            .sidebar-header, .sidebar-link {
                justify-content: center;
            }
            
            .user-profile {
                justify-content: center;
                padding: 0.75rem;
            }
            
            .user-avatar {
                margin-right: 0;
            }
            
            .search-box input {
                width: 200px;
            }
        }

        @media (max-width: 768px) {
            main {
                padding: 1rem;
            }
            
            .header-content {
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
            }
            
            .header-actions {
                width: 100%;
                justify-content: space-between;
            }
            
            .search-box input {
                width: 100%;
            }
            
            .detail-progress-table th:nth-child(2),
            .detail-progress-table td:nth-child(2) {
                display: none;
            }
            
            .detail-progress-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
            }
            
            .detail-progress-filter {
                width: 100%;
                justify-content: space-between;
            }
        }

        @media (max-width: 576px) {
            :root {
                --sidebar-width: 0;
            }
            
            .sidebar {
                transform: translateX(-100%);
            }
            
            .sidebar.active {
                transform: translateX(0);
            }
            
            main {
                margin-left: 0;
                width: 100%;
            }
            
            .search-box {
                display: none;
            }
            
            .mobile-menu-toggle {
                display: block;
            }
            
            .detail-progress-table th:nth-child(4),
            .detail-progress-table td:nth-child(4) {
                display: none;
            }
        }

        /* Mobilní menu */
        .mobile-menu-toggle {
            display: none;
            background: none;
            border: none;
            cursor: pointer;
            color: var(--dark);
            font-size: 1.5rem;
            margin-right: 1rem;
        }

        /* Překrytí pro mobil */
        .sidebar-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 99;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .sidebar-overlay.active {
            display: block;
            opacity: 1;
        }

        /* Tmavý režim */
        @media (prefers-color-scheme: dark) {
            :root {
                --white: #1a202c;
                --light: #2d3748;
                --dark: #e2e8f0;
                --gray-light: #4a5568;
                --text-primary: #e2e8f0;
                --text-secondary: #cbd5e0;
                --text-muted: #a0aec0;
            }
            
            body {
                background-color: #171923;
            }
            
            .search-box input {
                background-color: #2d3748;
                color: var(--text-primary);
                border-color: #4a5568;
            }
            
            .search-box i {
                color: #a0aec0;
            }
            
            .filter-btn {
                background-color: #2d3748;
                border-color: #4a5568;
                color: var(--text-primary);
            }
            
            .filter-btn:hover {
                background-color: rgba(76, 201, 240, 0.1);
            }
            
            .progress-bar-container, .completion-bar {
                background-color: #2d3748;
            }
            
            .detail-progress-table tr:hover {
                background-color: #2d3748;
            }
            
            .btn-outline {
                box-shadow: 0 0 0 1px var(--primary) inset;
            }

            .error-message {
                background-color: #361927;
                color: #ff6d9f;
            }

            .empty-state i {
                color: #4a5568;
            }
        }

        /* Animace */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .fade-in {
            animation: fadeIn 0.5s ease forwards;
        }
    </style>
</head>
<body>
    <!-- Překrytí pro mobilní menu -->
    <div id="sidebar-overlay" class="sidebar-overlay"></div>
    
    <!-- Boční panel -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <a href="/" class="sidebar-logo">
                <i class="fas fa-calculator"></i>
                <span>Justax</span>
            </a>
        </div>
        
        <ul class="sidebar-menu">
            <li class="sidebar-item">
                <a href="dashboard.html" class="sidebar-link">
                    <i class="fas fa-th-large"></i>
                    <span>Dashboard</span>
                </a>
            </li>
            <li class="sidebar-item">
                <a href="/dashboard/procvicovani/main.html" class="sidebar-link">
                    <i class="fas fa-book-open"></i>
                    <span>Procvičování</span>
                </a>
            </li>
            <li class="sidebar-item">
                <a href="pokrok.html" class="sidebar-link active">
                    <i class="fas fa-chart-line"></i>
                    <span>Pokrok</span>
                </a>
            </li>
            <li class="sidebar-item">
                <a href="oceneni.html" class="sidebar-link">
                    <i class="fas fa-medal"></i>
                    <span>Ocenění</span>
                </a>
            </li>
            <li class="sidebar-item">
                <a href="materialy.html" class="sidebar-link">
                    <i class="fas fa-file-alt"></i>
                    <span>Materiály</span>
                </a>
            </li>
            <li class="sidebar-item">
                <a href="profile.html" class="sidebar-link">
                    <i class="fas fa-user-cog"></i>
                    <span>Profil</span>
                </a>
            </li>
        </ul>
        
        <div class="user-profile">
            <div class="user-avatar" id="user-avatar">MS</div>
            <div class="user-info">
                <div class="user-name" id="user-name">Načítání...</div>
                <div class="user-role">Student</div>
            </div>
        </div>
        
        <div class="sidebar-footer">
            &copy; 2025 Justax
        </div>
    </aside>

    <!-- Hlavní obsah -->
    <main>
        <div class="dashboard-header">
            <div class="header-content">
                <div>
                    <button class="mobile-menu-toggle" id="mobile-menu-toggle">
                        <i class="fas fa-bars"></i>
                    </button>
                    <h1>Pokrok</h1>
                </div>
                <div class="header-actions">
                    <div class="search-box">
                        <i class="fas fa-search"></i>
                        <input type="text" placeholder="Hledat témata...">
                    </div>
                    <div class="notifications">
                        <i class="fas fa-bell"></i>
                        <div class="notification-badge">3</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="main-content">
            <!-- Sekce přehledu pokroku -->
            <section class="progress-overview-section">
                <h2 class="section-title">Celkový pokrok</h2>
                <div class="progress-overview" id="progress-overview">
                    <div class="loading">Načítání pokroku...</div>
                </div>
            </section>

            <!-- Sekce grafů aktivity -->
            <section class="chart-section">
                <div class="chart-container">
                    <div class="chart-card">
                        <div class="chart-header">
                            <h3 class="chart-title">Vývoj pokroku</h3>
                            <div class="chart-filter">
                                <button class="filter-btn active" data-period="week">Týden</button>
                                <button class="filter-btn" data-period="month">Měsíc</button>
                                <button class="filter-btn" data-period="year">Rok</button>
                            </div>
                        </div>
                        <div class="chart-canvas-container">
                            <canvas id="progressChart"></canvas>
                        </div>
                    </div>

                    <div class="stats-card">
                        <div class="stats-header">
                            <h3 class="stats-title">Statistika</h3>
                        </div>
                        <div class="stats-list" id="progress-stats">
                            <div class="loading">Načítání statistik...</div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Sekce podrobného pokroku -->
            <section class="detail-progress-section">
                <div class="detail-progress-card">
                    <div class="detail-progress-header">
                        <h3 class="detail-progress-title">Pokrok podle témat</h3>
                        <div class="detail-progress-filter">
                            <button class="filter-btn active" data-subject="all">Vše</button>
                            <button class="filter-btn" data-subject="math">Matematika</button>
                            <button class="filter-btn" data-subject="language">Čeština</button>
                        </div>
                    </div>
                    <div id="topics-table-container">
                        <div class="loading">Načítání témat...</div>
                    </div>
                </div>
            </section>

            <!-- Sekce doporučení -->
            <section class="recommendations-section">
                <h2 class="section-title">Doporučení pro zlepšení</h2>
                <div class="recommendations-grid" id="recommendations-grid">
                    <div class="loading">Načítání doporučení...</div>
                </div>
            </section>
        </div>

        <footer class="dashboard-footer">
            &copy; 2025 Justax | Všechna práva vyhrazena
        </footer>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Inicializace Supabase klienta
            const supabaseUrl = 'https://qcimhjjwvsbgjsitmvuh.supabase.co';
            const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFjaW1oamp3dnNiZ2pzaXRtdnVoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDI1ODA5MjYsImV4cCI6MjA1ODE1NjkyNn0.OimvRtbXuIUkaIwveOvqbMd_cmPN5yY3DbWCBYc9D10';
            const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);
            
            // DOM elementy
            const userAvatar = document.getElementById('user-avatar');
            const userName = document.getElementById('user-name');
            const mobileMenuToggle = document.getElementById('mobile-menu-toggle');
            const sidebar = document.getElementById('sidebar');
            const sidebarOverlay = document.getElementById('sidebar-overlay');
            const progressOverview = document.getElementById('progress-overview');
            const progressStats = document.getElementById('progress-stats');
            const topicsTableContainer = document.getElementById('topics-table-container');
            const recommendationsGrid = document.getElementById('recommendations-grid');
            
            // Grafy
            let progressChart = null;
            
            // Globální data
            let currentUser = null;
            let userProgress = {};
            let topicsData = [];
            let analyticsData = null;
            
            // Mobile menu toggle
            mobileMenuToggle.addEventListener('click', () => {
                sidebar.classList.toggle('active');
                sidebarOverlay.classList.toggle('active');
            });
            
            // Zavření sidebar overlay kliknutím
            sidebarOverlay.addEventListener('click', () => {
                sidebar.classList.remove('active');
                sidebarOverlay.classList.remove('active');
            });
            
            // Filtry pro grafy
            document.querySelectorAll('.chart-filter .filter-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    // Odstranění aktivní třídy ze všech tlačítek
                    document.querySelectorAll('.chart-filter .filter-btn').forEach(b => b.classList.remove('active'));
                    // Přidání aktivní třídy na kliknuté tlačítko
                    this.classList.add('active');
                    // Aktualizace grafu podle vybraného období
                    updateProgressChart(this.dataset.period);
                });
            });
            
            // Filtry pro témata
            document.querySelectorAll('.detail-progress-filter .filter-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    // Odstranění aktivní třídy ze všech tlačítek
                    document.querySelectorAll('.detail-progress-filter .filter-btn').forEach(b => b.classList.remove('active'));
                    // Přidání aktivní třídy na kliknuté tlačítko
                    this.classList.add('active');
                    // Aktualizace tabulky podle vybraného předmětu
                    filterTopicsTable(this.dataset.subject);
                });
            });
            
            // Inicializace
            async function init() {
                try {
                    // Načtení dat o přihlášeném uživateli
                    await loadUserProfile();
                    
                    // Načtení dat o pokroku
                    await loadUserProgress();
                    
                    // Načtení dat o tématech
                    await loadTopicsProgress();
                    
                    // Načtení analytických dat
                    await loadAnalytics();
                    
                    // Načtení doporučení
                    await loadRecommendations();
                    
                } catch (error) {
                    console.error('Chyba při inicializaci:', error);
                }
            }
            
            // Načtení profilu uživatele
            async function loadUserProfile() {
                try {
                    // Získání aktuálního uživatele
                    const { data: { user }, error: userError } = await supabase.auth.getUser();
                    
                    if (userError) throw userError;
                    
                    if (user) {
                        // Získání profilu uživatele
                        const { data: profile, error } = await supabase
                            .from('profiles')
                            .select('*')
                            .eq('id', user.id)
                            .single();
                            
                        if (error) throw error;
                        
                        // Uložení uživatele do globální proměnné
                        currentUser = { ...user, profile };
                        
                        // Aktualizace UI s informacemi o uživateli
                        if (profile) {
                            // Nastavení jména uživatele
                            const displayName = profile.first_name && profile.last_name 
                                ? `${profile.first_name} ${profile.last_name}`
                                : profile.username || user.email || 'Uživatel';
                                
                            userName.textContent = displayName;
                            
                            // Nastavení avataru
                            if (profile.avatar_url) {
                                userAvatar.innerHTML = `<img src="${profile.avatar_url}" alt="${displayName}" />`;
                            } else {
                                const initials = getInitials(profile);
                                userAvatar.textContent = initials;
                            }
                        } else {
                            // Fallback pokud profil neexistuje
                            userName.textContent = user.email || 'Uživatel';
                            userAvatar.textContent = 'U';
                        }
                    } else {
                        // Uživatel není přihlášen, přesměrování na login
                        window.location.href = '/login.html';
                    }
                } catch (error) {
                    console.error('Chyba při načítání profilu:', error);
                    userName.textContent = 'Uživatel';
                    userAvatar.textContent = 'U';
                }
            }
            
            // Získání iniciál z profilu
            function getInitials(profile) {
                if (profile.first_name && profile.last_name) {
                    return `${profile.first_name[0]}${profile.last_name[0]}`.toUpperCase();
                } else if (profile.first_name) {
                    return profile.first_name[0].toUpperCase();
                } else if (profile.username) {
                    return profile.username[0].toUpperCase();
                } else if (profile.email) {
                    return profile.email[0].toUpperCase();
                } else {
                    return 'U';
                }
            }
            
            // Načtení pokroku uživatele
            async function loadUserProgress() {
                if (!currentUser) return;
                
                try {
                    // Načtení statistik z databáze
                    let { data: stats, error } = await supabase
                        .from('user_stats')
                        .select('*')
                        .eq('user_id', currentUser.id)
                        .single();
                    
                    // Pokud statistiky neexistují, vytvoříme výchozí hodnoty
                    if ((error && error.code === 'PGRST116') || !stats) {
                        stats = {
                            user_id: currentUser.id,
                            progress: 0,
                            progress_weekly: 0,
                            points: currentUser.profile.points || 0,
                            points_weekly: 0,
                            completed_tests: 0,
                            total_tests: 0,
                            streak_current: currentUser.profile.streak_days || 0,
                            streak_longest: currentUser.profile.streak_days || 0,
                            created_at: new Date().toISOString(),
                            updated_at: new Date().toISOString()
                        };
                    } else if (error) {
                        throw error;
                    }
                    
                    // Uložení pokroku do globální proměnné
                    userProgress = stats;
                    
                    // Načtení výsledků testů podle předmětů
                    const { data: testResults, error: testError } = await supabase
                        .from('test_results')
                        .select('*, tests(subject)')
                        .eq('user_id', currentUser.id);
                        
                    if (testError) throw testError;
                    
                    // Výpočet pokroku podle předmětů
                    const subjectProgress = {};
                    if (testResults && testResults.length > 0) {
                        testResults.forEach(result => {
                            const subject = result.tests?.subject || 'Obecné';
                            if (!subjectProgress[subject]) {
                                subjectProgress[subject] = {
                                    total: 0,
                                    score: 0,
                                    count: 0
                                };
                            }
                            subjectProgress[subject].total += result.score;
                            subjectProgress[subject].count++;
                            subjectProgress[subject].score = Math.round(subjectProgress[subject].total / subjectProgress[subject].count);
                        });
                    }
                    
                    // Přidání pokroku podle předmětů do globální proměnné
                    userProgress.subjects = subjectProgress;
                    
                    // Zobrazení karet pokroku
                    renderProgressCards();
                    
                    // Zobrazení statistik
                    renderProgressStats();
                    
                    // Inicializace grafu
                    initProgressChart();
                    
                } catch (error) {
                    console.error('Chyba při načítání pokroku:', error);
                    progressOverview.innerHTML = `
                        <div class="error-message">
                            <i class="fas fa-exclamation-triangle"></i>
                            Nepodařilo se načíst data o pokroku.
                        </div>
                    `;
                    progressStats.innerHTML = `
                        <div class="error-message">
                            <i class="fas fa-exclamation-triangle"></i>
                            Nepodařilo se načíst statistiky.
                        </div>
                    `;
                }
            }
            
            // Načtení pokroku podle témat
            async function loadTopicsProgress() {
                if (!currentUser) return;
                
                try {
                    // Načtení pokroku uživatele podle témat
                    const { data: topicProgress, error: progressError } = await supabase
                        .from('user_topic_progress')
                        .select('*, exam_topics(*)')
                        .eq('user_id', currentUser.id);
                        
                    if (progressError) throw progressError;
                    
                    // Pokud nemáme žádný pokrok, zkusíme načíst všechna témata
                    if (!topicProgress || topicProgress.length === 0) {
                        const { data: topics, error: topicsError } = await supabase
                            .from('exam_topics')
                            .select('*');
                            
                        if (!topicsError && topics && topics.length > 0) {
                            // Vytvoření prázdného pokroku pro všechna témata
                            topicsData = topics.map(topic => ({
                                topic_id: topic.id,
                                user_id: currentUser.id,
                                progress: 0,
                                strength: 'neutral',
                                questions_attempted: 0,
                                questions_correct: 0,
                                last_activity: null,
                                exam_topics: topic
                            }));
                        } else {
                            topicsData = [];
                        }
                    } else {
                        topicsData = topicProgress;
                    }
                    
                    // Zobrazení tabulky témat
                    renderTopicsTable(topicsData);
                    
                } catch (error) {
                    console.error('Chyba při načítání pokroku témat:', error);
                    topicsTableContainer.innerHTML = `
                        <div class="error-message">
                            <i class="fas fa-exclamation-triangle"></i>
                            Nepodařilo se načíst pokrok podle témat.
                        </div>
                    `;
                }
            }
            
            // Načtení analytických dat
            async function loadAnalytics() {
                if (!currentUser) return;
                
                try {
                    // Načtení nejnovější analýzy
                    const { data, error } = await supabase
                        .from('progress_analytics')
                        .select('*')
                        .eq('user_id', currentUser.id)
                        .order('analysis_date', { ascending: false })
                        .limit(1);
                        
                    if (error) throw error;
                    
                    if (data && data.length > 0) {
                        analyticsData = data[0];
                    }
                } catch (error) {
                    console.error('Chyba při načítání analytických dat:', error);
                }
            }
            
            // Načtení doporučení
            async function loadRecommendations() {
                if (!currentUser) return;
                
                try {
                    let recommendations = [];
                    
                    // Pokud máme analytická data, použijeme doporučená témata z nich
                    if (analyticsData && analyticsData.recommended_topics && analyticsData.recommended_topics.length > 0) {
                        // Načtení informací o doporučených tématech
                        const recommendedTopicIds = analyticsData.recommended_topics.map(t => t.topic_id);
                        
                        // Načtení detailů témat
                        const { data: topics, error } = await supabase
                            .from('exam_topics')
                            .select('*')
                            .in('id', recommendedTopicIds);
                            
                        if (error) throw error;
                        
                        if (topics && topics.length > 0) {
                            recommendations = analyticsData.recommended_topics.map(rec => {
                                const topic = topics.find(t => t.id === rec.topic_id) || {};
                                return {
                                    id: rec.topic_id,
                                    title: topic.name || 'Neznámé téma',
                                    subject: topic.subject || 'Obecné',
                                    description: rec.reason || 'Doporučeno k procvičení',
                                    type: rec.priority || 'medium'
                                };
                            });
                        }
                    } 
                    // Pokud nemáme analytická data nebo doporučená témata, použijeme slabá témata z topicsData
                    else if (topicsData.length > 0) {
                        // Najdeme témata s nejnižším pokrokem
                        const weakTopics = topicsData
                            .filter(t => t.progress < 50 || t.strength === 'weakness')
                            .sort((a, b) => a.progress - b.progress)
                            .slice(0, 3);
                            
                        if (weakTopics.length > 0) {
                            recommendations = weakTopics.map(topic => ({
                                id: topic.topic_id,
                                title: topic.exam_topics?.name || 'Neznámé téma',
                                subject: topic.exam_topics?.subject || 'Obecné',
                                description: 'Toto téma je potřeba více procvičit pro zlepšení vašich výsledků.',
                                type: 'high'
                            }));
                        }
                    }
                    
                    // Pokud stále nemáme žádná doporučení, přidáme obecné doporučení
                    if (recommendations.length === 0) {
                        recommendations = [
                            {
                                id: 'general-1',
                                title: 'Začněte s diagnostickým testem',
                                subject: 'Obecné',
                                description: 'Vyplňte diagnostický test k získání personalizovaných doporučení pro vaše studium.',
                                type: 'high'
                            }
                        ];
                    }
                    
                    // Zobrazení doporučení
                    renderRecommendations(recommendations);
                    
                } catch (error) {
                    console.error('Chyba při načítání doporučení:', error);
                    recommendationsGrid.innerHTML = `
                        <div class="error-message">
                            <i class="fas fa-exclamation-triangle"></i>
                            Nepodařilo se načíst doporučení.
                        </div>
                    `;
                }
            }
            
            // Zobrazení karet pokroku
            function renderProgressCards() {
                // Vytvoření karty pro celkový pokrok
                let html = `
                    <div class="progress-card">
                        <div class="progress-info">
                            <div class="progress-icon general">
                                <i class="fas fa-chart-line"></i>
                            </div>
                            <div>
                                <h3 class="progress-title">Celkový pokrok</h3>
                                <p class="progress-subtitle">Všechny předměty</p>
                            </div>
                        </div>
                        <div class="progress-bar-container">
                            <div class="progress-bar general" style="width: ${userProgress.progress || 0}%"></div>
                        </div>
                        <div class="progress-details">
                            <div class="progress-percentage">${userProgress.progress || 0}%</div>
                            <div class="progress-status">
                                ${userProgress.progress_weekly > 0 ? `+${userProgress.progress_weekly}% tento týden` : 
                                  userProgress.progress_weekly < 0 ? `${userProgress.progress_weekly}% tento týden` : 
                                  'Beze změny tento týden'}
                            </div>
                        </div>
                    </div>
                `;
                
                // Přidání karet pro jednotlivé předměty
                const subjects = userProgress.subjects || {};
                const subjectNames = Object.keys(subjects);
                
                if (subjectNames.length > 0) {
                    subjectNames.forEach(subject => {
                        const progress = subjects[subject];
                        let iconClass = 'math';
                        let icon = 'fa-square-root-alt';
                        
                        // Nastavení ikony podle předmětu
                        if (subject.toLowerCase() === 'matematika') {
                            iconClass = 'math';
                            icon = 'fa-square-root-alt';
                        } else if (subject.toLowerCase() === 'čeština' || subject.toLowerCase() === 'cestina') {
                            iconClass = 'language';
                            icon = 'fa-language';
                        } else {
                            iconClass = 'general';
                            icon = 'fa-book';
                        }
                        
                        html += `
                            <div class="progress-card">
                                <div class="progress-info">
                                    <div class="progress-icon ${iconClass}">
                                        <i class="fas ${icon}"></i>
                                    </div>
                                    <div>
                                        <h3 class="progress-title">${subject}</h3>
                                        <p class="progress-subtitle">${progress.count} dokončených testů</p>
                                    </div>
                                </div>
                                <div class="progress-bar-container">
                                    <div class="progress-bar ${iconClass}" style="width: ${progress.score || 0}%"></div>
                                </div>
                                <div class="progress-details">
                                    <div class="progress-percentage">${progress.score || 0}%</div>
                                    <div class="progress-status">Průměrné skóre</div>
                                </div>
                            </div>
                        `;
                    });
                } else {
                    // Přidání výchozích karet, pokud nemáme žádné předměty
                    html += `
                        <div class="progress-card">
                            <div class="progress-info">
                                <div class="progress-icon math">
                                    <i class="fas fa-square-root-alt"></i>
                                </div>
                                <div>
                                    <h3 class="progress-title">Matematika</h3>
                                    <p class="progress-subtitle">0 dokončených testů</p>
                                </div>
                            </div>
                            <div class="progress-bar-container">
                                <div class="progress-bar math" style="width: 0%"></div>
                            </div>
                            <div class="progress-details">
                                <div class="progress-percentage">0%</div>
                                <div class="progress-status">Začněte s testováním</div>
                            </div>
                        </div>
                        
                        <div class="progress-card">
                            <div class="progress-info">
                                <div class="progress-icon language">
                                    <i class="fas fa-language"></i>
                                </div>
                                <div>
                                    <h3 class="progress-title">Čeština</h3>
                                    <p class="progress-subtitle">0 dokončených testů</p>
                                </div>
                            </div>
                            <div class="progress-bar-container">
                                <div class="progress-bar language" style="width: 0%"></div>
                            </div>
                            <div class="progress-details">
                                <div class="progress-percentage">0%</div>
                                <div class="progress-status">Začněte s testováním</div>
                            </div>
                        </div>
                    `;
                }
                
                // Nastavení HTML do kontejneru
                progressOverview.innerHTML = html;
            }
            
            // Zobrazení statistik pokroku
            function renderProgressStats() {
                // Výpočet počtu dokončených témat
                const completedTopics = topicsData.filter(t => t.progress >= 80).length;
                const totalTopics = topicsData.length;
                const completionRate = totalTopics > 0 ? Math.round((completedTopics / totalTopics) * 100) : 0;
                
                let html = `
                    <div class="stat-item">
                        <div class="stat-label">Dokončené testy</div>
                        <div class="stat-value">
                            ${userProgress.completed_tests || 0}
                            <span class="stat-trend trend-up">+${userProgress.completed_tests - (userProgress.completed_tests_prev || 0) || 0} od posledního týdne</span>
                        </div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Studijní body</div>
                        <div class="stat-value">
                            ${userProgress.points || 0}
                            <span class="stat-trend trend-up">+${userProgress.points_weekly || 0} tento týden</span>
                        </div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Dnů v řadě</div>
                        <div class="stat-value">
                                                        ${userProgress.streak_current || 0}
                            <span class="stat-trend ${userProgress.streak_current >= userProgress.streak_longest ? 'trend-up' : 'trend-neutral'}">
                                ${userProgress.streak_current >= userProgress.streak_longest ? 'Nejdelší série' : `Nejdelší: ${userProgress.streak_longest || 0}`}
                            </span>
                        </div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Dokončená témata</div>
                        <div class="stat-value">
                            ${completedTopics} / ${totalTopics}
                            <span class="stat-trend ${completionRate > 50 ? 'trend-up' : completionRate > 25 ? 'trend-neutral' : 'trend-down'}">
                                ${completionRate}% dokončeno
                            </span>
                        </div>
                    </div>
                `;
                
                // Nastavení HTML do kontejneru
                progressStats.innerHTML = html;
            }
            
            // Inicializace grafu pokroku
            function initProgressChart() {
                const ctx = document.getElementById('progressChart');
                if (!ctx) return;
                
                // Získání dat pro graf
                const chartData = getProgressChartData('week');
                
                // Vytvoření grafu
                progressChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: chartData.labels,
                        datasets: [
                            {
                                label: 'Celkový pokrok',
                                data: chartData.progress,
                                borderColor: '#4361ee',
                                backgroundColor: 'rgba(67, 97, 238, 0.1)',
                                borderWidth: 2,
                                tension: 0.4,
                                fill: true
                            },
                            {
                                label: 'Aktivita',
                                data: chartData.activity,
                                borderColor: '#f72585',
                                backgroundColor: 'rgba(247, 37, 133, 0.1)',
                                borderWidth: 2,
                                tension: 0.4,
                                fill: true
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'top',
                                labels: {
                                    usePointStyle: true,
                                    pointStyle: 'circle',
                                    padding: 15
                                }
                            },
                            tooltip: {
                                mode: 'index',
                                intersect: false,
                                backgroundColor: 'rgba(30, 41, 59, 0.8)',
                                titleColor: '#ffffff',
                                bodyColor: '#e2e8f0',
                                borderColor: 'rgba(67, 97, 238, 0.3)',
                                borderWidth: 1,
                                padding: 10,
                                bodySpacing: 6,
                                titleFont: {
                                    size: 14,
                                    weight: 'bold',
                                    family: 'Poppins'
                                },
                                bodyFont: {
                                    size: 13,
                                    family: 'Poppins'
                                },
                                displayColors: true,
                                boxPadding: 3
                            }
                        },
                        scales: {
                            x: {
                                grid: {
                                    display: false
                                }
                            },
                            y: {
                                beginAtZero: true,
                                max: 100,
                                ticks: {
                                    stepSize: 20
                                },
                                grid: {
                                    color: 'rgba(55, 65, 81, 0.1)'
                                }
                            }
                        },
                        interaction: {
                            intersect: false,
                            mode: 'index'
                        }
                    }
                });
            }
            
            // Aktualizace grafu pokroku
            function updateProgressChart(period) {
                if (!progressChart) return;
                
                // Získání dat pro graf podle vybraného období
                const chartData = getProgressChartData(period);
                
                // Aktualizace dat grafu
                progressChart.data.labels = chartData.labels;
                progressChart.data.datasets[0].data = chartData.progress;
                progressChart.data.datasets[1].data = chartData.activity;
                progressChart.update();
            }
            
            // Získání dat pro graf pokroku
            function getProgressChartData(period) {
                // Výchozí data
                let labels = [];
                let progress = [];
                let activity = [];
                
                const currentDate = new Date();
                let startDate;
                let dateFormat;
                
                // Určení rozsahu dat podle období
                if (period === 'week') {
                    startDate = new Date(currentDate);
                    startDate.setDate(startDate.getDate() - 7);
                    dateFormat = { weekday: 'short' }; // Po, Út, St, ...
                    
                    // Generování dat pro posledních 7 dní
                    for (let i = 6; i >= 0; i--) {
                        const date = new Date(currentDate);
                        date.setDate(date.getDate() - i);
                        labels.push(date.toLocaleDateString('cs-CZ', dateFormat));
                        
                        // Simulace dat pro graf (zde by normálně byla skutečná data z databáze)
                        progress.push(calculateProgressForDate(date));
                        activity.push(calculateActivityForDate(date));
                    }
                } else if (period === 'month') {
                    startDate = new Date(currentDate);
                    startDate.setDate(startDate.getDate() - 30);
                    
                    // Generování dat po týdnech
                    for (let i = 4; i >= 0; i--) {
                        const weekStart = new Date(currentDate);
                        weekStart.setDate(weekStart.getDate() - (i * 7));
                        const weekEnd = new Date(weekStart);
                        weekEnd.setDate(weekEnd.getDate() + 6);
                        
                        const weekLabel = `${weekStart.getDate()}.${weekStart.getMonth()+1} - ${weekEnd.getDate()}.${weekEnd.getMonth()+1}`;
                        labels.push(weekLabel);
                        
                        // Simulace dat pro graf (zde by normálně byla skutečná data z databáze)
                        progress.push(calculateProgressForWeek(weekStart));
                        activity.push(calculateActivityForWeek(weekStart));
                    }
                } else if (period === 'year') {
                    // Generování dat po měsících
                    const monthNames = ['Led', 'Úno', 'Bře', 'Dub', 'Kvě', 'Čer', 'Čvc', 'Srp', 'Zář', 'Říj', 'Lis', 'Pro'];
                    
                    for (let i = 11; i >= 0; i--) {
                        const date = new Date(currentDate);
                        date.setMonth(date.getMonth() - i);
                        labels.push(monthNames[date.getMonth()]);
                        
                        // Simulace dat pro graf (zde by normálně byla skutečná data z databáze)
                        progress.push(calculateProgressForMonth(date));
                        activity.push(calculateActivityForMonth(date));
                    }
                }
                
                return { labels, progress, activity };
            }
            
            // Funkce pro simulaci dat podle datumu
            function calculateProgressForDate(date) {
                // Zde by byly načteny skutečné hodnoty z analytických dat
                // Pro demonstraci použijeme simulované hodnoty, které se postupně zvyšují
                const base = userProgress.progress || 50;
                const dayOffset = date.getDay(); // 0-6
                // Přidáme malý posun podle dne v týdnu
                return Math.min(100, Math.max(0, base - 10 + dayOffset * 3 + getRandom(-5, 5)));
            }
            
            function calculateActivityForDate(date) {
                // Simulované hodnoty pro aktivitu
                const base = 50; // základní aktivita
                const dayOffset = date.getDay(); // 0-6
                
                // Víkendy mají typicky nižší aktivitu
                const weekendPenalty = (dayOffset === 0 || dayOffset === 6) ? -15 : 0;
                
                return Math.min(100, Math.max(0, base + weekendPenalty + getRandom(-10, 10)));
            }
            
            function calculateProgressForWeek(startDate) {
                // Zde by byly načteny skutečné hodnoty z analytických dat
                const weekNumber = Math.floor((startDate - new Date(startDate.getFullYear(), 0, 1)) / (7 * 24 * 60 * 60 * 1000));
                const base = userProgress.progress || 50;
                return Math.min(100, Math.max(0, base - 15 + weekNumber + getRandom(-3, 7)));
            }
            
            function calculateActivityForWeek(startDate) {
                const weekNumber = Math.floor((startDate - new Date(startDate.getFullYear(), 0, 1)) / (7 * 24 * 60 * 60 * 1000));
                return Math.min(100, Math.max(0, 40 + weekNumber * 2 + getRandom(-10, 10)));
            }
            
            function calculateProgressForMonth(date) {
                // Zde by byly načteny skutečné hodnoty z analytických dat
                const monthOffset = date.getMonth();
                const base = userProgress.progress || 50;
                return Math.min(100, Math.max(0, base - 20 + monthOffset * 2 + getRandom(-5, 5)));
            }
            
            function calculateActivityForMonth(date) {
                const monthOffset = date.getMonth();
                return Math.min(100, Math.max(0, 30 + monthOffset * 3 + getRandom(-5, 10)));
            }
            
            function getRandom(min, max) {
                return Math.floor(Math.random() * (max - min + 1)) + min;
            }
            
            // Zobrazení tabulky témat
            function renderTopicsTable(topics) {
                if (!topics || topics.length === 0) {
                    // Prázdný stav
                    topicsTableContainer.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-tasks"></i>
                            <h3>Žádná data o tématech</h3>
                            <p>Zatím nemáte žádný pokrok v tématech. Začněte studovat a vaše výsledky se zobrazí zde.</p>
                            <a href="/dashboard/procvicovani/test1.html" class="btn btn-primary">Začít procvičovat</a>
                        </div>
                    `;
                    return;
                }
                
                // Seřazení témat podle pokroku (vzestupně)
                const sortedTopics = [...topics].sort((a, b) => a.progress - b.progress);
                
                // Vytvoření HTML tabulky
                let html = `
                    <table class="detail-progress-table">
                        <thead>
                            <tr>
                                <th>Téma</th>
                                <th>Předmět</th>
                                <th>Skóre</th>
                                <th>Dokončení</th>
                                <th>Poslední aktivita</th>
                            </tr>
                        </thead>
                        <tbody>
                `;
                
                // Přidání řádků pro každé téma
                sortedTopics.forEach(topic => {
                    // Zjištění předmětu
                    const subject = topic.exam_topics?.subject || 'Obecné';
                    
                    // Určení třídy dokončení
                    let completionClass = 'incomplete';
                    if (topic.progress >= 80) completionClass = 'excellent';
                    else if (topic.progress >= 50) completionClass = 'good';
                    
                    // Formát posledního data aktivity
                    const lastActivity = topic.last_activity ? new Date(topic.last_activity).toLocaleDateString('cs-CZ') : 'Žádná aktivita';
                    
                    html += `
                        <tr data-subject="${subject.toLowerCase()}">
                            <td class="topic-cell">${topic.exam_topics?.name || 'Neznámé téma'}</td>
                            <td>
                                <span class="skill-badge ${subject.toLowerCase() === 'matematika' ? 'math' : 'language'}">${subject}</span>
                            </td>
                            <td class="score-cell">${topic.progress || 0}%</td>
                            <td class="completion-cell">
                                <div class="completion-bar">
                                    <div class="completion-fill ${completionClass}" style="width: ${topic.progress || 0}%"></div>
                                </div>
                            </td>
                            <td class="last-activity-cell">${lastActivity}</td>
                        </tr>
                    `;
                });
                
                html += `
                        </tbody>
                    </table>
                `;
                
                // Zobrazení HTML
                topicsTableContainer.innerHTML = html;
            }
            
            // Filtrování tabulky témat podle předmětu
            function filterTopicsTable(subject) {
                const rows = document.querySelectorAll('.detail-progress-table tbody tr');
                
                if (!rows.length) return;
                
                rows.forEach(row => {
                    if (subject === 'all' || row.dataset.subject === subject) {
                        row.style.display = '';
                    } else {
                        row.style.display = 'none';
                    }
                });
            }
            
            // Zobrazení doporučení
            function renderRecommendations(recommendations) {
                if (!recommendations || recommendations.length === 0) {
                    // Prázdný stav
                    recommendationsGrid.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-lightbulb"></i>
                            <h3>Žádná doporučení</h3>
                            <p>Zatím nemáme žádná doporučení pro váš další pokrok. Dokončete více testů pro získání personalizovaných doporučení.</p>
                        </div>
                    `;
                    return;
                }
                
                let html = '';
                
                // Přidání karty pro každé doporučení
                recommendations.forEach(rec => {
                    let iconClass = 'general';
                    let iconName = 'fa-book';
                    
                    // Určení ikony podle předmětu
                    if (rec.subject.toLowerCase() === 'matematika') {
                        iconClass = 'math';
                        iconName = 'fa-square-root-alt';
                    } else if (rec.subject.toLowerCase() === 'čeština' || rec.subject.toLowerCase() === 'cestina') {
                        iconClass = 'language';
                        iconName = 'fa-language';
                    }
                    
                    html += `
                        <div class="recommendation-card">
                            <div class="recommendation-header">
                                <div class="recommendation-icon ${iconClass}">
                                    <i class="fas ${iconName}"></i>
                                </div>
                                <div class="recommendation-info">
                                    <h3 class="recommendation-title">${rec.title}</h3>
                                    <p class="recommendation-desc">${rec.description}</p>
                                </div>
                            </div>
                            <div class="recommendation-action">
                                <a href="/dashboard/procvicovani/test1.html?topic=${rec.id}" class="btn btn-outline">
                                    <i class="fas fa-play"></i>
                                    Procvičovat
                                </a>
                            </div>
                        </div>
                    `;
                });
                
                // Zobrazení HTML
                recommendationsGrid.innerHTML = html;
            }
            
            // Event listener pro změnu velikosti okna
            window.addEventListener('resize', function() {
                if (window.innerWidth > 576) {
                    sidebar.classList.remove('active');
                    sidebarOverlay.classList.remove('active');
                }
            });
            
            // Inicializace stránky
            init();
        });
    </script>
</body>
</html>