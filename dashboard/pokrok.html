<!DOCTYPE html>
<html lang="cs" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Justax - Přehled pokroku // Kyber-verze</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&family=Inter:wght@400;500;600;700&family=Roboto+Mono:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" crossorigin="anonymous" referrerpolicy="no-referrer" />

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns@3.0.0/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/date-fns@2.29.3/index.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/date-fns/locale/cs/index.js"></script>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tooltipster/4.2.8/css/tooltipster.bundle.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tooltipster/4.2.8/js/tooltipster.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

    <link rel="stylesheet" href="pokrok.css"> </head>

<body class="dark">
    <div class="initial-loading-overlay" id="initial-loader">
        <div class="loading-spinner"></div>
        <p>SYNCHRONIZACE POKROKU...</p>
    </div>

    <div class="toast-container" id="toast-container"></div>

    <div id="sidebar-overlay" class="sidebar-overlay"></div>

    <aside id="sidebar" class="sidebar">
        <div class="sidebar-header">
            <button class="mobile-menu-toggle" id="sidebar-close-toggle"> <i class="fas fa-times"></i> </button>
            <a href="/dashboard/dashboard.html" class="sidebar-logo"> <i class="fas fa-atom"></i> <span>Justax</span> </a>
        </div>
        <ul class="sidebar-menu">
             <li class="sidebar-item"> <a href="/dashboard/dashboard.html" class="sidebar-link"> <i class="fas fa-tachometer-alt"></i> <span>Nástěnka</span> </a> </li>
             <li class="sidebar-item"> <a href="/dashboard/procvicovani/main.html" class="sidebar-link"> <i class="fas fa-laptop-code"></i> <span>Procvičování</span> </a> </li>
             <li class="sidebar-item"> <a href="/dashboard/pokrok.html" class="sidebar-link active"> <i class="fas fa-chart-line"></i> <span>Pokrok</span> </a> </li>
             <li class="sidebar-item"> <a href="/dashboard/oceneni.html" class="sidebar-link"> <i class="fas fa-medal"></i> <span>Ocenění</span> </a> </li>
             <li class="sidebar-item"> <a href="/dashboard/materialy.html" class="sidebar-link"> <i class="fas fa-database"></i> <span>Databanka</span> </a> </li>
             <li class="sidebar-item"> <a href="/dashboard/profile.html" class="sidebar-link"> <i class="fas fa-user-astronaut"></i> <span>Profil</span> </a> </li>
        </ul>
        <div class="user-profile">
            <div class="user-avatar" id="user-avatar">?</div>
            <div class="user-info">
                <div class="user-name" id="user-name">Načítání...</div>
                <div class="user-role">Pilot</div>
            </div>
        </div>
        <div class="sidebar-footer"> &copy; <span id="currentYearSidebar">2025</span> Justax Systems </div>
    </aside>

    <main id="main-content">
        <header class="dashboard-header">
             <div class="header-title">
                  <button class="mobile-menu-toggle" id="mobile-menu-toggle"> <i class="fas fa-bars"></i> </button>
                 <h1><i class="fas fa-chart-network"></i> Přehled pokroku</h1>
                 <div class="header-time" id="current-time"></div>
             </div>
            <div class="header-actions">
                <button class="refresh-btn btn-tooltip" id="refresh-btn" title="Obnovit data">
                    <i class="fas fa-sync-alt"></i>
                    <span class="button-text">Obnovit</span>
                </button>
            </div>
        </header>
        <div class="error-container" id="global-error"></div>

        <div class="main-content-wrapper">
            <div class="stats-grid" id="stats-grid">
                <div class="stats-card loading card" data-type="progress" data-animate style="--animation-order: 1;">
                    <div class="loading-skeleton"> <div class="skeleton-info"> <div class="skeleton title-sm" style="width: 70%;"></div> <div class="skeleton value-lg" style="width: 50%;"></div> <div class="skeleton text-md" style="width: 90%;"></div> </div> <div style="margin-top: auto; border-top: 1px solid transparent; padding-top: 1rem;"> <div class="skeleton text-sm" style="width: 65%;"></div> </div> </div>
                    <div class="stats-card-header"> <h3 class="stats-card-title"><i class="fas fa-tasks"></i>Celkový pokrok</h3> </div>
                    <div class="stats-card-content"> <div class="stats-card-value" id="overall-progress-value">- %</div> <div class="stats-card-description" id="overall-progress-desc">Průměr ze všech oblastí</div> </div>
                    <div class="stats-card-footer" id="overall-progress-footer"><i class="fas fa-minus"></i> Načítání...</div>
                </div>
                <div class="stats-card loading card" data-type="points" data-animate style="--animation-order: 2;">
                     <div class="loading-skeleton"> <div class="skeleton-info"> <div class="skeleton title-sm" style="width: 60%;"></div> <div class="skeleton value-lg" style="width: 40%;"></div> <div class="skeleton text-md" style="width: 80%;"></div> </div> <div style="margin-top: auto; border-top: 1px solid transparent; padding-top: 1rem;"> <div class="skeleton text-sm" style="width: 70%;"></div> </div> </div>
                    <div class="stats-card-header"> <h3 class="stats-card-title"><i class="fas fa-star"></i>Celkem bodů</h3> </div>
                    <div class="stats-card-content"> <div class="stats-card-value" id="total-points-value">-</div> <div class="stats-card-description" id="total-points-desc">Získané za aktivity a testy</div> </div>
                    <div class="stats-card-footer" id="total-points-footer"><i class="fas fa-minus"></i> Načítání...</div>
                </div>
                <div class="stats-card loading card" data-type="streak" data-animate style="--animation-order: 3;">
                     <div class="loading-skeleton"> <div class="skeleton-info"> <div class="skeleton title-sm" style="width: 65%;"></div> <div class="skeleton value-lg" style="width: 30%;"></div> <div class="skeleton text-md" style="width: 85%;"></div> </div> <div style="margin-top: auto; border-top: 1px solid transparent; padding-top: 1rem;"> <div class="skeleton text-sm" style="width: 60%;"></div> </div> </div>
                    <div class="stats-card-header"> <h3 class="stats-card-title"><i class="fas fa-fire"></i>Studijní série</h3> </div>
                    <div class="stats-card-content"> <div class="stats-card-value" id="streak-value">-</div> <div class="stats-card-description" id="streak-desc">Počet dnů studia v řadě</div> </div>
                    <div class="stats-card-footer" id="streak-footer">Nejdelší série: -</div>
                </div>
                <div class="stats-card loading card" data-type="exercises" data-animate style="--animation-order: 4;">
                    <div class="loading-skeleton"> <div class="skeleton-info"> <div class="skeleton title-sm" style="width: 80%;"></div> <div class="skeleton value-lg" style="width: 45%;"></div> <div class="skeleton text-md" style="width: 75%;"></div> </div> <div style="margin-top: auto; border-top: 1px solid transparent; padding-top: 1rem;"> <div class="skeleton text-sm" style="width: 55%;"></div> </div> </div>
                    <div class="stats-card-header"> <h3 class="stats-card-title"><i class="fas fa-check-double"></i>Dokončené aktivity</h3> </div>
                    <div class="stats-card-content"> <div class="stats-card-value" id="completed-count-value">-</div> <div class="stats-card-description" id="completed-count-desc">Počet testů a cvičení</div> </div>
                    <div class="stats-card-footer" id="completed-count-footer"><i class="fas fa-minus"></i> Načítání...</div>
                </div>
            </div>

            <div class="chart-section card" id="progress-chart-section" data-animate style="--animation-order: 5;">
                <div class="loading-overlay hidden" id="chart-loading-overlay"> <div class="loading-spinner"></div> </div>
                <div class="chart-header">
                    <h2 class="chart-title"><i class="fas fa-chart-line"></i>Vývoj pokroku v čase</h2>
                    <div class="chart-actions">
                        <select id="chart-period-select" class="form-control btn-sm btn-secondary" aria-label="Vyberte období grafu">
                            <option value="week">Poslední týden</option>
                            <option value="month" selected>Poslední měsíc</option>
                            <option value="3months">Poslední 3 měsíce</option>
                            <option value="all">Celkově</option>
                        </select>
                    </div>
                </div>
                <div class="chart-container">
                    <canvas id="progressChart"></canvas>
                    <div class="empty-chart-message" id="chart-empty-state" style="display: none;">
                        <i class="fas fa-chart-line"></i>
                        <p>Nedostatek dat pro graf.</p>
                    </div>
                </div>
            </div>

            <div class="data-table-section card" id="activities-section" data-animate style="--animation-order: 6;">
                <div class="loading-overlay hidden" id="table-loading-overlay"> <div class="loading-spinner"></div> </div>
                <div class="data-table-header">
                    <h2 class="data-table-title"><i class="fas fa-history"></i>Historie aktivit</h2>
                    <div class="data-table-actions">
                        <button class="btn btn-secondary btn-sm btn-tooltip" id="export-table-btn" title="Exportovat tabulku jako CSV">
                            <i class="fas fa-download"></i>
                            <span class="button-text">Export</span>
                        </button>
                        <select id="activity-type-filter" class="form-control btn-sm btn-secondary" aria-label="Filtrovat typ aktivity">
                            <option value="all">Všechny typy</option>
                            <option value="test">Testy</option>
                            <option value="diagnostic">Diagnostika</option>
                            <option value="exercise">Cvičení</option>
                            <option value="lesson">Lekce</option>
                            <option value="badge">Odznaky</option>
                            <option value="plan_generated">Plány</option>
                            <option value="level_up">Postup</option>
                            <option value="other">Jiné</option>
                        </select>
                    </div>
                </div>
                <div class="table-responsive">
                    <table class="data-table" id="activities-table" style="display: none;">
                        <thead>
                            <tr>
                                <th data-sort="created_at">Datum <i class="fas fa-sort"></i></th>
                                <th data-sort="type">Typ <i class="fas fa-filter"></i></th>
                                <th data-sort="title">Název / Popis</th>
                                <th data-sort="points_earned">Body <i class="fas fa-sort"></i></th>
                                <th data-sort="status">Stav</th>
                            </tr>
                        </thead>
                        <tbody id="activities-body">
                            </tbody>
                    </table>
                </div>
                <div class="empty-state" id="activities-empty-state" style="display: none;">
                    <i class="fas fa-box-open"></i>
                    <p>Zatím žádné zaznamenané aktivity.</p>
                </div>
                <div class="pagination-controls" id="pagination-controls" style="display: none;">
                    <button class="btn btn-secondary btn-sm" id="prev-page-btn" disabled><i class="fas fa-chevron-left"></i></button>
                    <span id="page-info">Strana 1 z 1</span>
                    <button class="btn btn-secondary btn-sm" id="next-page-btn" disabled><i class="fas fa-chevron-right"></i></button>
                </div>
            </div>
            <footer class="dashboard-footer">
                <p>&copy; <span id="currentYearFooter">2025</span> Justax Systems // Secure Channel</p>
            </footer>
        </div>
    </main>

    <div id="mouse-follower" class="mouse-follower-glow"></div>

    <script src="pokrok.js" defer></script> </body>
</html>