<!DOCTYPE html>
<html lang="ru" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Justax - Аватарка</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&family=Inter:wght@400;500;600;700&family=Roboto+Mono:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link rel="stylesheet" href="dashboard.css">
    <style>
      /* Стили для страницы аватара */
      #avatar-container {
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        margin-left: 260px; /* Ширина боковой панели */
      }
      .avatar-wrapper {
        position: relative;
        width: 200px; /* Больший размер аватара */
        height: 200px;
        border-radius: 50%;
        overflow: hidden;
        border: 4px solid var(--accent-primary);
        box-shadow: 0 0 25px rgba(var(--accent-primary-rgb), 0.5);
      }
      .avatar-wrapper img {
        width: 100%;
        height: 100%;
        object-fit: cover;
      }
      .avatar-placeholder {
        width: 100%;
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        background-color: var(--accent-secondary);
        color: var(--white);
        font-size: 4rem;
        font-weight: 600;
      }
    </style>
</head>
<body class="dark">
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <a href="/dashboard/dashboard.html" class="sidebar-logo">
                <i class="fas fa-atom"></i>
                <span>Justax</span>
            </a>
        </div>
        <ul class="sidebar-menu">
            <li class="sidebar-item">
                <a href="#" class="sidebar-link active">
                    <i class="fas fa-user-astronaut"></i>
                    <span>Профиль</span>
                </a>
            </li>
        </ul>
        <div class="user-profile">
            <div class="user-avatar" id="sidebar-avatar">?</div>
            <div class="user-info">
                <div class="user-name" id="sidebar-name">Загрузка...</div>
                <div class="user-role" id="sidebar-user-title">Пилот</div>
            </div>
        </div>
        <div class="sidebar-footer">
            &copy; 2025 Justax Systems
        </div>
    </aside>

    <main id="main-content">
        <div id="avatar-container">
             <div class="avatar-wrapper">
                  <div class="avatar-placeholder" id="avatar-placeholder">?</div>
             </div>
        </div>
    </main>

    <script>
    const supabaseUrl = 'https://qcimhjjwvsbgjsitmvuh.supabase.co';
    const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFjaW1oamp3dnNiZ2pzaXRtdnVoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDI1ODA5MjYsImV4cCI6MjA1ODE1NjkyNn0.OimvRtbXuIUkaIwveOvqbMd_cmPN5yY3DbWCBYc9D10';
    const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

    async function loadUserProfile() {
        const user = await supabase.auth.getUser();
        const userId = user.data?.user?.id;

        if (userId) {
            const { data: profile, error } = await supabase
                .from('profiles')
                .select('first_name, last_name, avatar_url')
                .eq('id', userId)
                .single();

            if (error) {
                console.error('Error fetching profile:', error);
                return;
            }

            const firstName = profile?.first_name || '';
            const lastName = profile?.last_name || '';
            const displayName = `${firstName} ${lastName}`.trim() || 'Пилот';
            document.getElementById('sidebar-name').textContent = displayName;

            const avatarUrl = profile?.avatar_url;
            const avatarElement = document.getElementById('avatar-placeholder');

            if (avatarUrl) {
                const img = document.createElement('img');
                img.src = avatarUrl;
                img.alt = 'Аватар пользователя';
                avatarElement.innerHTML = '';
                avatarElement.appendChild(img);
            } else {
                avatarElement.textContent = displayName.charAt(0).toUpperCase();
            }
        }
    }

    loadUserProfile();
    </script>
</body>
</html>
