<!DOCTYPE html>
<html lang="ru" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Justax - Улучшенные аватарки</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&family=Inter:wght@400;500;600;700&family=Roboto+Mono:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
        /* --- START: Rewritten and Enhanced CSS v2 --- */
        /* Глобальные переменные */
        :root {
            --bg-color: #03020c; --bg-secondary: #0a071f; --bg-secondary-rgb: 10, 7, 31;
            --card-bg: rgba(15, 10, 45, 0.88); --card-solid: #0f0a2d; --card-solid-rgb: 15, 10, 45;
            --interface-bg: rgba(6, 4, 22, 0.92); --interface-border: rgba(0, 240, 255, 0.35);
            --dark-purple-accent: #160c41; --accent-primary: #00e0ff; --accent-primary-rgb: 0, 224, 255;
            --accent-secondary: #a05cff; --accent-secondary-rgb: 160, 92, 255;
            --accent-pink: #ff33a8; --accent-pink-rgb: 255, 51, 168;
            --accent-lime: #6fff3a; --accent-lime-rgb: 111, 255, 58;
            --accent-cyan: var(--accent-primary); --accent-cyan-rgb: var(--accent-primary-rgb);
            --accent-cyan-glow: rgba(var(--accent-cyan-rgb), 0.6); --accent-glow: rgba(var(--accent-primary-rgb), 0.6);
            --accent-secondary-glow: rgba(var(--accent-secondary-rgb), 0.5);
            --text-light: #f1f5f9; --text-medium: #b8c4e0; --text-muted: #808db0;
            --text-heading: #ffffff; --text-link: var(--accent-primary); --text-link-hover: #ffffff;
            --text-fixed-dark: #03020c; --white: #ffffff; --white-rgb: 255, 255, 255; --black: #000000;
            --border-color-light: rgba(var(--accent-secondary-rgb), 0.25); --border-color-medium: rgba(var(--accent-secondary-rgb), 0.45);
            --border-color-strong: rgba(var(--accent-primary-rgb), 0.65); --border-interactive: var(--accent-primary);
            --gradient-button: linear-gradient(100deg, var(--accent-secondary) 0%, var(--accent-primary) 100%);
            --gradient-button-hover: linear-gradient(100deg, var(--accent-primary) 0%, var(--accent-pink) 100%);
            --gradient-sidebar: linear-gradient(190deg, var(--bg-secondary) 0%, var(--dark-purple-accent) 100%);
            --gradient-profile-avatar: linear-gradient(145deg, var(--accent-primary), var(--accent-secondary));
            --font-primary: 'Inter', sans-serif; --font-secondary: 'Poppins', sans-serif; --font-mono: 'Roboto Mono', monospace;
            --shadow-glow: 0 0 25px var(--accent-glow); --shadow-card: 0 12px 40px rgba(0, 0, 0, 0.4);
            --shadow-interactive: 0 8px 20px rgba(var(--accent-primary-rgb), 0.4);
            --shadow-hud: 0 4px 15px rgba(0,0,0,0.3), inset 0 1px 2px rgba(var(--accent-primary-rgb), 0.1);
            --shadow-text-glow: 0 0 8px rgba(var(--accent-primary-rgb), 0.6);
            --shadow-card-hover-enhanced: 0 18px 50px rgba(0, 0, 0, 0.45), 0 0 30px var(--accent-glow), inset 0 0 15px rgba(var(--accent-primary-rgb), 0.15);
            --sidebar-width: 260px; --sidebar-collapsed-width: 80px;
            --card-radius: 14px; --button-radius: 10px;
            --container-padding-x: 2rem;
            --transition-fast: all 0.2s ease-out; --transition-medium: all 0.35s cubic-bezier(0.4, 0, 0.2, 1);
            --avatar-size: 150px;
        }

        /* Базовые стили */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html { scroll-behavior: smooth; font-size: 16px; }
        body { background-color: var(--bg-color); color: var(--text-medium); font-family: var(--font-primary); line-height: 1.7; min-height: 100vh; display: flex; overflow: hidden; position: relative; }
        body::before { content: ""; position: fixed; inset: 0; z-index: -3; background-image: linear-gradient(rgba(var(--accent-secondary-rgb), 0.04) 1px, transparent 1px), linear-gradient(90deg, rgba(var(--accent-secondary-rgb), 0.04) 1px, transparent 1px); background-size: 40px 40px; opacity: 0.6; pointer-events: none; }
        h1 { font-family: var(--font-secondary); font-weight: 700; color: var(--text-heading); margin-bottom: 1em; font-size: clamp(1.6rem, 3vw, 1.9rem); }
        a { color: var(--text-link); text-decoration: none; }
        a:hover { color: var(--text-link-hover); }
        a:focus-visible, button:focus-visible { outline: 3px solid var(--accent-primary); outline-offset: 4px; border-radius: 6px; }
        :is(a, button):focus { outline: none; }

        /* Кнопки */
        .btn { display: inline-flex; align-items: center; justify-content: center; gap: 0.5em; padding: 0.6rem 1.2rem; background: transparent; color: var(--accent-primary); border: 2px solid var(--accent-primary); border-radius: var(--button-radius); font-family: var(--font-secondary); font-weight: 600; font-size: 0.9rem; cursor: pointer; transition: all var(--transition-medium); }
        .btn:hover:not(:disabled) { color: var(--text-fixed-dark); background: var(--gradient-button); border-color: transparent; transform: translateY(-2px); }
        .btn-icon-only { padding: 0.5rem; width: 38px; height: 38px; border-radius: 50%; border: 1px solid var(--border-color-medium); color: var(--text-muted); background-color: rgba(var(--bg-secondary-rgb), 0.3); }
        .btn-icon-only i { margin-right: 0; font-size: 1rem; transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1); }
        .btn-icon-only:hover:not(:disabled) { background-color: rgba(var(--accent-primary-rgb), 0.15); border-color: var(--accent-primary); color: var(--accent-primary); }
        .sidebar-toggle-btn { margin-right: 0.8rem; display: none; }
        @media (min-width: 993px) { .sidebar-toggle-btn { display: inline-flex; } }

        /* --- Sidebar (Kept for consistency) --- */
        .sidebar { width: var(--sidebar-width); height: 100vh; position: fixed; top: 0; left: 0; background: var(--gradient-sidebar); color: var(--text-medium); padding: 1.5rem 1rem; display: flex; flex-direction: column; z-index: 1000; box-shadow: 5px 0 30px rgba(0, 0, 0, 0.4); border-right: 1px solid var(--border-color-light); transition: width var(--transition-medium), transform var(--transition-medium) ease; overflow: hidden; }
        .sidebar-header { display: flex; align-items: center; margin-bottom: 2.5rem; padding: 0 0.5rem; position: relative; min-height: 45px; transition: padding var(--transition-medium) ease; }
        .mobile-menu-toggle { display: none; background: none; border: none; color: var(--text-muted); font-size: 1.6rem; cursor: pointer; padding: 0.5rem; z-index: 1010; }
        @media (max-width: 992px) { .mobile-menu-toggle#main-mobile-menu-toggle { display: block; } }
        #sidebar-close-toggle { display: none; position: absolute; right: 0px; top: 50%; transform: translateY(-50%); background: none; border: none; color: var(--text-muted); font-size: 1.8rem; cursor: pointer; padding: 0.5rem; line-height: 1; }
        .sidebar-logo { font-size: 1.7rem; font-weight: 700; color: var(--text-heading); text-decoration: none; display: flex; align-items: center; gap: 0.8rem; transition: gap var(--transition-medium) ease; width: 100%; }
        .sidebar-logo i { font-size: 1.8rem; color: var(--accent-secondary); flex-shrink: 0; }
        .sidebar-logo span { transition: opacity 0.1s linear, max-width 0.2s linear 0.1s; opacity: 1; max-width: 150px; overflow: hidden; white-space: nowrap; display: inline-block; }
        .sidebar-menu { list-style: none; padding: 0; margin: 0; flex-grow: 1; overflow-y: auto; overflow-x: hidden; scrollbar-width: none; }
        .sidebar-menu::-webkit-scrollbar { display: none; }
        .sidebar-item { margin-bottom: 0.6rem; }
        .sidebar-link { display: flex; align-items: center; padding: 0.85rem 1rem; color: var(--text-medium); text-decoration: none; border-radius: var(--button-radius); transition: background-color 0.25s ease, color 0.25s ease, border-left-color 0.25s ease; font-weight: 500; position: relative; border-left: 4px solid transparent; overflow: hidden; white-space: nowrap; }
        .sidebar-link i { margin-right: 0.85rem; font-size: 1.25rem; width: 25px; text-align: center; transition: color 0.25s ease, margin-right var(--transition-medium) ease, font-size var(--transition-medium) ease; color: var(--text-muted); flex-shrink: 0; }
        .sidebar-link span { transition: opacity 0.1s linear, max-width 0.2s linear 0.1s; opacity: 1; max-width: 150px; overflow: hidden; white-space: nowrap; display: inline-block; vertical-align: middle;}
        .sidebar-link:hover { background-color: rgba(var(--accent-primary-rgb), 0.1); color: var(--text-light); }
        .sidebar-link:hover i { color: var(--accent-primary); }
        .sidebar-link.active { background-color: rgba(var(--accent-primary-rgb), 0.15); color: var(--white); font-weight: 600; border-left-color: var(--accent-primary); }
        .sidebar-link.active i { color: var(--accent-primary); }
        .user-profile { display: flex; align-items: center; padding: 1rem; margin-top: 1.5rem; background-color: rgba(var(--accent-secondary-rgb), 0.1); border-radius: 12px; border: 1px solid var(--border-color-light); flex-shrink: 0; transition: padding var(--transition-medium) ease; overflow: hidden; white-space: nowrap; }
        .user-profile .avatar-wrapper { position: relative; display: inline-block; line-height: 0; margin-right: 0.85rem; transition: margin-right var(--transition-medium) ease; flex-shrink: 0; width: 42px; height: 42px; background: none; padding: 0; border-radius: 50%; }
        .user-avatar { width: 100%; height: 100%; border-radius: 50%; background-color: var(--accent-secondary); display: flex; align-items: center; justify-content: center; font-weight: 600; font-size: 1.1rem; overflow: hidden; color: var(--white); border: 2px solid rgba(var(--accent-primary-rgb), 0.3); transition: all var(--transition-medium) ease; position: relative; }
        .user-avatar img { width: 100%; height: 100%; object-fit: cover; }
        .user-info { flex-grow: 1; overflow: hidden; transition: opacity 0.1s linear, max-width 0.2s linear 0.1s; opacity: 1; max-width: 150px; }
        .user-name { font-weight: 600; font-size: 1rem; color: var(--text-light); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .user-role { font-size: 0.8rem; color: var(--text-muted); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .sidebar-footer { margin-top: 1.5rem; padding: 1rem; font-size: 0.8rem; color: var(--text-muted); text-align: center; flex-shrink: 0; opacity: 0.7; transition: opacity 0.2s ease, max-width 0.2s linear 0.1s; overflow: hidden; white-space: nowrap; max-width: 200px; }

        /* Стили свернутого Sidebar */
        body.sidebar-collapsed .sidebar { width: var(--sidebar-collapsed-width); }
        body.sidebar-collapsed .sidebar-logo span, body.sidebar-collapsed .sidebar-link span, body.sidebar-collapsed .user-info, body.sidebar-collapsed .sidebar-footer { opacity: 0; max-width: 0; }
        body.sidebar-collapsed .sidebar-header, body.sidebar-collapsed .sidebar-logo { padding-left: 0; padding-right: 0; justify-content: center; gap: 0; }
        body.sidebar-collapsed .sidebar-link { justify-content: center; padding: 0.85rem 0.5rem; }
        body.sidebar-collapsed .sidebar-link i { margin-right: 0; font-size: 1.4rem; }
        body.sidebar-collapsed .user-profile { padding: 0.8rem 0; justify-content: center; }
        body.sidebar-collapsed .user-profile .avatar-wrapper { margin-right: 0; width: 40px; height: 40px; padding: 0; background: none; }
        body.sidebar-collapsed .user-avatar { font-size: 1rem; width: 100%; height: 100%; }
        body.sidebar-collapsed main#main-content { margin-left: var(--sidebar-collapsed-width); width: calc(100% - var(--sidebar-collapsed-width)); }
        body.sidebar-collapsed .sidebar-toggle-btn i { transform: rotate(180deg); }

        /* Основной контент */
        main#main-content { flex: 1; margin-left: var(--sidebar-width); transition: margin-left var(--transition-medium), width var(--transition-medium); width: calc(100% - var(--sidebar-width)); height: 100vh; display: flex; flex-direction: column; overflow: hidden; }
        .dashboard-header { margin-bottom: 1rem; background-color: rgba(var(--bg-secondary-rgb), 0.7); backdrop-filter: blur(10px); border-radius: 0 0 var(--card-radius) var(--card-radius); padding: 0.8rem var(--container-padding-x); box-shadow: var(--shadow-hud); display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem; position: sticky; top: 0; z-index: 900; border-bottom: 1px solid var(--border-color-light); flex-shrink: 0; }
        .header-content { display: flex; justify-content: space-between; align-items: center; width: 100%; }
        .header-left-group { display: flex; align-items: center; gap: 0.8rem; }
        .header-actions { display: flex; align-items: center; gap: 1rem; }
        #dashboard-title { margin: 0; font-size: 1.6rem;}
        #dashboard-title i { color: var(--accent-primary); margin-right: 0.5rem; }
        .main-content-wrapper { flex-grow: 1; overflow-y: auto; padding: 1.5rem var(--container-padding-x); scrollbar-width: thin; scrollbar-color: rgba(var(--accent-primary-rgb), 0.6) rgba(var(--bg-secondary-rgb), 0.3); }
        .main-content-wrapper::-webkit-scrollbar { width: 8px; height: 8px; }
        .main-content-wrapper::-webkit-scrollbar-track { background: rgba(var(--bg-secondary-rgb), 0.3); border-radius: 4px;}
        .main-content-wrapper::-webkit-scrollbar-thumb { background-color: rgba(var(--accent-primary-rgb), 0.6); border-radius: 4px; border: 2px solid transparent; background-clip: content-box; }
        .main-content-wrapper::-webkit-scrollbar-thumb:hover { background-color: rgba(var(--accent-primary-rgb), 0.9); }

        /* --- AVATAR DISPLAY AREA --- */
        #avatar-display-area { display: grid; grid-template-columns: repeat(auto-fit, minmax(var(--avatar-size), 1fr)); gap: 2.5rem; justify-items: center; padding-bottom: 2rem; }

        .avatar-wrapper {
            width: var(--avatar-size); height: var(--avatar-size);
            position: relative; display: flex; align-items: center; justify-content: center;
            border-radius: 50%; background-color: rgba(var(--card-solid-rgb), 0.5);
            box-shadow: var(--shadow-card);
            transition: transform var(--transition-medium), box-shadow var(--transition-medium);
            cursor: pointer;
        }
        .avatar-wrapper:hover { transform: translateY(-4px) scale(1.04); box-shadow: var(--shadow-card-hover-enhanced); }
        .avatar-content { width: 85%; height: 85%; border-radius: 50%; background-color: var(--accent-secondary); color: var(--white); display: flex; align-items: center; justify-content: center; overflow: hidden; position: relative; z-index: 1; box-sizing: border-box; }
        .avatar-content img { display: block; width: 100%; height: 100%; object-fit: cover; }
        .avatar-content .avatar-placeholder { font-size: 2.5rem; font-weight: 600; line-height: 1; text-shadow: 1px 1px 2px rgba(0,0,0,0.4); }

        /* --- NEW FRAME STYLES v2 --- */
        /* 1. Корона (Crown Frame) - Kept */
        .avatar-frame-crown { border: 3px solid gold; box-shadow: 0 0 15px gold, inset 0 0 5px rgba(255, 215, 0, 0.3); }
        .avatar-frame-crown::before { content: '👑'; font-size: calc(var(--avatar-size) * 0.25); position: absolute; top: -15%; left: 50%; transform: translateX(-50%); color: gold; text-shadow: 0 2px 4px rgba(0,0,0,0.5); z-index: 2; }

        /* 2. Венок из цветов (Flower Wreath) - Simulated */
        .avatar-frame-wreath { border: 4px dashed transparent; position: relative; background-color: transparent; box-shadow: none; }
        .avatar-frame-wreath::before, .avatar-frame-wreath::after { content: ''; position: absolute; border-radius: 50%; z-index: 0; }
        .avatar-frame-wreath::before { /* Leaves */ inset: -6px; border: 6px solid transparent; background: conic-gradient(from 0deg, #2e8b57 0 30deg, #90ee90 30deg 60deg, #3cb371 60deg 90deg, transparent 90deg 180deg, #2e8b57 180deg 210deg, #90ee90 210deg 240deg, #3cb371 240deg 270deg, transparent 270deg 360deg); animation: wreathRotate 15s linear infinite; }
        .avatar-frame-wreath::after { /* Flowers */ inset: -8px; border: 2px solid transparent; background: radial-gradient(circle at 15% 15%, #ff69b4 5px, transparent 5px), radial-gradient(circle at 85% 85%, #ffb6c1 4px, transparent 4px), radial-gradient(circle at 15% 85%, #ff1493 6px, transparent 6px), radial-gradient(circle at 85% 15%, #db7093 5px, transparent 5px); background-size: 100% 100%; background-repeat: no-repeat; animation: wreathRotate 15s linear infinite reverse; }
        @keyframes wreathRotate { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }

        /* 3. Стиль Загрузки (Loading) - Animated border segments */
        .avatar-frame-loading { border: 4px solid transparent; background: conic-gradient(var(--accent-primary) 0% 25%, transparent 25% 100%); animation: loadingRotate 1.5s linear infinite; }
        @keyframes loadingRotate { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }

        /* 4. Пиратский Стиль (Pirate - Bones) - Simulated with pseudo-elements */
        .avatar-frame-pirate { border: 3px solid #8B4513; /* Dark wood color */ background: #deb887; /* BurlyWood background */ }
        .avatar-frame-pirate::before, .avatar-frame-pirate::after { content: '🦴'; /* Bone emoji or use FontAwesome/SVG */ font-size: calc(var(--avatar-size) * 0.25); color: #f5f5f5; /* WhiteSmoke */ position: absolute; z-index: 2; text-shadow: 1px 1px 3px #333; }
        .avatar-frame-pirate::before { bottom: -10%; left: -5%; transform: rotate(-35deg); }
        .avatar-frame-pirate::after { bottom: -10%; right: -5%; transform: rotate(35deg) scaleX(-1); } /* Flipped */

        /* 5. Глитч (Glitch) */
        .avatar-frame-glitch { border: 2px solid transparent; position: relative; overflow: hidden; }
        .avatar-frame-glitch::before, .avatar-frame-glitch::after { content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: inherit; border-radius: 50%; }
        .avatar-frame-glitch::before { background: var(--accent-cyan); mix-blend-mode: screen; animation: glitchAnim1 1.5s infinite linear alternate-reverse; }
        .avatar-frame-glitch::after { background: var(--accent-pink); mix-blend-mode: screen; animation: glitchAnim2 1s infinite linear alternate-reverse; }
        .avatar-frame-glitch > .avatar-content { mix-blend-mode: darken; /* Blend avatar with glitches */ }
        @keyframes glitchAnim1 { 0% { transform: translate(0); } 20% { transform: translate(-3px, 3px); } 40% { transform: translate(3px, -3px); } 60% { transform: translate(-3px, -3px); } 80% { transform: translate(3px, 3px); } 100% { transform: translate(0); } }
        @keyframes glitchAnim2 { 0% { transform: translate(0); } 25% { transform: translate(4px, -2px); } 50% { transform: translate(-2px, 4px); } 75% { transform: translate(2px, 2px); } 100% { transform: translate(0); } }

        /* 6. Схема (Circuit Board) */
        .avatar-frame-circuit {
            border: 3px solid #00ff7f; /* SpringGreen */
            background: #006400; /* DarkGreen */
            background-image: linear-gradient(rgba(0, 255, 127, 0.15) 1px, transparent 1px), linear-gradient(90deg, rgba(0, 255, 127, 0.15) 1px, transparent 1px);
            background-size: 10px 10px, 10px 10px;
            background-position: -1px -1px, -1px -1px;
            box-shadow: inset 0 0 10px rgba(0,255,127,0.4), 0 0 10px rgba(0,255,127,0.4);
            padding: 2px;
        }

        /* 7. Пузырьки (Bubbles) */
        .avatar-frame-bubbles {
            border: 3px solid #87CEEB; /* SkyBlue */
            background: radial-gradient(circle at 70% 20%, #E0FFFF 5%, transparent 20%), radial-gradient(circle at 30% 80%, #AFEEEE 8%, transparent 25%), var(--bg-secondary);
            position: relative;
        }
        .avatar-frame-bubbles::after { /* Animated bubble */
             content: ''; position: absolute; bottom: 5%; left: 15%; width: 10%; height: 10%; background: rgba(175, 238, 238, 0.6); border-radius: 50%; animation: bubbleFloat 4s infinite ease-in-out; box-shadow: inset 0 0 3px white;
        }
        @keyframes bubbleFloat { 0% { transform: translateY(0) scale(1); opacity: 0.6; } 50% { transform: translateY(-40px) scale(1.3) translateX(10px); opacity: 0.8; } 100% { transform: translateY(-80px) scale(0.7); opacity: 0; } }

        /* 8. Геометрия (Geometric) */
        .avatar-frame-geometric {
            border: 4px solid var(--accent-secondary);
            background: repeating-conic-gradient(var(--dark-purple-accent) 0% 15%, var(--accent-secondary) 15% 30%);
            padding: 0;
            box-shadow: 0 0 15px rgba(var(--accent-secondary-rgb), 0.5);
        }

        /* 9. Клякса (Ink Splatter) */
        .avatar-frame-ink {
            border: none;
            background-color: var(--bg-secondary);
            filter: url(#ink-splatter-filter); /* Requires SVG filter */
             /* Fallback simple shadow */
            box-shadow: 0 0 5px 5px var(--black), 0 0 10px 10px var(--accent-pink);
        }
        /* Add SVG filter definition somewhere (can be inline in HTML body or linked) */
        /* <svg style="visibility: hidden; position: absolute;" width="0" height="0" xmlns="http://www.w3.org/2000/svg" version="1.1">
            <defs>
                <filter id="ink-splatter-filter">
                    <feTurbulence type="fractalNoise" baseFrequency="0.02 0.05" numOctaves="3" result="turbulence"/>
                    <feDisplacementMap in2="turbulence" in="SourceGraphic" scale="15" xChannelSelector="R" yChannelSelector="G"/>
                </filter>
            </defs>
        </svg> */

        /* 10. Неоновая вывеска (Neon Sign) */
        .avatar-frame-neon-sign {
            border: 2px solid #fff;
            border-radius: 50%;
            box-shadow: 0 0 5px #fff, 0 0 10px #fff, 0 0 15px var(--accent-pink), 0 0 20px var(--accent-pink), inset 0 0 5px rgba(var(--accent-pink-rgb), 0.5);
        }

        /* 11. Швы (Stitches) */
        .avatar-frame-stitches {
            border: 4px dashed #CD853F; /* Peru */
            padding: 3px;
            background: #F5F5DC; /* Beige */
        }
        .avatar-frame-stitches .avatar-content { border: 1px solid #8B4513; }

        /* Add more frames as needed... */
        .avatar-frame-default { /* Simple fallback */
             border: 3px solid var(--border-color-medium);
        }

        /* --- END FRAME STYLES --- */


        /* Футер */
        .dashboard-footer { margin-top: auto; padding: 1.5rem var(--container-padding-x); text-align: center; color: var(--text-muted); font-size: 0.9rem; border-top: 1px solid var(--border-color-light); opacity: 0.6; flex-shrink: 0; }

        /* Оверлей для мобильного меню */
        .sidebar-overlay { display: none; position: fixed; inset: 0; background-color: rgba(3, 2, 12, 0.7); z-index: 999; opacity: 0; transition: opacity var(--transition-medium) ease; backdrop-filter: blur(5px); }
        .sidebar-overlay.active { display: block; opacity: 1; }

        /* Адаптивность */
        @media (max-width: 1200px) {
            :root { --avatar-size: 130px; }
            #avatar-display-area { gap: 2rem; }
        }
        @media (max-width: 992px) {
            :root { --avatar-size: 120px; }
            .main-content-wrapper { padding: 1.5rem 1rem; }
            #avatar-display-area { gap: 2rem; }
        }
        @media (max-width: 768px) {
            :root { --avatar-size: 100px; }
            main { padding: 0 1rem; }
            .dashboard-header { padding: 0.8rem 1rem; margin-left: -1rem; margin-right: -1rem; }
            .header-content { flex-direction: column; align-items: stretch; }
            .header-left-group { justify-content: space-between;}
            .main-content-wrapper { padding: 1rem; }
            #avatar-display-area { gap: 1.5rem; grid-template-columns: repeat(auto-fit, minmax(var(--avatar-size), 1fr)); }
            .avatar-content .avatar-placeholder { font-size: 1.8rem; }
            .avatar-frame-crown::before { font-size: calc(var(--avatar-size) * 0.22); top: -12%; }
            .avatar-frame-pirate::before, .avatar-frame-pirate::after { font-size: calc(var(--avatar-size) * 0.22); }
        }
        @media (max-width: 576px) {
            :root { --avatar-size: 80px; }
            main { padding: 0 0.75rem; margin-left: 0; width: 100%; }
            .sidebar { transform: translateX(-110%); width: 280px; z-index: 1000; }
            .sidebar.active { transform: translateX(0); }
            .sidebar.active .sidebar-logo span, .sidebar.active .sidebar-link span, .sidebar.active .user-info, .sidebar.active .sidebar-footer { display: block; }
            .sidebar.active .sidebar-link i { margin-right: 0.85rem; font-size: 1.25rem; }
            .sidebar.active .sidebar-header, .sidebar.active .sidebar-link { justify-content: flex-start; }
            .sidebar.active .user-profile { padding: 1rem; }
            .sidebar.active .user-profile .avatar-wrapper { margin-right: 0.85rem; width: 42px; height: 42px; padding: 0; background: none; }
            .sidebar.active .user-avatar { font-size: 1.1rem; width: 100%; height: 100%; }
            .sidebar-toggle-btn { display: none; }
            #dashboard-title { font-size: 1.4rem; }
            .main-content-wrapper { padding: 1rem 0.5rem; }
            #avatar-display-area { gap: 1.2rem; }
            .avatar-content .avatar-placeholder { font-size: 1.5rem; }
             .avatar-frame-crown::before { font-size: calc(var(--avatar-size) * 0.2); top: -10%; }
             .avatar-frame-pirate::before, .avatar-frame-pirate::after { font-size: calc(var(--avatar-size) * 0.2); }
        }

        /* Уменьшение движения */
        @media (prefers-reduced-motion: reduce) { html { scroll-behavior: auto; } *, *::before, *::after { animation-duration: 0.01ms !important; animation-iteration-count: 1 !important; transition-duration: 0.01ms !important; } .sidebar, main { transition: none !important; } .btn-icon-only i { transition: none !important; } /* Disable frame animations */ .avatar-frame-fire { animation: none; } .avatar-frame-wind::before { animation: none; } .avatar-frame-water::after { animation: none; } .avatar-frame-electric { animation: none; } .avatar-frame-wreath::before, .avatar-frame-wreath::after { animation: none; } .avatar-frame-loading { animation: none; background: var(--accent-primary); } .avatar-frame-glitch::before, .avatar-frame-glitch::after { animation: none; transform: none; } }
        /* --- END: Rewritten and Enhanced CSS v2 --- */
    </style>
</head>
<body class="dark">

    <div class="sidebar-overlay" id="sidebar-overlay"></div>

    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <button class="mobile-menu-toggle" id="sidebar-close-toggle" aria-label="Zavřít menu"> <i class="fas fa-times"></i> </button>
            <a href="/dashboard/dashboard.html" class="sidebar-logo"> <i class="fas fa-atom"></i> <span>Justax</span> </a>
        </div>
        <ul class="sidebar-menu">
            <li class="sidebar-item"> <a href="/dashboard/dashboard.html" class="sidebar-link"> <i class="fas fa-tachometer-alt"></i> <span>Nástěnka</span> </a> </li>
            <li class="sidebar-item"> <a href="/dashboard/procvicovani/main.html" class="sidebar-link"> <i class="fas fa-laptop-code"></i> <span>Procvičování</span> </a> </li>
            <li class="sidebar-item"> <a href="/dashboard/pokrok.html" class="sidebar-link"> <i class="fas fa-chart-line"></i> <span>Pokrok</span> </a> </li>
            <li class="sidebar-item"> <a href="/dashboard/oceneni.html" class="sidebar-link"> <i class="fas fa-medal"></i> <span>Ocenění</span> </a> </li>
            <li class="sidebar-item"> <a href="/dashboard/materialy.html" class="sidebar-link"> <i class="fas fa-database"></i> <span>Databanka</span> </a> </li>
            <li class="sidebar-item"> <a href="/dashboard/profile.html" class="sidebar-link active"> <i class="fas fa-user-astronaut"></i> <span>Profil</span> </a> </li>
        </ul>
        <div class="user-profile">
             <div class="avatar-wrapper" data-decoration-key="">
                 <div class="user-avatar" id="sidebar-avatar">?</div>
             </div>
            <div class="user-info">
                <div class="user-name" id="sidebar-name">Загрузка...</div>
                <div class="user-role" id="sidebar-user-title" title="Váš titul">Pilot</div>
            </div>
        </div>
        <div class="sidebar-footer"> &copy; <span id="currentYearSidebar">2025</span> Justax Systems </div>
    </aside>

    <main id="main-content">
        <header class="dashboard-header">
             <div class="header-content">
                 <div class="header-left-group">
                     <button class="btn btn-icon-only sidebar-toggle-btn" id="sidebar-toggle-btn" aria-label="Přepnout postranní panel" title="Přepnout postranní panel"> <i class="fas fa-chevron-left"></i> </button>
                     <button class="mobile-menu-toggle" id="main-mobile-menu-toggle" aria-label="Otevřít menu"> <i class="fas fa-bars"></i> </button>
                     <h1 id="dashboard-title"><i class="fas fa-images"></i>Kolekce Avatarů v2</h1>
                 </div>
                 <div class="header-actions">
                    </div>
             </div>
        </header>

        <div class="main-content-wrapper">
            <div id="avatar-display-area">
                <div class="avatar-wrapper avatar-frame-wreath"> <div class="avatar-content"><span class="avatar-placeholder">A1</span></div> </div>
                <div class="avatar-wrapper avatar-frame-crown"> <div class="avatar-content"><span class="avatar-placeholder">A2</span></div> </div> {/* Kept Crown */}
                <div class="avatar-wrapper avatar-frame-loading"> <div class="avatar-content"><span class="avatar-placeholder">A3</span></div> </div>
                <div class="avatar-wrapper avatar-frame-pirate"> <div class="avatar-content"><span class="avatar-placeholder">A4</span></div> </div>
                <div class="avatar-wrapper avatar-frame-glitch"> <div class="avatar-content"><span class="avatar-placeholder">A5</span></div> </div>
                <div class="avatar-wrapper avatar-frame-circuit"> <div class="avatar-content"><span class="avatar-placeholder">A6</span></div> </div>
                <div class="avatar-wrapper avatar-frame-bubbles"> <div class="avatar-content"><span class="avatar-placeholder">A7</span></div> </div>
                <div class="avatar-wrapper avatar-frame-geometric"> <div class="avatar-content"><span class="avatar-placeholder">A8</span></div> </div>
                <div class="avatar-wrapper avatar-frame-neon-sign"> <div class="avatar-content"><span class="avatar-placeholder">A9</span></div> </div>
                <div class="avatar-wrapper avatar-frame-stitches"> <div class="avatar-content"><span class="avatar-placeholder">B1</span></div> </div>
                <div class="avatar-wrapper avatar-frame-ink"> <div class="avatar-content"><span class="avatar-placeholder">B2</span></div> </div>
                <div class="avatar-wrapper avatar-frame-default"> <div class="avatar-content"><span class="avatar-placeholder">B3</span></div> </div> {/* Default/Simple */}
                <div class="avatar-wrapper avatar-frame-wreath"> <div class="avatar-content"><span class="avatar-placeholder">B4</span></div> </div>
                <div class="avatar-wrapper avatar-frame-loading"> <div class="avatar-content"><span class="avatar-placeholder">B5</span></div> </div>
                <div class="avatar-wrapper avatar-frame-pirate"> <div class="avatar-content"><span class="avatar-placeholder">B6</span></div> </div>
                <div class="avatar-wrapper avatar-frame-glitch"> <div class="avatar-content"><span class="avatar-placeholder">B7</span></div> </div>
                <div class="avatar-wrapper avatar-frame-circuit"> <div class="avatar-content"><span class="avatar-placeholder">B8</span></div> </div>
                <div class="avatar-wrapper avatar-frame-bubbles"> <div class="avatar-content"><span class="avatar-placeholder">B9</span></div> </div>
                <div class="avatar-wrapper avatar-frame-geometric"> <div class="avatar-content"><span class="avatar-placeholder">C1</span></div> </div>
                <div class="avatar-wrapper avatar-frame-neon-sign"> <div class="avatar-content"><span class="avatar-placeholder">C2</span></div> </div>
            </div>
            <svg style="visibility: hidden; position: absolute;" width="0" height="0" xmlns="http://www.w3.org/2000/svg" version="1.1">
                <defs>
                    <filter id="ink-splatter-filter">
                        <feTurbulence type="fractalNoise" baseFrequency="0.02 0.05" numOctaves="3" result="turbulence"/>
                        <feDisplacementMap in2="turbulence" in="SourceGraphic" scale="15" xChannelSelector="R" yChannelSelector="G"/>
                    </filter>
                </defs>
            </svg>
        </div>

        <footer class="dashboard-footer">
            <p>&copy; <span id="currentYearFooter">2025</span> Justax Systems // Secure Channel</p>
        </footer>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        (function() {
            'use strict';
            console.log("[Init Avatar Collection v21 - New Frames] Starting...");

            // Supabase and user logic remains the same
            const supabaseUrl = 'https://qcimhjjwvsbgjsitmvuh.supabase.co';
            const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFjaW1oamp3dnNiZ2pzaXRtdnVoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDI1ODA5MjYsImV4cCI6MjA1ODE1NjkyNn0.OimvRtbXuIUkaIwveOvqbMd_cmPN5yY3DbWCBYc9D10';
            let supabase = null;
            let currentUser = null;
            let currentProfile = null;
            let allTitles = []; // Keep for sidebar consistency
            const SIDEBAR_STATE_KEY = 'sidebarCollapsedState';

            // UI Cache
            const ui = {
                sidebar: document.getElementById('sidebar'),
                sidebarOverlay: document.getElementById('sidebar-overlay'),
                mainMobileMenuToggle: document.getElementById('main-mobile-menu-toggle'),
                sidebarCloseToggle: document.getElementById('sidebar-close-toggle'),
                sidebarToggleBtn: document.getElementById('sidebar-toggle-btn'),
                sidebarAvatar: document.getElementById('sidebar-avatar'),
                sidebarName: document.getElementById('sidebar-name'),
                sidebarUserTitle: document.getElementById('sidebar-user-title'),
                currentYearSidebar: document.getElementById('currentYearSidebar'),
                currentYearFooter: document.getElementById('currentYearFooter'),
                mainAvatarDisplayArea: document.getElementById('avatar-display-area'),
                mainContent: document.getElementById('main-content')
            };

            // Helper functions remain the same
            function sanitizeHTML(str) { const t = document.createElement('div'); t.textContent = str || ''; return t.innerHTML; }
            function getInitials(p) { if (!p) return '?'; const f = p.first_name?.[0] || ''; const l = p.last_name?.[0] || ''; return (f + l).toUpperCase() || p.username?.[0].toUpperCase() || p.email?.[0].toUpperCase() || '?'; }
            function openMenu() { if (ui.sidebar && ui.sidebarOverlay) { document.body.classList.remove('sidebar-collapsed'); ui.sidebar.classList.add('active'); ui.sidebarOverlay.classList.add('active'); } }
            function closeMenu() { if (ui.sidebar && ui.sidebarOverlay) { ui.sidebar.classList.remove('active'); ui.sidebarOverlay.classList.remove('active'); } }
            function updateCopyrightYear() { const y = new Date().getFullYear(); if (ui.currentYearSidebar) ui.currentYearSidebar.textContent = y; if (ui.currentYearFooter) ui.currentYearFooter.textContent = y; }
            function toggleSidebar() { try { const isCollapsed = document.body.classList.toggle('sidebar-collapsed'); localStorage.setItem(SIDEBAR_STATE_KEY, isCollapsed ? 'collapsed' : 'expanded'); const icon = ui.sidebarToggleBtn?.querySelector('i'); if (icon) icon.className = isCollapsed ? 'fas fa-chevron-right' : 'fas fa-chevron-left'; if(ui.sidebarToggleBtn) ui.sidebarToggleBtn.title = isCollapsed ? 'Rozbalit panel' : 'Sbalit panel'; } catch (e) { console.error("Sidebar toggle error:", e); } }
            function applyInitialSidebarState() { try { const state = localStorage.getItem(SIDEBAR_STATE_KEY); const collapsed = state === 'collapsed'; document.body.classList.toggle('sidebar-collapsed', collapsed); const icon = ui.sidebarToggleBtn?.querySelector('i'); if (icon) icon.className = collapsed ? 'fas fa-chevron-right' : 'fas fa-chevron-left'; if(ui.sidebarToggleBtn) ui.sidebarToggleBtn.title = collapsed ? 'Rozbalit panel' : 'Sbalit panel'; } catch (e) { console.error("Sidebar state error:", e); } }

            // Supabase init and data fetching remain the same
            function initializeSupabase() { try { if (!window.supabase?.createClient) throw new Error("Supabase lib not loaded."); supabase = window.supabase.createClient(supabaseUrl, supabaseKey); if (!supabase) throw new Error("Client creation failed."); console.log('[Supabase] Client initialized.'); return true; } catch (e) { console.error('[Supabase] Init failed:', e); alert("Chyba připojení k databázi."); return false; } }
            async function fetchUserProfile(userId) { if (!supabase || !userId) return null; try { const { data, error } = await supabase.from('profiles').select('*, selected_title').eq('id', userId).single(); if (error && error.code !== 'PGRST116') throw error; return data; } catch (e) { console.error('Profile fetch error:', e); return null; } }
            async function fetchTitles() { /* Still needed for sidebar */ if (!supabase) return []; try { const { data, error } = await supabase.from('title_shop').select('title_key, name'); if (error) throw error; return data || []; } catch (e) { console.error("Titles fetch error:", e); return []; } }
            async function createDefaultProfile(userId, userEmail) { /* Same as original */ if (!supabase || !userId || !userEmail) return null; try { const defaultData = { id: userId, email: userEmail, username: userEmail.split('@')[0] || `user_${userId.substring(0, 6)}`, level: 1, points: 0, experience: 0, badges_count: 0, streak_days: 0, created_at: new Date().toISOString(), updated_at: new Date().toISOString(), preferences: { dark_mode: window.matchMedia('(prefers-color-scheme: dark)').matches }, notifications: { email: true } }; const { data: newProfile, error } = await supabase.from('profiles').insert(defaultData).select('*, selected_title').single(); if (error) { if (error.code === '23505') { return await fetchUserProfile(userId); } throw error; } return newProfile; } catch (error) { console.error("Failed to create default profile:", error); return null; } }

            // UpdateUI only updates the sidebar now
            function updateUI(profile, titles) {
                console.log("Updating Sidebar UI...");
                if (ui.sidebarName && ui.sidebarAvatar && ui.sidebarUserTitle) {
                    if (profile) {
                        const displayName = `${profile.first_name || ''} ${profile.last_name || ''}`.trim() || profile.username || currentUser?.email?.split('@')[0] || 'Pilot';
                        ui.sidebarName.textContent = sanitizeHTML(displayName);
                        const initials = getInitials(profile);
                        const avatarUrl = profile.avatar_url;
                        ui.sidebarAvatar.innerHTML = avatarUrl ? `<img src="${sanitizeHTML(avatarUrl)}?t=${Date.now()}" alt="${sanitizeHTML(initials)}">` : sanitizeHTML(initials);
                        const sidebarImg = ui.sidebarAvatar.querySelector('img');
                        if (sidebarImg) { sidebarImg.onerror = () => { ui.sidebarAvatar.innerHTML = sanitizeHTML(initials); }; }
                        const selectedTitleKey = profile.selected_title;
                        let displayTitle = 'Pilot';
                        if (selectedTitleKey && titles?.length > 0) { const foundTitle = titles.find(t => t.title_key === selectedTitleKey); if (foundTitle) displayTitle = foundTitle.name; }
                        ui.sidebarUserTitle.textContent = sanitizeHTML(displayTitle); ui.sidebarUserTitle.title = sanitizeHTML(displayTitle);
                    } else { ui.sidebarName.textContent = "Nepřihlášen"; ui.sidebarAvatar.textContent = '?'; ui.sidebarUserTitle.textContent = 'Pilot'; }
                }
                console.log("Sidebar UI updated.");
            }

            // Event listeners setup remains the same
            function setupEventListeners() {
                 if (ui.mainMobileMenuToggle) ui.mainMobileMenuToggle.addEventListener('click', openMenu);
                 if (ui.sidebarCloseToggle) ui.sidebarCloseToggle.addEventListener('click', closeMenu);
                 if (ui.sidebarOverlay) ui.sidebarOverlay.addEventListener('click', closeMenu);
                 if (ui.sidebarToggleBtn) ui.sidebarToggleBtn.addEventListener('click', toggleSidebar);
                 document.querySelectorAll('.sidebar-link').forEach(link => { link.addEventListener('click', () => { if (window.innerWidth <= 992) closeMenu(); }); });
                 window.addEventListener('resize', () => { if (window.innerWidth > 992 && ui.sidebar?.classList.contains('active')) closeMenu(); });
                 console.log("Event listeners set up.");
            }

            // Initialize App - Loads user data for sidebar
            async function initializeApp() {
                console.log("[Init Avatar Collection v21] Running initializeApp...");
                if (!initializeSupabase()) return;

                applyInitialSidebarState();
                setupEventListeners();
                updateCopyrightYear();

                if (ui.mainContent) ui.mainContent.style.visibility = 'hidden';

                try {
                    const { data: { session }, error: sessionError } = await supabase.auth.getSession();
                    if (sessionError) throw new Error(`Auth session error: ${sessionError.message}`);

                    if (session?.user) {
                        currentUser = session.user;
                        console.log(`[Init Avatar Collection] User authenticated (ID: ${currentUser.id}).`);

                         const [profileResult, titlesResult] = await Promise.allSettled([ fetchUserProfile(currentUser.id), fetchTitles() ]);
                         if (profileResult.status === 'fulfilled' && profileResult.value) { currentProfile = profileResult.value; }
                         else { currentProfile = await createDefaultProfile(currentUser.id, currentUser.email); if (!currentProfile) throw new Error("Failed profile fetch/create."); }
                         if (titlesResult.status === 'fulfilled') { allTitles = titlesResult.value || []; }
                         else { console.warn("Titles fetch failed:", titlesResult.reason); allTitles = []; }

                        updateUI(currentProfile, allTitles);

                        if (ui.mainContent) { ui.mainContent.style.visibility = 'visible'; }

                        console.log("✅ [Init Avatar Collection] Page initialized.");

                    } else { console.log('[Init Avatar Collection] User not logged in, redirecting...'); window.location.href = '/auth/index.html'; }
                } catch (error) { console.error("❌ [Init Avatar Collection] Critical initialization error:", error); if (ui.mainContent) ui.mainContent.innerHTML = `<p style='color:red; padding:2rem;'>Chyba: ${error.message}</p>`; if (ui.mainContent) ui.mainContent.style.visibility = 'visible'; }
            }

            document.addEventListener('DOMContentLoaded', initializeApp);

        })();
    </script>
</body>
</html>